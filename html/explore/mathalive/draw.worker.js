!function(){"use strict";let e,o,l,i,n,t,a,r,s;var u;!function(e){e[e.ERASER=0]="ERASER",e[e.THIN_PEN=1]="THIN_PEN",e[e.TICK_PEN=2]="TICK_PEN",e[e.CINE_PEN=3]="CINE_PEN"}(u||(u={})),addEventListener("message",(d=>{var p,c,h,g,C,v;const b=d.data;if(b&&b.type)if("init"===b.type)i=b.canvas,n=b.subCanvas,e=null===(p=b.canvas)||void 0===p?void 0:p.getContext("2d"),o=null===(c=b.subCanvas)||void 0===c?void 0:c.getContext("2d");else if("changeColor"===b.type)l&&b.selectedColor&&(a=b.selectedColor,l.strokeStyle=b.selectedColor);else if("swapDrawing"===b.type)t&&(null==e||e.drawImage(t,0,0),null==l||l.clearRect(0,0,t.width,t.height));else if("setupPenBrush"===b.type)r=u.THIN_PEN,s=b.width,e.globalAlpha=1,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=b.width,l.strokeStyle=b.selectedColor,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over";else if("setupBrushEraser"===b.type)r=u.ERASER,e.globalAlpha=1,t=i,l=e,l.lineCap="round",l.lineJoin="round",l.lineWidth=30,l.globalCompositeOperation="destination-out";else if("setupBrushCinePen"===b.type)r=u.CINE_PEN,e.globalAlpha=.2,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=15,l.strokeStyle=a,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over";else if("draw"===b.type)null==l||l.beginPath(),null==l||l.moveTo(null===(h=b.info)||void 0===h?void 0:h.srcX,null===(g=b.info)||void 0===g?void 0:g.srcY),null==l||l.lineTo(null===(C=b.info)||void 0===C?void 0:C.destX,null===(v=b.info)||void 0===v?void 0:v.destY),null==l||l.stroke(),null==l||l.closePath();else if("clearScreen"===b.type)null==e||e.clearRect(0,0,i.width,i.height),null==o||o.clearRect(0,0,i.width,i.height);else if("reRender"===b.type)fetch(b.base64).then((e=>e.blob())).then((o=>{createImageBitmap(o).then((o=>{null==e||e.clearRect(0,0,i.width,i.height),null==e||e.save(),e.globalCompositeOperation="source-over",e.globalAlpha=1,e.drawImage(o,0,0),e.restore()}),(e=>{}))}),(e=>{}));else if("drawImage"===b.type);else if("drawRemotePenData"===b.type){self.postMessage("remotePenDraw_start");const p=d.data,c=null==p?void 0:p.remotePenData,h=null==c?void 0:c.info,g=null==h?void 0:h.mode,C=null==c?void 0:c.arrx,v=null==c?void 0:c.arry;switch(g){case u.ERASER:e.globalAlpha=1,t=i,l=e,l.lineCap="round",l.lineJoin="round",l.lineWidth=30,l.globalCompositeOperation="destination-out";break;case u.CINE_PEN:e.globalAlpha=.2,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=15,l.strokeStyle=null==h?void 0:h.color,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over";break;case u.THIN_PEN:e.globalAlpha=1,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=2,l.strokeStyle=null==h?void 0:h.color,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over";break;case u.TICK_PEN:e.globalAlpha=1,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=7,l.strokeStyle=null==h?void 0:h.color,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over"}switch(C.forEach(((e,o)=>{0===o?(null==l||l.beginPath(),null==l||l.moveTo(C[o],v[o])):o===C.length-1?(null==l||l.stroke(),null==l||l.closePath()):null==l||l.lineTo(C[o],v[o])})),self.postMessage("remotePenDraw_complete"),g!==u.ERASER&&t&&(null==e||e.drawImage(t,0,0),null==l||l.clearRect(0,0,t.width,t.height)),r){case u.ERASER:e.globalAlpha=1,t=i,l=e,l.lineCap="round",l.lineJoin="round",l.lineWidth=30,l.globalCompositeOperation="destination-out";break;case u.CINE_PEN:e.globalAlpha=.2,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=15,l.strokeStyle=a,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over";break;case u.THIN_PEN:case u.TICK_PEN:e.globalAlpha=1,t=n,l=o,l.lineCap="round",l.lineJoin="round",l.lineWidth=s,l.strokeStyle=a,l.globalCompositeOperation="source-over",e.globalCompositeOperation="source-over"}}}))}();