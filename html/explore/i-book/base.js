(()=>{"use strict";var t,e={237:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`*{margin:0;padding:0;box-sizing:border-box}:host{position:absolute;left:0;top:0;width:100%;height:100%;background-image:linear-gradient(0deg,#333d6a 0,#5b6faa 100%);user-select:none}.bg{position:absolute;left:30px;top:42px;right:30px;bottom:42px;background-color:#e1e2e9;border-radius:20px}.container{position:absolute;left:50px;top:70px;right:50px;bottom:70px;overflow-y:auto;white-space:normal;padding:20px;color:#000;line-height:1.6em;font-weight:600;scroll-behavior:smooth;font-family:noto-sans-scott;font-size:40px;text-align:left}.container::-webkit-scrollbar-track{box-shadow:inset 0 0 0 rgba(0,0,0,.2);border-radius:4px;background-color:rgba(0,0,0,0)}.container::-webkit-scrollbar{width:24px;background-color:rgba(0,0,0,0)}.container::-webkit-scrollbar-thumb{border-radius:24px;box-shadow:inset 0 0 0 rgba(0,0,0,.2);background-color:rgba(0,0,0,.3);background-clip:padding-box;border:8px solid transparent}.speaker{font-weight:700;display:inline-block;padding-top:.3em}.speaker:first-child{padding-top:unset!important}.script{transition-property:color;transition-duration:.2s}.script.on{color:#00f!important}.script.on *{color:#00f!important}`},11:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host *{margin:0;padding:0;box-sizing:border-box}:host button{border:none;cursor:pointer;background:0 0;outline:0}:host .player-box{border-radius:5px;overflow:hidden;background-color:#323232;min-width:530px;min-height:128px;width:700px;box-shadow:0 0 30.45px 4.55px rgba(0,0,0,.2);position:relative;pointer-events:all}:host .player-box.fullscreen{position:absolute;left:0!important;top:0!important;width:100%!important;height:100%!important;box-shadow:none;display:flex;flex-direction:column}:host .player-box>.top{height:35px;display:flex;align-items:center;justify-content:flex-end;background-color:#1f1f1f}:host .player-box .close-button{width:19px;height:19px;background:url(i-book/images/audio/close.png);background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button{width:18px;height:15px;background:url(i-book/images/audio/ico_mini.png);background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button.hide{display:none}:host .player-box>.middle{display:none;min-height:200px}:host .player-box.fullscreen>.middle{flex-grow:1}:host .player-box .script-box{background-color:#fff;height:100%;display:block}:host .player-box>.bottom{height:127px;padding:0 20px}:host .top-controls{height:50%;display:flex;align-items:center;padding-top:28px}:host .time-current,:host .time-remaining{font-size:16px;color:#bdbdbd;line-height:1}:host .progress-bnd{flex-grow:1;margin:0 15px;position:relative}:host .progress-bnd .progress-bar{display:block;width:100%}:host .sound-button{margin-left:23px;width:32px;height:24px;background:url(i-book/images/video/ico_sound.png);background-position:1px 0;background-size:29px 24px;background-repeat:no-repeat;margin-right:5px}:host .sound-button.mute{background-position:0 0;background-size:32px 24px;background-image:url(i-book/images/audio/ico_mute.png)}:host .volume-bar{width:68px;margin-left:5px}:host .num-marker{width:19px;height:26px;background:url(i-book/images/audio/num_marker.png);background-size:100% 100%;background-repeat:no-repeat;position:absolute;top:calc(-3px - 100%);transform:translateX(-50%);cursor:pointer;font-size:12px;color:#fff;text-align:center;padding-top:1px}:host .repeat-marker{width:10px;height:13px;background:url(i-book/images/audio/repeat_marker.png);background-repeat:no-repeat;position:absolute;top:calc(10px - 100%);transform:translateX(-50%)}:host .btm-controls{height:50%;display:flex;align-items:center;justify-content:space-between}:host .play-pause{width:22px;height:100%;display:flex;align-items:center;justify-content:center}:host .play-button{width:20px;height:25px;background:url(i-book/images/audio/ico_play.png);background-size:100% 100%;background-repeat:no-repeat}:host .play-button.play{width:22px;height:22px;background:url(i-book/images/audio/ico_pause.png);background-size:100% 100%;background-repeat:no-repeat}:host .stop-button{width:22px;height:22px;background:url(i-book/images/audio/ico_stop.png);background-size:100% 100%;background-repeat:no-repeat}:host .prev-button{width:28px;height:24px;background:url(i-book/images/audio/ico_prev.png);background-size:100% 100%;background-repeat:no-repeat}:host .next-button{width:28px;height:24px;background:url(i-book/images/audio/ico_next.png);background-size:100% 100%;background-repeat:no-repeat}:host .btm-controls>div{display:flex;align-items:center}:host .btm-controls .left>button{margin-left:30px}:host .btm-controls .right{margin-right:0;position:relative}:host .btm-controls .right.hide{display:none}:host .repeat-button{width:30px;height:25px;background:url(i-book/images/audio/ico_repeat.png);background-size:100% 100%;background-repeat:no-repeat}:host .repeat-button.on{background:url(i-book/images/audio/ico_repeat_on.png)}:host .text-adjust{position:relative;top:1px;margin-right:20px;bottom:0;width:78px;height:30px;border:2px solid #7088d1;border-radius:15px;background-image:url(i-book/images/audio/ico_text.png);background-position:center center;background-repeat:no-repeat;background-size:20px 20px;display:flex;align-items:center;justify-content:space-between;padding:0 3px}:host .text-adjust.hide{display:none}:host .text-adjust .minus-button,:host .text-adjust .plus-button{width:20px;height:20px;border-radius:50%;background:#7088d1;background-repeat:no-repeat;background-position:center}:host .text-adjust .minus-button{background-image:url(i-book/images/audio/ico_minus.png);background-position:4.5px 10px}:host .text-adjust .plus-button{background-image:url(i-book/images/audio/ico_plus.png);background-position:4px 4.5px}:host .script-button{width:25px;height:31px;margin-right:20px;background:url(i-book/images/audio/ico_script.png);background-size:auto auto;background-position:center center;background-repeat:no-repeat}:host .script-button.on{background-image:url(i-book/images/audio/ico_script_on.png)}:host .down-button{width:33px;height:31px;margin-right:20px;background:url(i-book/images/audio/ico_down.png);background-size:100% 100%;background-repeat:no-repeat;transition-duration:.3s;opacity:1;transition-property:transform opacity}:host .down-button.hide{display:none}:host .down-button.hidden{visibility:hidden}:host .down-button.sended{pointer-events:none;transform:translate(0,50px);opacity:0}:host .fullscreen-button{width:29px;height:28px;background:url(i-book/images/audio/ico_fullscreen.png);background-size:27px 28px;background-repeat:no-repeat;background-size:100% 100%;background-position:center}:host .fullscreen-button.hide{display:none}:host .fullscreen-button.hidden{visibility:hidden}:host .player-box.fullscreen .fullscreen-button{background-size:100% 100%;background-image:url(i-book/images/audio/ico_smallscreen.png)}:host .size-drag-tgt{width:20px;height:20px;background:url(i-book/images/audio/drag.png);background-size:100% 100%;position:absolute;bottom:-5px;right:-3px;cursor:pointer}:host .player-box.ver>.top{background-color:#323232}:host .player-box.ver>.middle{display:block}`},81:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{background-color:rgba(255,255,255,0);position:relative;cursor:pointer;height:20px}:host .box{pointer-events:none;left:-3px;right:-3px;top:7px;height:6px;background:#707070;border-radius:3px;position:absolute}:host .btn{pointer-events:all;width:16px;height:16px;background:#fff;border-radius:8px;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:1}:host .btn.audio{width:16px;height:16px;border-radius:8px}`},505:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:relative}:host *{margin:0;padding:0;box-sizing:border-box}:host .scroll{position:absolute;overflow-y:auto;white-space:normal;padding-right:15px;color:#000;left:.8em;right:5px;top:20px;bottom:20px;line-height:1.6em;font-weight:600;scroll-behavior:smooth}:host .scroll::-webkit-scrollbar{width:10px}:host .scroll::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.2);border-radius:5px}:host .speaker{font-weight:700;display:inline-block;padding-top:.3em}:host .speaker:first-child{padding-top:unset!important}:host .script{cursor:pointer;transition-property:color;transition-duration:.2s}:host .script.on{color:#00f!important}:host .script.on *{color:#00f!important}`},881:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host *{margin:0;padding:0;box-sizing:border-box}:host button{border:none;cursor:pointer;background:0 0;outline:0}:host::after{content:url(i-book/images/audio/ico_mini.png) url(i-book/images/video/ico_pause.png) url(i-book/images/video/ico_mute.png) url(i-book/images/video/ico_script_ver.png) url(i-book/images/video/ico_script_hor.png) url(i-book/images/video/ico_script_ver_on.png) url(i-book/images/video/ico_script_hor_on.png) url(i-book/images/video/ico_smallscreen.png) url(i-book/images/video/ico_down.png);width:0;height:0;overflow:hidden}:host .player-box{border-radius:5px;background-color:#323232;min-width:640px;width:860px;height:auto;box-shadow:0 0 30.45px 4.55px rgba(0,0,0,.2);position:relative;pointer-events:all}:host .player-box.fullscreen{position:absolute;left:0!important;top:0!important;width:100%!important;height:100%!important;box-shadow:none}:host .player-box>.top{height:35px;display:flex;align-items:center;justify-content:flex-end}:host .player-box .close-button{width:19px;height:19px;background:url(i-book/images/video/close.png);background-repeat:no-repeat;background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button{width:18px;height:15px;background:url(i-book/images/audio/ico_mini.png);background-repeat:no-repeat;background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button.hide{display:none}:host .player-box>.bottom{height:50px;display:flex;align-items:center;justify-content:space-between}:host .left-controls{display:flex;flex-grow:1;align-items:center;height:100%;width:75%}:host .play-pause{margin-left:20px;width:22px;height:100%;display:flex;align-items:center;justify-content:center}:host .play-button{width:20px;height:25px;background:url(i-book/images/video/ico_play.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%}:host .play-button.play{width:22px;height:22px;background:url(i-book/images/video/ico_pause.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%}:host .stop-button{margin-left:18px;width:22px;height:22px;background:url(i-book/images/video/ico_stop.png);background-size:100% 100%;background-repeat:no-repeat}:host .prev-button{margin-left:18px;width:28px;height:24px;background:url(i-book/images/video/ico_prev.png);background-size:100% 100%;background-repeat:no-repeat}:host .next-button{margin-left:18px;width:28px;height:24px;background:url(i-book/images/video/ico_next.png);background-size:100% 100%;background-repeat:no-repeat}:host .time-current,:host .time-remaining{font-size:16px;color:#bdbdbd;line-height:1}:host .time-current{margin-left:18px}:host .progress-bar{flex-grow:1;margin:0 15px}:host .sound-button{margin-left:3%;width:32px;height:24px;background:url(i-book/images/video/ico_sound.png);background-position:1px 0;background-size:29px 24px;background-repeat:no-repeat;background-size:29px 24px;margin-right:8px}:host .sound-button.mute{background-position:0 0;background-size:32px 24px;background:url(i-book/images/video/ico_mute.png);background-size:32px 24px}:host .volume-bar{width:50px;margin-left:4px;margin-right:25px}:host .right-controls{display:flex;align-items:center;height:100%;margin-right:22px;position:relative}:host .script-choice{position:absolute;bottom:100%;right:60%;background:rgba(50,50,50,.85);border-radius:5px;display:flex;align-items:center;padding:4px 9px}:host .script-choice .script-ver{width:22px;height:27px;background:url(i-book/images/video/ico_script_ver.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%}:host .script-choice .script-hor{width:23px;height:29px;background:url(i-book/images/video/ico_script_hor.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%;margin-left:11px}:host .script-button{margin-right:13px;width:23px;height:27px;background:url(i-book/images/video/ico_script.png);background-size:100% 100%;background-repeat:no-repeat}:host .script-button.hide{display:none}:host .down-button{margin-right:13px;width:33px;height:31px;background:url(i-book/images/video/ico_down.png);background-size:100% 100%;background-repeat:no-repeat;transition-duration:.3s;opacity:1;transition-property:transform opacity}:host .down-button.hide{display:none}:host .down-button.hidden{visibility:hidden}:host .down-button.sended{pointer-events:none;transform:translate(0,50px);opacity:0}:host .fullscreen-button{width:29px;height:28px;background:url(i-book/images/video/ico_fullscreen.png);background-size:27px 28px;background-repeat:no-repeat;background-size:100% 100%;background-position:center}:host .player-box>.middle{position:relative;min-height:240px}:host .media-box{text-align:center;height:100%}:host .media-box video{background-color:#000;width:100%;height:100%;object-fit:contain;outline-style:none}:host .player-box .script-box{background-color:#fff;height:49%;display:none}:host .player-box.ver .middle{min-height:360px}:host .player-box.ver .media-box{height:51%}:host .player-box.ver .script-box{display:block;height:49%}:host .player-box.ver .script-button{background-image:url(i-book/images/video/ico_script_ver_on.png)}:host .player-box.hor{min-width:600px}:host .player-box.hor .middle{display:flex}:host .player-box.hor .media-box{width:49%;height:100%}:host .player-box.hor .script-box{display:block;width:51%;height:100%}:host .player-box.hor .script-button{background-image:url(i-book/images/video/ico_script_hor_on.png)}:host .player-box.fullscreen>.top{display:none!important}:host .player-box.fullscreen>.middle{height:calc(100% - 50px)!important}:host .player-box.fullscreen .media-box video{object-fit:fill!important}:host .player-box.ver.fullscreen .media-box video{height:100%!important;object-fit:contain!important}:host .player-box.hor.fullscreen .media-box video{width:100%!important;object-fit:contain!important}:host .player-box.fullscreen .fullscreen-button{background-size:100% 100%;background-image:url(i-book/images/video/ico_smallscreen.png)}:host .drag{width:17px;height:17px;background:url(i-book/images/video/drag.png);background-size:100% 100%;position:absolute;bottom:-4px;right:-2px;cursor:pointer}:host .player-box.fullscreen .drag{display:none}`},136:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:absolute;display:flex;z-index:50;left:0;width:100%;top:0;height:100%;align-items:center;justify-content:center;touch-action:none;user-select:none}`},875:()=>{},139:(t,e,i)=>{const s=1280,o=1280;var r=i(486);const n=["","/content/sample/male_01.png","/content/sample/user_none_01.png","/content/sample/thumb0.jpg","/content/sample/user_none_02.png","/content/sample/male_02.png","/content/sample/female_03.png","/content/sample/male_03.png","/content/sample/female_04.png","/content/sample/female_04.png"],a=["/content/sample/male_02.png","/content/sample/female_03.png","/content/sample/male_03.png","/content/sample/female_04.png","/content/sample/female_04.png","/content/sample/male_01.png","/content/sample/male_01.png","/content/sample/user_none_01.png","/content/sample/female_02.png","/content/sample/user_none_02.png"],d=["Olivia Leonardo Wilhelm Dicaprio","Ray","Aiden","Leonardo Wilhelm Dicaprio","Blue","Lisa","Irene","Ted","Helen","Kate"],l=["Leonardo Wilhelm Dicaprio nick_Olivia","nick_Ray","nick_Aiden","nick_Kevin","nick_Blue","nick_Lisa","nick_Irene","nick_Ted","nick_Helen","nick_Kate"];let h,c;var p=i(527);function m(t){return new Promise((e=>{setTimeout((()=>e()),t)}))}let u=Date.now();function _(){return new Worker(i.p+"base/i-book/recorder-worker.js")}var g,f,v,y=function(t,e,i,s){return new(i||(i=Promise))((function(o,r){function n(t){try{d(s.next(t))}catch(t){r(t)}}function a(t){try{d(s.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}d((s=s.apply(t,e||[])).next())}))};function b(t){t.getTracks().forEach((e=>{try{e.stop()}catch(t){}t.removeTrack(e)}))}class x extends p.TypedEmitter{constructor(t,e){super(),this._videoRecorder=null,this._audioRecorder=null,this._isRear=!1,this._stream_cam=null,this._stream=null,this._mimeAudio="",this._mimeVideo="",this._mimeType="",this._timerid=-1,this._chunks=[],this._state="",this._mirror_state=0,this._ctx=null,this._zIndexTop=!1,this._draggable=!1,this._notifyRecordTime=!1,this._videoBnd={top:"0",left:"0",width:"100%",height:"100%"},this._cameraStarting=!1,this.drawCanvas=()=>{if(0===this._mirror_state)return;if(""===this._state)return;if(this._isRear)return;if(!this._stream)return;if(this._mimeType!==this._mimeVideo)return;const t=this._video,e=this._ctx_mirror;if(1===this._mirror_state){if("starting"!==this._state)return;if(t.videoWidth>0&&t.videoHeight>0){this._mirror_state=2;let i=Math.min(720,4*t.videoWidth),s=Math.round(i*t.videoHeight/t.videoWidth);e.canvas.width=i,e.canvas.height=s,e.canvas.captureStream(12).getVideoTracks().forEach((t=>{var e;const i=t;i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)}))}}this._mirror_state>1&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save(),e.setTransform(-1,0,0,1,e.canvas.width,0),e.drawImage(t,0,0,e.canvas.width,e.canvas.height),e.setTransform(1,0,0,1,0,0),e.restore()),window.requestAnimationFrame(this.drawCanvas)},this._isMobile=t,this._worker=new _,this._camDirFnc=e;try{["audio/mpeg-1","audio/mpeg","audio/mp3","audio/wav","audio/webm","audio/wav","audio/pcm","audio/ogg"].some((t=>!!MediaRecorder.isTypeSupported(t)&&(this._mimeAudio=t,!0))),["video/mpeg-4","video/mp4","video/webm","video/ogg"].some((t=>!!MediaRecorder.isTypeSupported(t)&&(this._mimeVideo=t,!0))),this.isSupported=!0}catch(t){canConsole()&&console.error("[recorder]error",`/util/record.ts constructor error=${t}`),this.isSupported=!1}canConsole()&&(""===this._mimeAudio&&console.warn("[recorder]warn",0,"/util/record.ts constructor this._mimeAudio is empty"),""===this._mimeVideo&&console.warn("[recorder]warn",0,"/util/record.ts constructor this._mimeVideo is empty"));const i=document.createElement("canvas");this._ctx_mirror=i.getContext("2d"),this._video=document.createElement("video"),this._video.autoplay=!0,this._video.muted=!0,this._video.id="recorder-"+function(){const t=Date.now();return t>u?u=t:u+=1,u.toString(36)}()}get state(){return this._state}get video(){return this._video}get zIndexTop(){return this._zIndexTop}get draggable(){return this._draggable}get videoBnd(){return this._videoBnd}startCamera(t,e,i){return y(this,void 0,void 0,(function*(){let s=Date.now();if(canConsole()&&console.log("[recorder]a => startCamera",this._state,s),"loading"!==this._state)return void i();this._stopStream();const o=navigator.mediaDevices.getSupportedConstraints(),r={audio:!0};let n=!1;this._isMobile?e&&t&&o.facingMode?(r.video={facingMode:"environment"},n=!0):(e=!1,r.video=t,n=!0):(e=!1,r.video=t),this._isRear=e;let a=null;try{if(canConsole()&&console.log("[recorder]b => startCamera",this._state,Date.now()-s,s,r),this._state="starting",this.emit("change-state"),this._cameraStarting=!0,a=yield navigator.mediaDevices.getUserMedia(r),this._cameraStarting=!1,canConsole()&&console.log("[recorder]c => startCamera",this._state,Date.now()-s,s),"starting"!==this._state)return"ready"!==this._state&&b(a),void i();n=!0,this._stream_cam=a}catch(t){return this._cameraStarting=!1,this._stream=null,void i()}if(a)if(t)if(e)this._mirror_state=0,n?this._stream=a:(this._stream=new MediaStream,a.getTracks().forEach((t=>{var e;const i=t.clone();i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)}))),this._video.style.transform="",this._video.srcObject=this._stream,i();else{for(this._mirror_state=1,this._video.style.transform="scale(-1, 1)",this._video.srcObject=a,this._stream=new MediaStream,a.getAudioTracks().forEach((t=>{var e;const i=t.clone();i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)})),canConsole()&&console.log("[recorder]d => startCamera",this._state,Date.now()-s,s),this.drawCanvas();1===this._mirror_state;)yield m(100);canConsole()&&console.log("[recorder]e => startCamera",this._state,Date.now()-s,s),i()}else this._mirror_state=0,n?this._stream=a:(this._stream=new MediaStream,a.getAudioTracks().forEach((t=>{var e;const i=t.clone();i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)}))),i();else this._mirror_state=0,i()}))}setUI(t,e,i,s){this._videoBnd.left=t.left+"px",this._videoBnd.top=t.top+"px",this._videoBnd.width=t.width>0?t.width+"px":"100%",this._videoBnd.height=t.height>0?t.height+"px":"100%",this._zIndexTop=e,this._draggable=i,this._notifyRecordTime=s}initRecord(t,e,i){return y(this,void 0,void 0,(function*(){if(r.isUndefined(i)&&(i=this._isRear),!this.isSupported)return void e(!1);if("ready"===this._state){if("video"===t&&this._isRear===i&&this._mimeType===this._mimeVideo)return void e(!0);if("voice"===t&&this._mimeType===this._mimeAudio)return void e(!0)}else if(""!==this._state)return void e();let s=0;for(;this._cameraStarting&&(yield m(100),s++,!(s>30)););this.clear(),"video"===t?this._mimeType=this._mimeVideo:(this._mimeType=this._mimeAudio,this._videoBnd={left:"0",top:"0",width:"100%",height:"100%"}),this._state="loading",this.emit("change-state"),this.startCamera(this._mimeType===this._mimeVideo,i,(()=>"starting"===this._state?this._stream?(this._state="ready",this.emit("change-state"),void e(!0)):(this._stopStream(),void e(!1)):(this._stopStream(),void e())))}))}toggleCam(t,e){"ready"===this._state&&this._mimeType===this._mimeVideo?r.isUndefined(t)||!this._stream||this._isRear!==t?(r.isUndefined(t)&&(t=!this._isRear),this._state="loading",this.emit("change-state"),this.startCamera(!0,t,(()=>"starting"===this._state?this._stream?(this._state="ready",this.emit("change-state"),void e(!0)):void e(!1):void e()))):e(!0):e(!1)}capture(t,e,i,s){return y(this,void 0,void 0,(function*(){if(!this.isSupported)return void s("");if("ready"!==this._state||!this._stream)return void s("");let o,r=this._video;for(;1===this._mirror_state||!r.videoWidth||!r.videoHeight;)yield m(100);if("ready"!==this._state||!this._stream)return void s("");this._state="recording",this.emit("change-state");let n=this._ctx;n?(o=n.canvas,n.clearRect(0,0,o.width,o.height)):(o=document.createElement("canvas"),n=o.getContext("2d")),this._ctx=n,o.width=t.width,o.height=t.height;const a=r.videoWidth/e,d=r.videoHeight/i;n.save(),this._isRear||n.setTransform(-1,0,0,1,t.width,0),n.drawImage(r,t.left*a,t.top*d,t.width*a,t.height*d,0,0,t.width,t.height),n.setTransform(1,0,0,1,0,0),n.restore();const l=o.toDataURL("image/jpeg",.7);this._state="ready",this.emit("change-state"),n.clearRect(0,0,o.width,o.height),s(l)}))}record(){return y(this,void 0,void 0,(function*(){return new Promise(((t,e)=>y(this,void 0,void 0,(function*(){if(this.isSupported)if("ready"===this._state&&this._stream)if(this._clearRecorder(),this._state="recording",this.emit("change-state"),this._mimeType===this._mimeAudio){const e=new AudioContext;e.createScriptProcessor||(e.createScriptProcessor=e.createJavaScriptNode);const i=e.createGain(),s=e.createMediaStreamSource(this._stream);s.connect(i);const o=e.createScriptProcessor(void 0,2,2);i.connect(o),o.connect(e.destination),this._audioRecorder={ctx:e,mic:s,mixer:i,processor:o};let r={type:"start",msg:{sampleRate:e.sampleRate,bitRate:128}};this._worker.postMessage(r);let n=!0,a=0;o.addEventListener("audioprocess",(i=>{if(n&&t(!0),n=!1,"recording"!==this._state)return;const s=[];for(let t=0;t<2;++t)s[t]=i.inputBuffer.getChannelData(t);let o={type:"record",msg:s};if(this._worker.postMessage(o),this._notifyRecordTime){let t=e.currentTime,i=Math.round(10*t);a!==i&&(a=i,this.emit("record-time",t))}}))}else{let e=this._video;for(;1===this._mirror_state||!e.videoWidth||!e.videoHeight;)yield m(100);this._videoRecorder=new MediaRecorder(this._stream,{mimeType:this._mimeType,audioBitsPerSecond:64e3,videoBitsPerSecond:64e4}),this._videoRecorder.ondataavailable=t=>{let e=t.data;this._chunks.push(e)},this._videoRecorder.start();let i=!0,s=e.currentTime;const o=()=>{i&&t(!0),i=!1,this._videoRecorder&&"recording"===this._state?(this._notifyRecordTime&&this.emit("record-time",e.currentTime-s),this._videoRecorder.requestData()):e.removeEventListener("timeupdate",o)};e.addEventListener("timeupdate",o)}else t(!1);else t(!1)}))))}))}stopAndSave(){return new Promise((t=>{var e,i;if(canConsole()&&console.info("[recorder] stopAndSave this._state",this._state),"recording"===this._state)if(this.isSupported)if(canConsole()&&console.info("[recorder] stopAndSave this._state",this._state,null===(e=this._videoRecorder)||void 0===e?void 0:e.state),this._timerid>=0&&(window.clearInterval(this._timerid),this._timerid=0),this._mimeType===this._mimeAudio){const e=new MessageChannel;e.port1.onmessage=e=>{const i=e.data;if(i&&i.type&&(canConsole()&&console.info("[recorder] stopAndSave audio receiveMessage, this._state",this._state),"encoded"===i.type)){let i=e.data.msg;const s=new FileReader;s.readAsDataURL(i),s.onloadend=()=>{var e;canConsole()&&console.info("[recorder] stopAndSave audio receiveMessage, reader.onloadend this._state",this._state),this.clear();const i=null===(e=s.result)||void 0===e?void 0:e.toString();t(null!=i?i:null),this.emit("recorded",null!=i?i:""),s.onloadend=null}}},canConsole()&&console.info("[recorder] stopAndSave audio postMessage, this._state",this._state),this._state="saving",this.emit("change-state");let i={type:"end",msg:void 0};this._worker.postMessage(i,[e.port2])}else{if(!this._videoRecorder)return this._state="ready",this.emit("change-state"),void t(null);this._videoRecorder.onstop=e=>{canConsole()&&console.log("[recorder] this._videoRecorder.onstop",this._state,this._chunks.length);let i=new Blob(this._chunks,{type:this._mimeType});const s=new FileReader;s.onloadend=()=>{var e;canConsole()&&console.log("[recorder] reader.onloadend",this._state,s.result,"<--reader.result");const i=null===(e=s.result)||void 0===e?void 0:e.toString();t(null!=i?i:null),this.emit("recorded",null!=i?i:""),this._clearRecorder(),s.onloadend=null},s.readAsDataURL(i)},canConsole()&&console.log("[recorder] this._videoRecorder.stop",this._state,null===(i=this._videoRecorder)||void 0===i?void 0:i.state),this._state="saving",this.emit("change-state"),canConsole()&&console.log("this._videoRecorder.stop",this._video.currentTime),this._videoRecorder.stop()}else t(null);else t(null)}))}_clearRecorder(){if(this._timerid>=0&&(canConsole()&&console.info("_clearRecorder _timerid",this._timerid),window.clearInterval(this._timerid),this._timerid=0),this._videoRecorder&&(canConsole()&&console.info("_clearRecorder _videoRecorder"),this._videoRecorder.onstop=null,this._videoRecorder.ondataavailable=null,"recording"===this._videoRecorder.state&&this._videoRecorder.stop(),this._videoRecorder=null),this._chunks=[],this._audioRecorder){canConsole()&&console.info("_clearRecorder _audioRecorder");const{ctx:t,mic:e,mixer:i,processor:s}=this._audioRecorder;s.disconnect(),e.disconnect(),i.disconnect();let o={type:"cancel",msg:void 0};this._worker.postMessage(o),this._audioRecorder=null}canConsole()&&console.info("[recorder]_clearRecorder this._state",this._state),""!==this._state&&"loading"!==this._state&&(this._state="ready",this.emit("change-state"))}_stopStream(){this._stream_cam&&(canConsole()&&console.info("[recorder]_stopStream _stream_cam"),b(this._stream_cam),this._stream_cam=null),this._stream&&(canConsole()&&console.info("[recorder]_stopStream _stream"),b(this._stream),this._stream=null)}clear(){this._video.style.transform="",this._video.srcObject=null,this._video.load(),this._clearRecorder(),this._stopStream(),this._chunks.length=0,this._state="",this.emit("change-state"),this._mirror_state=0,this._isRear=!1,this._videoBnd={left:"0",top:"0",width:"100%",height:"100%"}}}!function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.LOADING=1]="LOADING",t[t.PLAYBACK_ERROR=2]="PLAYBACK_ERROR",t[t.READY=3]="READY",t[t.STANDBY=4]="STANDBY",t[t.BUFFERING=5]="BUFFERING",t[t.PAUSED=6]="PAUSED",t[t.PLAYING=7]="PLAYING"}(g||(g={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(f||(f={})),function(t){t[t.NETWORK_EMPTY=0]="NETWORK_EMPTY",t[t.NETWORK_IDLE=1]="NETWORK_IDLE",t[t.NETWORK_LOADING=2]="NETWORK_LOADING",t[t.NETWORK_NO_SOURCE=3]="NETWORK_NO_SOURCE"}(v||(v={}));class k extends p.TypedEmitter{constructor(){super(),this.m_media=null,this.m_url=null,this.m_startTime=0,this.m_endTime=0,this.m_maxTime=0,this.m_seekTime=-1,this.m_onTimer=-1,this.m_playEnded=!1,this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=-1,this.m_bPlay=!1,this.m_myState=0,this.m_duration=0,this.m_currentTime=0,this.fullscreen=!1,this.m_muted=!1,this.m_volume=1,this._onTime=t=>{this.m_onTimer>=0&&(this._onTimeUpdate(),this.m_onTimer=window.requestAnimationFrame(this._onTime))},this.m_bPlay=!1,this.m_startTime=-1,this.m_endTime=-1}get bPlay(){return this.m_bPlay}get myState(){return this.m_myState}get duration(){return this.m_duration}get muted(){return this.m_muted}get volume(){return this.m_volume}get media(){return this.m_media}get currentTime(){return this.m_currentTime}setStartEndTime(t,e){this.m_startTime=t,this.m_endTime=e}setMuted(t){this.m_muted=t,this.m_media&&(this.m_media.muted=t)}setVolume(t){this.m_volume=t,this.m_media&&(this.m_media.volume=t)}setMutedTemp(t){this.m_media&&(this.m_media.muted=t)}_initTemp(){this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=0}play(t){void 0===t&&(t=!0),this.m_bPlay=!0,t&&this._initTemp(),this.m_playEnded&&this.m_media&&this.m_myState>=3&&(this.m_media.currentTime=this.m_startTime/1e3),this.m_playEnded=!1,this._playOrPause()}pause(t){void 0===t&&(t=!0),this.m_bPlay=!1,t&&this._initTemp(),this._playOrPause()}start(){this.seek(0),this.play()}seek(t,e){if(void 0===e&&(e=!0),!this.m_media||this.m_myState<3)this.m_seekTime=t;else{if(e&&this._initTemp(),this.m_seekTime=-1,isNaN(t)||t<0)t=0;else if(t>=this.m_duration-100)return t=this.m_duration,void this._playEnded();this.m_playEnded=!1,this.m_media.currentTime=(this.m_startTime+t)/1e3,this._onTimeUpdate()}}gotoAndPlay(t,e,i){if(this.m_standBy=!1,!this.m_media||this.m_duration<=0)return this._load(),this.m_bPlay_temp=!0,this.m_startTime_temp=t,this.m_endTime_temp=e,void(this.m_loop_temp=i);this.m_playEnded=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=t,this.m_endTime_temp=e,t=t>=0?t:this.currentTime,e=e>=0&&e<this.m_duration?e:this.m_duration,this.m_bPlay=!0,t>=e||i<=0?(this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=0):(this.m_endTime_temp>=this.m_duration&&(this.m_endTime_temp=-1),this.m_loop_temp=i,this.m_loopCnt_temp=0,this.m_startTime_temp>=0&&(this.m_media.currentTime=(t+this.m_startTime)/1e3,this._onTimeUpdate())),this._playOrPause()}gotoAndPause(t,e){void 0===e&&(e=!0),this.m_bPlay=!1,e&&this._initTemp(),this.m_media&&(t=t>=0&&t<this.m_duration?t:this.currentTime,this.m_media.currentTime=(t+this.m_startTime)/1e3,this._onTimeUpdate(),this._playOrPause())}connect(){this.m_media&&this.m_url&&this.m_myState>=1&&3===this.m_media.networkState&&0===this.m_media.readyState&&(this.m_media.src=this.m_url,this.m_media.load())}unconnect(){this.m_media&&(this.m_media.paused||this.m_media.pause(),this.m_myState>=1&&(this.m_myState>=3&&(this.m_seekTime=1e3*this.m_media.currentTime-this.m_startTime),this.m_media.src="",this.m_media.load(),this.m_onTimer>=0&&(window.cancelAnimationFrame(this.m_onTimer),this.m_onTimer=-1),this.m_maxTime=0,this.m_seekTime=-1,this.m_playEnded=!1,this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=-1,this.m_bPlay=!1,this.m_duration=0,this.m_url=null,this.m_muted=!1,this.m_media.muted=!1,this.m_media.volume=1,this._setState(0)))}_load(){this.m_media&&this.m_url&&this.m_myState<1&&(this._setState(1),this.m_media.src=this.m_url,this.m_media.load())}load(t){this.m_url=t,this._load()}unload(){this.clearMedia(),this.m_url=null,this.m_bPlay=!1,this.m_bPlay_temp=!1,this.m_startTime=0,this.m_endTime=0,this.m_maxTime=0,this.m_seekTime=-1,this.m_onTimer=-1,this.m_playEnded=!1,this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=-1,this.m_duration=0,this.m_currentTime=0,this.fullscreen=!1,this.m_muted=!1,this.m_volume=1,this._setState(0)}initMedia(t){if(this.m_media||!t)return;this.m_media=t;const e=e=>{if(this.m_media&&t.duration>0){if(t.duration>1e6)return void(t.currentTime=1e6);t.muted=this.m_muted,t.volume=this.m_volume,this.m_maxTime<=0?(this.m_maxTime=1e3*t.duration,this.m_endTime>=this.m_maxTime?this.m_endTime=0:this.m_endTime>0&&(this.m_maxTime=this.m_endTime),(this.m_startTime<0||this.m_startTime>=this.m_maxTime)&&(this.m_startTime=0),this.m_duration=this.m_maxTime-this.m_startTime,this.m_bPlay_temp?(this._setState(3),this.gotoAndPlay(this.m_startTime_temp,this.m_endTime_temp,this.m_loop_temp)):this.m_seekTime>0&&this.m_seekTime<this.m_duration?(this._setState(3),this.m_media.currentTime=(this.m_seekTime+this.m_startTime)/1e3):0===this.m_startTime?(this.m_media.currentTime=0,this._setState(3),this._playOrPause()):this.m_media.currentTime=this.m_startTime/1e3,this.m_seekTime=-1):this.m_seekTime>=0&&(this.m_seekTime<this.m_duration&&(this.m_media.currentTime=(this.m_seekTime+this.m_startTime)/1e3),this.m_seekTime=-1)}};t.muted=this.m_muted,t.volume=this.m_volume,t.onabort=t=>{console.log("onabort")},t.oncanplay=e,t.oncanplaythrough=e,t.ondurationchange=e,t.onloadeddata=e,t.onloadedmetadata=e,t.onerror=t=>{1===this.m_myState&&this._setState(2)},t.onended=t=>{this.m_media&&(this.m_maxTime<=0||this.m_myState<3||this._playEnded())},t.onpause=t=>{this.m_media&&(this.m_maxTime<=0||this.m_myState<3||(this.m_bPlay=!1,this._setState(6)))},t.onplaying=t=>{this.m_media&&(this.m_maxTime<=0||this.m_myState<3||!this.m_bPlay?this.m_media.paused||this.m_media.pause():this._setState(7))},t.onseeking=t=>{!this.m_media||this.m_maxTime<=0||this.m_myState>=3&&this._setState(5)},t.onseeked=t=>{!this.m_media||this.m_maxTime<=0||(this.m_myState>=3?this._playOrPause():this.m_myState<3&&this.m_startTime>0&&(Math.abs(this.m_startTime-1e3*this.m_media.currentTime)<100?(this._setState(3),this._playOrPause()):this.m_media.currentTime=this.m_startTime/1e3))},t.ontimeupdate=t=>{this.m_myState<=2||this._onTimeUpdate()},t.onvolumechange=t=>{!this.m_media||this.m_maxTime<=0||this.emit("volume-changed",this.m_media.volume)}}clearMedia(){this.m_media&&(this.m_media.paused||this.m_media.pause(),this.m_myState>=1&&(this.m_media.src="",this.m_media.load()),this.m_media.onabort=null,this.m_media.oncanplay=null,this.m_media.oncanplaythrough=null,this.m_media.ondurationchange=null,this.m_media.onemptied=null,this.m_media.onended=null,this.m_media.onerror=null,this.m_media.onloadeddata=null,this.m_media.onloadedmetadata=null,this.m_media.onpause=null,this.m_media.onplaying=null,this.m_media.onseeked=null,this.m_media.onseeking=null,this.m_media.ontimeupdate=null,this.m_media.onvolumechange=null,this.m_media=null)}_setState(t){if(this.m_myState===t)return;7===t?this.m_onTimer<0&&(this.m_onTimer=window.requestAnimationFrame(this._onTime)):6===t&&this.m_onTimer>=0&&(window.cancelAnimationFrame(this.m_onTimer),this.m_onTimer=-1);const e=this.m_myState;this.m_myState=t,this.emit("state-changed",t,e)}_playOrPause(){if(this.m_media&&!(this.m_myState<3))if(this.m_bPlay){if(this._setState(7),this.m_media.paused){const t=this.m_media.play();t&&t.then((t=>{!this.m_media||this.m_bPlay||this.m_media.paused||this.m_media.pause()})).catch((t=>{!this.m_media||this.m_bPlay||this.m_media.paused||this.m_media.pause()}))}}else this._setState(6),this.m_media.paused||this.m_media.pause()}_onTimeUpdate(){if(!this.m_media)return;let t=1e3*this.m_media.currentTime;if(this.m_loop_temp>0&&this.m_bPlay)t<this.m_startTime?t=this.m_startTime:this.m_endTime_temp>0&&t>=this.m_endTime_temp+this.m_startTime?(this.m_currentTime=this.m_endTime_temp,this.emit("time-changed",this.m_currentTime),this._playEnded()):(this.m_currentTime=t-this.m_startTime,this.emit("time-changed",this.m_currentTime));else if(t<this.m_startTime)t=this.m_startTime;else{if(this.m_endTime>0&&t>=this.m_endTime)return this.m_currentTime=this.m_endTime-this.m_startTime,this.emit("time-changed",this.m_currentTime),void this._playEnded();this.m_currentTime=t-this.m_startTime,this.emit("time-changed",this.m_currentTime)}}_playEnded(){if(this.m_media&&!this.m_playEnded)if(this.m_loop_temp>0&&this.m_bPlay)if(this.m_loopCnt_temp++,this.m_endTime_temp<=0&&(this.m_bPlay=!1,this.emit("play-end")),this.m_loopCnt_temp<this.m_loop_temp){const t=this.m_startTime_temp>=0&&this.m_startTime_temp<this.m_duration?this.m_startTime_temp:0;this.m_media.currentTime=(t+this.m_startTime)/1e3,this.m_media.paused&&this.m_media.play()}else this.m_media.paused||this.m_media.pause(),this.m_bPlay=!1,this.emit("play-end-temp");else this.emit("play-end"),this.m_playEnded=!0,this.m_bPlay=!1,this.m_media.paused||this.m_media.pause(),1e3*this.m_media.currentTime<this.m_maxTime-100&&(this.m_media.currentTime=this.m_maxTime/1e3),this.m_currentTime=this.m_maxTime-this.m_startTime,console.log("playEnd",this.m_myState,6),this._setState(6)}reset(){}}function w(t,e=1){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}class ${constructor(t,e,i,s,o,r,n){let a=!1,d=-1,l=0,h=0;t.style.touchAction="none",t.ondragstart=t.ondrag=t=>{t.preventDefault(),t.stopImmediatePropagation()};let c=new DOMMatrix;const p=[];let m=0;const u=t=>{if(d!==t.pointerId)return;e.preventDefault&&(t.preventDefault(),t.stopImmediatePropagation());const i=c.transformPoint({x:t.clientX,y:t.clientY});if(n){const t=m++%10;p[t]={t:Date.now(),x:i.x,y:i.y}}s(i.x-l,i.y-h,t)},_=i=>{d===i.pointerId&&(e.preventDefault&&(i.preventDefault(),i.stopImmediatePropagation()),t.removeEventListener("pointermove",u,!0),t.removeEventListener("pointerup",_,!0),t.removeEventListener("pointercancel",_,!0),t.releasePointerCapture(d),d=-1,o&&o(i))},g=s=>{if(!s.isPrimary||1!==s.buttons)return;let o;const n=i(s);if("boolean"==typeof n){if(!n)return;o=!1}else{if(!n.ok)return;o=n.preventCapture}e.preventDefault&&(s.preventDefault(),s.stopImmediatePropagation()),c=function(t){if(t instanceof SVGGElement||t instanceof SVGSVGElement){const e=new DOMMatrix,i=t.getScreenCTM();return i&&(e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e.e=i.e,e.f=i.f),e}const e=[];let i=t;for(;i;)e.unshift(i),i=i.offsetParent;let s=window.scrollY,o=window.scrollX;const r=new DOMMatrix;for(let t=0;t<e.length;t++){i=e[t],r.translateSelf(i.offsetLeft-o,i.offsetTop-s);const n=window.getComputedStyle(i);if(n.transform&&n.transform.startsWith("matrix(")){let t=null;try{t=new DOMMatrix(n.transform)}catch(e){t=null}if(t&&!t.isIdentity){const e=n.transformOrigin.split(" ");let i=parseFloat(e[0]),s=parseFloat(e[1]);isNaN(i)&&(i=0),isNaN(s)&&(s=0),r.translateSelf(i,s),r.multiplySelf(t).translateSelf(-i,-s)}}s=i.scrollTop,o=i.scrollLeft}return function(t){return t.a=w(t.a,3),t.b=w(t.b,3),t.c=w(t.c,3),t.d=w(t.d,3),t.e=w(t.e,3),t.f=w(t.f,3),t}(r)}(null!=r?r:t),c.invertSelf();const a=c.transformPoint({x:s.clientX,y:s.clientY});l=a.x,h=a.y,p.length=0,m=0,d=s.pointerId,o||t.setPointerCapture(d),t.addEventListener("pointermove",u,!0),t.addEventListener("pointerup",_,!0),t.addEventListener("pointercancel",_,!0)};t.addEventListener("pointerdown",g),e.detectEnter&&t.addEventListener("pointerenter",g),a=!0,this.getSwipe=()=>{const t={vx:0,vy:0,length:0,deg:0};if(p.length<3)return t;const e=p.length;let i,s;for(let t=0;t<e;t++){let o=(m-1)%10-t;o=o<0?e+o:o;const r=p[o];if(0===t)i=r;else if(i&&r.t<i.t){s=r;break}}return i&&s&&(t.vx=(i.x-s.x)/(i.t-s.t),t.vy=(i.y-s.y)/(i.t-s.t),t.length=Math.pow(Math.pow(t.vx,2)+Math.pow(t.vy,2),.5),t.length<.2?(t.vx=0,t.vy=0,t.length=0):0===t.vx?t.deg=t.vy>0?90:-90:0===t.vy?t.deg=t.vx>0?0:180:t.vx<0&&t.vy<0?t.deg=180*Math.atan(t.vy/t.vx)/Math.PI-180:t.vx<0&&t.vy>0?t.deg=180+180*Math.atan(t.vy/t.vx)/Math.PI:t.deg=180*Math.atan(t.vy/t.vx)/Math.PI),t},this.load=()=>{a||(t.addEventListener("pointerdown",g),e.detectEnter&&t.addEventListener("pointerenter",g),a=!0)},this.unload=()=>{d>=0&&(t.releasePointerCapture(d),d=-1),p.length=0,a=!1,t.removeEventListener("pointerdown",g),t.removeEventListener("pointermove",u,!0),t.removeEventListener("pointerup",_,!0),t.removeEventListener("pointercancel",_,!0)}}}var T=i(897),S=i(685),I=function(t,e,i,s){var o,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(r<3?o(n):r>3?o(e,i,n):o(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n};const E=i(237).Z;let R=class extends T.oi{constructor(){super(...arguments),this._view=!1,this._focusIdx=-1,this._scrollIdx=-1,this._scripts=[]}static get styles(){return E}render(){return T.dy`
			<style>
				:host {
					display: ${this._view?T.iv``:T.iv`none`};
				}
			</style>
			<div class="bg"></div>
			<div class="container">
				${this._scripts.map(((t,e)=>T.dy`
						${t.no_line_break||0===e?void 0:T.dy`<br/>`}
						${t.dms_speaker?T.dy`<span class="speaker">${t.dms_speaker}:</span>`:void 0}
						<span 
							class=${`script${this._focusIdx===e?" on":""} script${e}`} 
							.innerHTML=${t.dms_eng}
						></span>
					`))}
			</div>
			
		`}$unload(){this._container&&(this._container.style.scrollBehavior="auto",this._container.scrollTop=0,this._container.style.scrollBehavior="smooth"),this._view=!1,this._focusIdx=-1,this._scrollIdx=-1,this._scripts=[],this.requestUpdate()}$setScripts(t){this._focusIdx=-1,this._scrollIdx=-1,this._scripts=t,this._view=!0,this.requestUpdate(),this._container&&(this._container.style.scrollBehavior="auto",this._container.scrollTop=0,this._container.style.scrollBehavior="smooth")}$setFocusIdx(t,e){var i;if(this._focusIdx!==t||this._scrollIdx!==e){if(this._scrollIdx!==e){const t=this._container;let s=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector(".script"+e);t&&s&&(t.scrollTop=s.offsetTop-(t.offsetHeight-s.offsetHeight)/2)}this._focusIdx=t,this._scrollIdx=e,this.requestUpdate()}}};I([(0,S.IO)(".container")],R.prototype,"_container",void 0),R=I([(0,S.Mo)("v-s-script-box")],R);var P=function(t,e,i,s){return new(i||(i=Promise))((function(o,r){function n(t){try{d(s.next(t))}catch(t){r(t)}}function a(t){try{d(s.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}d((s=s.apply(t,e||[])).next())}))};class C{constructor(t,e,i,s){this.idx=-1,this.info=t;const o=this.container=document.createElement("div");o.style.transitionProperty="bottom, transform",o.style.transitionDuration="0.3s",o.style.transformOrigin="bottom right",o.style.width="1280px",o.style.height="800px";const n=this.frame=document.createElement("iframe");n.frameBorder="0px",n.scrolling="no",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.allow="autoplay;camera;microphone";const a=t=>{var e;canConsole()&&console.info("base.student:app=>student(postMsgToFrame)",t.type,t),null===(e=n.contentWindow)||void 0===e||e.postMessage(t,"*")};let d="";const l=new x(!1),h=new k,c=(t,e,i)=>{a({type:"notifyRecordPlayerState",from:"launcher",msg:{bPlay:t,time:e,duration:i}})};h.on("state-changed",((t,e)=>{"video"===d&&l.zIndexTop&&c(h.bPlay,h.currentTime,h.duration)})),h.on("time-changed",(t=>{"video"===d&&l.zIndexTop&&c(h.bPlay,h.currentTime,h.duration)})),h.on("play-end",(()=>{"video"===d&&l.zIndexTop&&c(!1,h.currentTime,h.duration)}));const p=document.createElement("div"),u=document.createElement("video"),_=l.video;p.appendChild(_),p.appendChild(u),p.style.position="absolute",p.style.visibility="hidden",_.style.position="absolute",_.style.left="0",_.style.top="0",_.style.width="100%",_.style.height="100%",_.style.pointerEvents="none",u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%",u.style.pointerEvents="none",u.style.display="none",h.initMedia(u),o.appendChild(p),o.appendChild(n),l.on("recorded",(t=>{"video"===d&&l.zIndexTop&&(u.style.display="",h.load(t))})),l.on("change-state",(()=>{"ready"!==l.state&&(h.unconnect(),u.style.display="none"),"video"===d&&l.zIndexTop?p.style.zIndex="1":p.style.zIndex="-1"})),l.on("record-time",(t=>{c(!1,t,t)}));const g=o.appendChild(document.createElement("button"));g.innerText="send",g.style.position="absolute",g.style.display="none",g.style.zIndex="1",g.onclick=t=>{"none"!==g.style.display&&a({type:"clickSendButton",from:"launcher",msg:void 0})};const f=o.appendChild(document.createElement("v-s-script-box")),v=o.appendChild(document.createElement("div"));v.className="loading",v.style.position="absolute",v.style.left="0px",v.style.right="0px",v.style.top="0px",v.style.bottom="0px",v.style.display="none",v.style.zIndex="2",v.style.backgroundColor="rgba(0, 0, 0, 0.3)";let y=0,b=0,w=0,T=0,S=0,I=0;new $(p,{preventDefault:!0},(t=>"video"===d&&!!l.zIndexTop&&(S=o.offsetWidth,I=o.offsetHeight,y=p.offsetLeft,b=p.offsetTop,w=p.offsetWidth,T=p.offsetHeight,!0)),((t,e,i)=>{let s=y+t;s<0?s=0:s+w>S&&(s=S-w);let o=b+e;o<0?o=0:o+T>I&&(o=I-T),p.style.left=s+"px",p.style.top=o+"px"}));const E=o.appendChild(document.createElement("div"));E.style.position="absolute",E.style.left="0px",E.style.right="0px",E.style.top="0px",E.style.bottom="0px",E.style.display="none",E.style.zIndex="3",E.style.backgroundColor="rgba(0, 0, 0, 0)",E.onclick=()=>{this.idx<0||i(this)},this.focus=()=>(this.idx=-1,o.style.position="absolute",o.style.right="0",o.style.bottom="0",o.style.transform="scale(1)",E.style.display="none",this),this.blur=t=>(this.idx=t,o.style.position="absolute",o.style.right="0",o.style.bottom=800+200*(t-1)+"px",o.style.transform="scale(0.25)",E.style.display="",this),this.handlePostMessage=i=>P(this,void 0,void 0,(function*(){var o,c;if(i.source!==n.contentWindow)return!1;const u=i.data;if(!u||!u.type||!u.from)return!0;switch(canConsole()&&console.info("base.student:student=>app",u.type,u),u.type){case"getServerHost":a({type:"notifyServerHost",from:"launcher",msg:{host:""}});break;case"getAllStudentsProfile":a({type:"notifyAllStudentsProfile",from:"launcher",msg:s()});break;case"getLoginStudentsProfile":a({type:"notifyLoginStudentsProfile",from:"launcher",msg:s()});break;case"init":{v.style.display="none",g.style.display="none";const e={type:"notifyStartContent",from:"launcher",msg:{myInfo:Object.assign({},t),addOnHost:"",bookid:1,contentProgress:0,lesson:"Lesson",step:"Step",curriculumId:1}};a(e)}break;case"getMyProfile":{const e={type:"notifyMyProfile",from:"launcher",msg:Object.assign({},t)};a(e)}break;case"sendMsgToTeacher":(t=>{canConsole()&&console.info("base.student:app=>teacher(postMsgToTeacher)",t.type,t),e.postMessage(t,"*")})({type:"notifyReceiveMsg",from:"launcher",msg:u.msg});break;case"uploadStudentReport":{let e=u.msg,i={type:"notifyStudentReport",from:"launcher",fromId:"S"+t.id,msg:e};window.top.postMessage(i,"*")}break;case"startCamera":case"startCustomCamera":{let t,e="",i=!1,s=!1,o=!1,r=!1;if("startCustomCamera"===u.type)t=u.msg,i=!!t.rearCamera,s=!!t.zIndexTop,o=!!t.draggable,r=!!t.notifyRecordTime;else{const e=u;t={left:0,top:0,width:0,height:0},void 0===e.msg?i=!1:"boolean"==typeof e.msg?i=e.msg:"object"==typeof e.msg&&(i=!!e.msg.rearCamera,r=!!e.msg.notifyRecordTime)}l.setUI(t,s,o,r);let n=l.videoBnd;p.style.visibility="visible",p.style.left=n.left,p.style.top=n.top,p.style.width=n.width,p.style.height=n.height,d="video",l.initRecord("video",(t=>P(this,void 0,void 0,(function*(){if(void 0===t)return;!1===t&&alert("Camera is not working. Please check the system settings."),e=t?"success":"",yield m(50);const i={type:"notifyStartCamera",from:"launcher",msg:{result:e,videoId:l.video.id}};a(i)}))),i)}break;case"stopCamera":{const t=()=>{"saving"===l.state?setTimeout(t,300):(d="",p.style.visibility="hidden",l.clear(),a({type:"notifyStopCamera",from:"launcher",msg:{result:"success"}}))};t()}break;case"switchCamera":{const t=u;l.toggleCam(t.msg,(t=>{a({type:"notifySwitchCamera",from:"launcher",msg:{result:t?"success":"fail"}})}))}break;case"startVideoRecord":for(;"loading"===l.state||"starting"===l.state;)yield m(100);l.initRecord("video",(t=>P(this,void 0,void 0,(function*(){void 0!==t&&(t&&(t=yield l.record()),a(t?{type:"notifyStartVideoRecord",from:"launcher",msg:{result:"success"}}:{type:"notifyVideoRecordCanceled",from:"launcher",msg:{url:""}}))}))),void 0);break;case"stopVideoRecord":{let t=yield l.stopAndSave();t&&t.length<16&&(t=null),canConsole()&&console.log("base.student:[recorder]this.recorder.stopAndSave",t),a({type:"notifyVideoRecordResult",from:"launcher",msg:{result:t?"success":"fail",url:null!=t?t:""}})}break;case"takePicture":{const t=u.msg,e=t=>{let e="",i="";if(t&&""!==t){const s=t.split(",");s.length>1&&(s.shift(),i=s.join(","),e="success")}a({type:"notifyTakePicture",from:"launcher",msg:{result:e,url:t,src:i}})};let i=t.rearCamera;l.initRecord("video",(i=>{void 0!==i&&(i?l.capture(t,1280,800,e):!1===i&&e(""))}),i)}break;case"startVoiceRecord":{const t=u;let e="";d="voice",p.style.visibility="hidden",l.setUI({left:0,top:0,width:0,height:0},!1,!1,!!t.msg),l.initRecord("voice",(t=>P(this,void 0,void 0,(function*(){void 0!==t&&(t&&(t=yield l.record()),e=t?"success":"",a({type:"notifyStartVoice",from:"launcher",msg:{result:e}}))}))),void 0)}break;case"stopVoiceRecord":{d="",p.style.visibility="hidden";let t=yield l.stopAndSave();t&&t.length<16&&(t=null),a({type:"notifyVoiceRecordResult",from:"launcher",msg:{result:t?"success":"fail",url:null!=t?t:""}}),l.clear()}break;case"playRecordPlayer":if("video"!==d)return!0;if(!l.zIndexTop)return!0;h.play();break;case"pauseRecordPlayer":h.pause();break;case"viewOrHideRecordPlayer":{const t=u.msg;p.style.visibility="hide"===t.command?"hidden":"visible"}break;case"uploadFileToServer":{const t={type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:u.msg.url}};a(t)}break;case"uploadImageToServer":{const t={type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:u.msg.src}};a(t)}break;case"uploadFileToServerMulti":{let t=u;console.log("smsg=>uploadFileToServerMulti",t);const e=[];t.msg.forEach((t=>{r.isString(t)?e.push({result:"success",url:t}):t&&r.isString(t.url)&&e.push({result:"success",url:t.url})})),a({type:"notifyUploadToServerMultiResult",from:"launcher",msg:e})}break;case"showLoading":{let t=u.msg;v.style.display=t?"":"none"}break;case"showSendButton":{let t=u.msg;r.isBoolean(t)?(g.style.display=t?"":"none",g.style.bottom="20px",g.style.right="20px"):(void 0!==t.view&&(g.style.display=t.view?"":"none"),g.style.bottom=(null!==(o=t.bottom)&&void 0!==o?o:0)+"px",g.style.right=(null!==(c=t.right)&&void 0!==c?c:0)+"px")}break;case"unloadScript":f.$unload();break;default:console.warn("stundent message ",u)}return!0})),this.handleWssMessage=t=>{if("notifyEtcMsg"===t.type){const e=t.msg;switch(e.etcType){case"sendScript":{const t=e;f.$setScripts(t.etcMsg)}break;case"changedFocusIdx":{const t=e;f.$setFocusIdx(t.etcMsg.focusIdx,t.etcMsg.scrollIdx)}break;case"endScript":f.$unload()}}}}}let M="",O="",B="",N="";function L(t){if(!t)return;0!==t.indexOf(M)&&(t=M+t);const e=A(t);e.currentTime=0,e.paused&&e.play().catch((t=>{console.log(t)}))}function A(t){if(!t)throw"url is empty";const e=function(){let t=window["k-effect-sound-map"];return t||(t=new Map,window["k-effect-sound-map"]=t),t}();0!==t.indexOf(M)&&(t=M+t);let i=e.get(t);if(!i){let s=document.getElementById("k-effect-sound-bound");s||(s=document.body.appendChild(document.createElement("div")),s.id="k-effect-sound-bound",s.style.position="absolute",s.style.top="0px"),i=document.createElement("audio"),i.autoplay=!1,i.preload="auto",i.src=t,i.oncanplaythrough=()=>{i&&(i.oncanplaythrough=null)},i.load(),e.set(t,i)}return i}function z(){L(B)}var U=i(845),D=i(14),F=i(224);function W(t){return new Promise((e=>{setTimeout((()=>e()),t)}))}!function*(){let t=0;for(;;){const e=Date.now();e>t?t=e:t+=1,yield t}}(),(()=>{const t=document.createElement("style");t.innerHTML=" ",document.getElementsByTagName("head")[0].appendChild(t),t.sheet})();const j=T.iv`:host slot{position:absolute;display:block;left:0;width:100%;top:0;height:100%;pointer-events:none;opacity:0;transform:scale(.2,.2);transition:transform .3s,opacity .3s}:host slot.open{pointer-events:unset;opacity:1;transform:scale(1,1);transition:transform .3s cubic-bezier(.405,.42,.135,1.2)}:host slot.closing{pointer-events:unset;opacity:0;transform:scale(.2,.2);transition:transform .3s,opacity .3s}:host slot.closed{display:none}`;var q=function(t,e,i,s){var o,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(r<3?o(n):r>3?o(e,i,n):o(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n};let H=class extends T.oi{constructor(){super(...arguments),this._view=!1,this.$view=!1,this.$zindex=-1,this.$pointerEvents="all",this.$background="transparent",this._class="closed"}static get styles(){return[j]}render(){return T.dy`<slot 
				class="${this._class}" 
				style="z-index: ${this.$zindex}; pointer-events: ${this.$pointerEvents}; background-color: ${this.$background}"></slot>`}shouldUpdate(t){const e=super.shouldUpdate(t);return this._view!==this.$view&&(this.$view?(this._class="",setTimeout((()=>this._class="open"),10)):(this._class="closing",setTimeout((()=>this._class="closed"),300)),this._view=this.$view),e}};q([(0,S.Cb)({type:Boolean})],H.prototype,"$view",void 0),q([(0,S.Cb)({type:Number})],H.prototype,"$zindex",void 0),q([(0,S.Cb)()],H.prototype,"$pointerEvents",void 0),q([(0,S.Cb)()],H.prototype,"$background",void 0),q([(0,S.SB)()],H.prototype,"_class",void 0),H=q([(0,S.Mo)("v-cover-popup")],H);var V=function(t,e,i,s){var o,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(r<3?o(n):r>3?o(e,i,n):o(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n},Z=function(t,e,i,s){return new(i||(i=Promise))((function(o,r){function n(t){try{d(s.next(t))}catch(t){r(t)}}function a(t){try{d(s.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}d((s=s.apply(t,e||[])).next())}))};function G(t){t=Math.round(t/1e3);const e=Math.floor(t/60),i=t%60;let s,o;return s=e<10?"0"+e:""+e,o=i<10?"0"+i:""+i,s+":"+o}let K,Y,X;U.Z.use([D.Z,F.Z]);let Q="";function J(t){return Z(this,void 0,void 0,(function*(){if(Q===t)return;Q=t;const e=yield Promise.all([fetch(`./report/${t}/report-detail.css`),fetch(`./report/${t}/report-detail-item.css`),fetch(`./report/${t}/report-progress.css`)]),i=yield Promise.all([e[0].text(),e[1].text(),e[2].text()]);K=T.dy`<style>${i[0]}</style>`,Y=T.dy`<style>${i[1]}</style>`,X=T.dy`<style>${i[2]}</style>`}))}let tt=class extends T.oi{constructor(){super(),this.$ratio=0,this.$min=-1,this.$max=-1,this._mouseRatio=-1,this._pid=-1;let t=0,e=-1;const i=t=>{e=t,this.dispatchEvent(new CustomEvent("change",{detail:t}))},s=r.throttle((t=>{t>=0&&this._pid>=0&&i(t)}),500,{leading:!1,trailing:!0});this.addEventListener("pointerdown",(i=>{if(this._pid>=0)return;if(!i.isPrimary)return;if(1!==i.buttons)return;e=-1,t=this.offsetWidth;let o=i.offsetX/t;this.$min>=0&&o<this.$min?o=this.$min:this.$max>=0&&o>this.$max&&(o=this.$max),o<0?o=0:o>1&&(o=1),this._mouseRatio=o,this._pid=i.pointerId,this.setPointerCapture(this._pid),s(o)})),this.addEventListener("pointermove",(e=>{if(this._pid<0)return;if(!e.isPrimary)return;if(1!==e.buttons)return;let i=e.offsetX/t;this.$min>=0&&i<this.$min?i=this.$min:this.$max>=0&&i>this.$max&&(i=this.$max),i<0?i=0:i>1&&(i=1),this._mouseRatio=i,s(i)}));const o=o=>{if(this._pid<0)return;this.releasePointerCapture(this._pid),this._pid=-1;let r=o.offsetX/t;this.$min>=0&&r<this.$min?r=this.$min:this.$max>=0&&r>this.$max&&(r=this.$max),r<0?r=0:r>1&&(r=1),(r<e-.01||r>e+.01)&&(this._mouseRatio=r,s.cancel(),i(r))};this.addEventListener("pointerup",o),this.addEventListener("pointercancel",o)}render(){return T.dy`
			${X}
			<div class="box"><div style=${`width: ${100*this.$ratio}%`}></div></div>
			<div class="btn" style=${`left:${100*(this._mouseRatio>=0?this._mouseRatio:this.$ratio)}%`}></div>
		`}shouldUpdate(t){return t.has("$ratio")&&this._pid<0&&(this._mouseRatio=-1),super.shouldUpdate(t)}};V([(0,S.Cb)({type:Number})],tt.prototype,"$ratio",void 0),V([(0,S.Cb)({type:Number})],tt.prototype,"$min",void 0),V([(0,S.Cb)({type:Number})],tt.prototype,"$max",void 0),V([(0,S.SB)()],tt.prototype,"_mouseRatio",void 0),tt=V([(0,S.Mo)("v-r-video-progress")],tt);const et={cur:0,max:0,flip:null,updateFlip:null};let it=class extends T.oi{constructor(){super(...arguments),this.$item={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future",this._imgs=[],this._scroll=!1,this._swiper=null,this._onIdx=t=>{et.cur!==t&&(z(),et.cur=t,et.updateFlip&&et.updateFlip(),this.requestUpdate())},this._imgLoad=t=>Z(this,void 0,void 0,(function*(){const t=this._img;if(t instanceof HTMLImageElement&&t.naturalWidth>0&&this._swiper&&this._swiper.el){yield W(100);const e="oxford"===Q,i=this._swiper.el,s=i.offsetWidth-(e?36:0),o=i.offsetHeight;t.style.verticalAlign="top";const r=Math.min(s,t.naturalWidth);let n=t.naturalHeight*r/t.naturalWidth;const a=n/o;a>=.9&&a<1.1&&(n=o),t.style.opacity="1",n<=o?(this._scroll=!1,i.classList.add("swiper-no-swiping"),t.style.top=e?(o-n)/2+"px":"0px"):(this._scroll=!0,t.style.top="0px",i.classList.remove("swiper-no-swiping")),t.setAttribute("width",r+"px"),t.setAttribute("height",n+"px")}this._delayUpdate(),yield W(300),this._delayUpdate()}))}render(){const t=et.cur<=et.max?this._imgs[et.cur]:"";return T.dy`
			${Y}
			<div class="swiper-container">
				<div class="swiper-wrapper">
					<div class="swiper-slide">
						<img class="image-view" .src=${t} .draggable=${!1} @load=${this._imgLoad}>
					</div>
				</div>
				<div class="swiper-scrollbar"></div>
			</div>
			<div class="navi ${this._imgs.length<2?"d-none":""}">
				${this._imgs.map(((t,e)=>T.dy`<button class="${e===et.cur?"on":""}" @click=${()=>this._onIdx(e)}>${e+1}</button>`))}
			</div>
		`}shouldUpdate(t){const e=super.shouldUpdate(t),i=this.$item.content;let s;return s=i?r.isArray(i.value)?i.value:[i.value]:[],r.isEqual(s,this._imgs)?console.log("aaaaaaaaa=>",s):(this._imgs=[...s],et.cur=0,et.max=this._imgs.length-1,et.updateFlip&&et.updateFlip(),this._delayUpdate()),e}firstUpdated(t){var e;super.firstUpdated(t),et.flip=this._onIdx,this._swiper&&this._swiper.destroy(!0),et.cur=0,this._scroll=!1;const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".swiper-container"),s=i.querySelector(".swiper-scrollbar");this._swiper=new U.Z(i,{direction:"vertical",resizeObserver:!0,slidesPerView:"auto",freeMode:!0,scrollbar:{el:s,draggable:!0,snapOnRelease:!1},mousewheel:!0})}disconnectedCallback(){super.disconnectedCallback(),this._swiper&&(this._swiper.destroy(!0),this._swiper=null),et.cur=0,et.max=0,this._scroll=!1,this._imgs.length=0}_delayUpdate(){setTimeout((()=>{this._swiper&&(this._swiper.update(),this._swiper.updateSize(),this._swiper.scrollbar.updateSize())}),300)}};V([(0,S.IO)(".image-view")],it.prototype,"_img",void 0),V([(0,S.Cb)({type:Object})],it.prototype,"$item",void 0),V([(0,S.Cb)({type:String})],it.prototype,"$subTheme",void 0),it=V([(0,S.Mo)("v-r-detail-image")],it);const st=new k;let ot=class extends T.oi{constructor(){super(),this.$type=5,this.$item={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future",this._timeRatio=0,this._isFullscreen=!1,this.onChangeTime=t=>{const e=t.detail*st.duration;st.seek(e)},this.onChangeVolume=t=>{st.setMuted(!1),st.setVolume(t.detail)},this._togglePlay=()=>{st.bPlay?st.pause():st.play()},this._toggleFull=()=>{this._isFullscreen=!this._isFullscreen,this.dispatchEvent(new CustomEvent("change-fullscreen",{detail:this._isFullscreen})),this.requestUpdate()},this._stop=()=>{st.bPlay&&st.pause(),st.seek(0)},this._rewind=()=>{st.seek(st.currentTime-3e3)},this._fastFwd=()=>{st.seek(st.currentTime+3e3)},this._toggleMute=()=>{st.setMuted(!st.muted),this.requestUpdate()}}render(){const t=st,e=st.bPlay||6!==st.myState;return T.dy`
			${Y}
			<div class="item-detail ${this.$subTheme} ${4===this.$type?"audio":"video"} ${this._isFullscreen?"fullscreen":""}">
				<div>
					<video 
						preload="metadata"
						poster = "${4===this.$type?`./report/${Q}/images/bg_sound.png`:""}"
					></video>
					<div class="video_controls_wrap video_controls">
						<div class="controls control">
							<div class="progress">
								<v-r-video-progress class="time-prog" .$ratio=${this._timeRatio} @change=${this.onChangeTime}></v-r-video-progress>
								<!-- DragBar onChanged={this._changedTime} current={$player.viewTime} max={$player.duration} / -->
								<div class="timer"><em class="curtime">${G(t.currentTime)}</em> / <em class="fulltime">${G(t.duration)}</em></div>
								<button class=${"sound-btn"+(t.muted||0===t.volume?" mute":"")} @click=${this._toggleMute}></button>
								<v-r-video-progress class="volume-prog" .$ratio=${t.muted?0:t.volume} @change=${this.onChangeVolume}></v-r-video-progress>
							</div>

							<div class="controlbtn">
								<button class=${e?"pause":"play"} @click=${this._togglePlay}></button>
								<button class="stop" @click=${this._stop}></button>
								<button class="rew" @click=${this._rewind}></button>
								<button class="fastFwd" @click=${this._fastFwd}></button>
								<button class="screen ${this._isFullscreen?"full":""}" @click=${this._toggleFull}></button>
							</div>
						</div>
					</div>
				</div>
			</div>
		`}disconnectedCallback(){super.disconnectedCallback(),this._isFullscreen&&(this._isFullscreen=!1,this.dispatchEvent(new CustomEvent("change-fullscreen",{detail:this._isFullscreen}))),st.removeAllListeners(),st.unload()}firstUpdated(t){var e;super.firstUpdated(t),et.flip=null,et.cur=0,et.max=0,this._video&&(st.on("volume-changed",(t=>{this.requestUpdate()})),st.on("state-changed",((t,e)=>{3===t&&(st.setMuted(!1),this._timeRatio=st.currentTime/st.duration),this.requestUpdate()})),st.on("time-changed",(()=>{this._timeRatio=st.currentTime/st.duration,this.requestUpdate()})),st.initMedia(this._video),st.load(null===(e=this.$item.content)||void 0===e?void 0:e.value))}};V([(0,S.IO)("video")],ot.prototype,"_video",void 0),V([(0,S.Cb)({type:Number})],ot.prototype,"$type",void 0),V([(0,S.Cb)({type:Object})],ot.prototype,"$item",void 0),V([(0,S.Cb)({type:String})],ot.prototype,"$subTheme",void 0),ot=V([(0,S.Mo)("v-r-detail-media")],ot);let rt=class extends T.oi{constructor(){super(...arguments),this.$item={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future"}render(){var t;const e=null===(t=this.$item.content)||void 0===t?void 0:t.value;let i;return i=Array.isArray(e)?e.join(","):"string"==typeof e?e:"",T.dy`
			${Y}
			<div class="text-view">
				<div class="tarea-bg"></div>
				<textarea 
					autocapitalize="off" 
					autocomplete="off"  
					spellcheck="false" 
					inputmode="none"
					disabled
					
				>${i}</textarea>
			</div>

		`}};V([(0,S.Cb)({type:Object})],rt.prototype,"$item",void 0),V([(0,S.Cb)({type:String})],rt.prototype,"$subTheme",void 0),rt=V([(0,S.Mo)("v-r-detail-text")],rt);let nt=class extends T.oi{constructor(){super(...arguments),this.$view=!1,this.$type=0,this.$subTheme="future",this._view=!1,this._clickName=!1,this._clickThumb=!1,this._videoFullscreen=!1,this._item=null,this._items=[],this._toggleThumbClick=t=>{t.preventDefault(),t.stopImmediatePropagation(),this._clickThumb=!this._clickThumb,this._clickName=!1,this.requestUpdate()},this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&e.offsetWidth>=e.scrollWidth||(this._clickName=!this._clickName,this.requestUpdate())},this._onFullscreen=t=>{},this._canNaviNext=!1,this._canNaviPrev=!1,this._flipNext=()=>Z(this,void 0,void 0,(function*(){if(!this._item)return;if(!this.$view)return;const t=this._items.indexOf(this._item);yield this._flip(t+1)})),this._flipPrev=()=>Z(this,void 0,void 0,(function*(){if(!this._item)return;if(!this.$view)return;const t=this._items.indexOf(this._item);yield this._flip(t-1)})),this._flip=t=>Z(this,void 0,void 0,(function*(){const e=this._items[t];e&&(this._item=null,this._clickName=!1,this._clickThumb=!1,this.requestUpdate(),yield W(100),this._item=e,this.$setFlipButton())})),this.$setFlipButton=()=>{if(!this._item)return;if(!this.$view)return;const t=this._items.indexOf(this._item);this._canNaviPrev=t>0,this._canNaviNext=t<this._items.length-1,this.requestUpdate()},this._sendStamp=()=>{this._item&&(z(),this.dispatchEvent(new CustomEvent("send-stamp",{detail:this._item.id})))},this._close=()=>{z(),this.$close()},this.$close=()=>{this.$view?(this.$view=!1,setTimeout((()=>{this._clickName=!1,this._clickThumb=!1,this._item=null,this.requestUpdate()}),300)):(this._clickName=!1,this._clickThumb=!1)}}render(){let t,e,i,s,o=this.$type;if(this._item){const o=at(this._item,this._clickThumb);t=o.thumbnail,e=o.showName,i=o.realName,s=this._item.gender}else e="",t="",i="",s="",o=0;return T.dy`
			${K}
			<v-cover-popup .$view=${this.$view} .$zindex=${60}>
				<div class="report-detail ${this.$subTheme}">

					${this.$view?(r=this._item,n=o,a=this.$subTheme,d=5===this.$type?this._onFullscreen:void 0,null===r?void 0:4===n||5===n?T.dy`<v-r-detail-media .$type=${n} .$item=${r} .$subTheme=${a} @change-fullscreen=${d} ></v-r-detail-media>`:3===n||7===n?T.dy`<v-r-detail-image .$item=${r} .$subTheme=${a}></v-r-detail-image>`:2===n?T.dy`<v-r-detail-text .$item=${r} .$subTheme=${a}></v-r-detail-text>`:void 0):void 0}
					<div class="stu_profile">
						<p @click=${this._toggleThumbClick}>${t?T.dy`<img src=${t} class=""  />`:T.dy`<span class="thumb-name ${s}"><b>${e}</b></span>`}
						</p>
						${this._clickName?T.dy`<marquee .scrollDelay=${10} class="user-name" @click=${this._toggleClick}>${i}</marquee>`:T.dy`<span class="user-name" @click=${this._toggleClick}>${i}</span>`}
					</div>
					<div class="navi left">
						<button class="btn-next" .disabled=${!this._canNaviNext} draggable="false" @click=${this._flipNext}></button>
						<button class="btn-prev" .disabled=${!this._canNaviPrev} draggable="false" @click=${this._flipPrev}></button>
					</div>
					<div class="navi right">
						<button class="btn-next" .disabled=${!this._canNaviNext} draggable="false" @click=${this._flipNext}></button>
						<button class="btn-prev" .disabled=${!this._canNaviPrev} draggable="false" @click=${this._flipPrev}></button>
					</div>
					
					<button class="stamp ${this.$subTheme}" @click=${this._sendStamp}></button>
					<button class="goback ${this.$subTheme}" @click=${this._close}></button>
				</div>		
			</v-cover-popup>
		`;var r,n,a,d}firstUpdated(t){super.firstUpdated(t),et.updateFlip=this.$setFlipButton}shouldUpdate(t){const e=super.shouldUpdate(t);return this.$view!==this._view&&(this._view=this.$view),e}$setItem(t,e){this._items=e,this._item=t}};function at(t,e){const{nickName:i,name:s,profileThumbnail:o,thumbnail:r,displayMode:n,noImage:a}=t;let d,l,h,c=n;return e&&(c="2"===c?"1":"2"),"2"===c?(d=l=i,h=o||""):(d=l=s,h=a||!r?"":r),h||(l=l.substring(0,2).toUpperCase()),{realName:d,showName:l,thumbnail:h}}V([(0,S.Cb)({type:Boolean})],nt.prototype,"$view",void 0),V([(0,S.Cb)({type:Number})],nt.prototype,"$type",void 0),V([(0,S.Cb)({type:String})],nt.prototype,"$subTheme",void 0),nt=V([(0,S.Mo)("v-report-detail")],nt);var dt=function(t,e,i,s){var o,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(r<3?o(n):r>3?o(e,i,n):o(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n},lt=function(t,e,i,s){return new(i||(i=Promise))((function(o,r){function n(t){try{d(s.next(t))}catch(t){r(t)}}function a(t){try{d(s.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}d((s=s.apply(t,e||[])).next())}))};U.Z.use([D.Z,F.Z]);let ht,ct,pt="";const mt=1e6;class ut extends T.oi{constructor(){super(...arguments),this.$info={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future",this._duration="00:00",this._viewPlayBtn=!1,this._progress=0,this._onMeta=t=>{const e=t.target;e.duration>mt&&(e.currentTime=mt)},this._onDuration=t=>{const e=t.target,i=Math.round(e.duration);i<mt?(this._duration=function(t){const e=Math.floor(t/60),i=t%60;let s,o;return s=e<10?"0"+e:""+e,o=i<10?"0"+i:""+i,s+":"+o}(i),this._viewPlayBtn=!0,e.currentTime=0,this._progress=0):this._viewPlayBtn=!1,this.requestUpdate()},this._onTime=t=>{const e=t.target;let i=100*e.currentTime/e.duration;isNaN(i)||i<0?i=0:i>100&&(i=100),this._progress=i,this.requestUpdate()}}}dt([(0,S.Cb)({type:Object})],ut.prototype,"$info",void 0),dt([(0,S.Cb)({type:String})],ut.prototype,"$subTheme",void 0);let _t=class extends ut{constructor(){super(...arguments),this.$subType=void 0,this.$opened=!1,this._clickName=!1,this._inited=!1,this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&e.offsetWidth>=e.scrollWidth||(this._clickName=!this._clickName)},this._onLoad=t=>{this._calc()},this._calc=()=>{if(this._inited)return;if(!this.$opened||!this._img)return;const t=this._img,e=t.parentElement;if(!e)return;this._inited=!0;const i=e.offsetWidth,s=e.offsetHeight,o=Math.min(i,t.naturalWidth),r=t.naturalHeight*o/t.naturalWidth;e.style.alignItems=r>s?"start":"center",t.style.opacity="1"}}render(){var t;const{content:e,gender:i}=this.$info;let s,o;e?(s="",o=r.isArray(e.value)?e.value[0]:e.value):(s="dis",o="");const n=at(this.$info),{thumbnail:a,showName:d,realName:l}=n;return T.dy`
			${ct}
			<div class="top ${s}">
					<div class="thumb thumb-image ${null!==(t=this.$subType)&&void 0!==t?t:""}"><img .src=${o} @load=${this._onLoad}></div>
			</div>
			<div class="bottom ${s}">
				${a?T.dy`<img src="${a}" class="user-img ${this.$subTheme}" >`:T.dy`<span class="thumb-name ${this.$subTheme} ${i}">${d}</span>`}
				${this._clickName?T.dy`<marquee .scrollDelay=${10} class="user-name" @click=${this._toggleClick}>${l}</marquee>`:T.dy`<span class="user-name" @click=${this._toggleClick}>${l}</span>`}
			</div>
		`}updated(t){super.updated(t),this._calc()}disconnectedCallback(){super.disconnectedCallback(),this._inited=!1}};dt([(0,S.IO)(".top .thumb img")],_t.prototype,"_img",void 0),dt([(0,S.Cb)()],_t.prototype,"$subType",void 0),dt([(0,S.Cb)({type:Boolean})],_t.prototype,"$opened",void 0),dt([(0,S.SB)()],_t.prototype,"_clickName",void 0),_t=dt([(0,S.Mo)("v-r-item-image")],_t);let gt=class extends ut{constructor(){super(...arguments),this.$type=5,this._clickName=!1,this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&e.offsetWidth>=e.scrollWidth||(this._clickName=!this._clickName)}}render(){const{content:t,gender:e}=this.$info;let i,s;t?(i="",s=t.value):(i="dis",s="");const o=at(this.$info),{thumbnail:r,showName:n,realName:a}=o;return T.dy`
			${ct}
			<div class="top ${i}">
					<video
						class="thumb ${5===this.$type?"video":"audio"}"
						preload="auto"	
						.autoplay=${!1}
						@loadedmetadata=${this._onMeta}
						@durationchange=${this._onDuration}
						@timeupdate=${this._onTime}
						src="${s}"
					></video>
					<button type="button" class="play-btn ${this._viewPlayBtn?"":" d-none"}"></button>
					<div class="time">${this._duration}</div>
			</div>
			<div class="bottom ${i}">
				${r?T.dy`<img src="${r}" class="user-img ${this.$subTheme}">`:T.dy`<span class="thumb-name ${this.$subTheme} ${e}">${n}</span>`}
				${this._clickName?T.dy`<marquee .scrollDelay=${10} class="user-name" @click=${this._toggleClick}>${a}</marquee>`:T.dy`<span class="user-name" @click=${this._toggleClick}>${a}</span>`}
			</div>
		`}};dt([(0,S.Cb)({type:Number})],gt.prototype,"$type",void 0),dt([(0,S.IO)("video")],gt.prototype,"_media",void 0),dt([(0,S.SB)()],gt.prototype,"_clickName",void 0),gt=dt([(0,S.Mo)("v-r-item-media")],gt);let ft=class extends ut{constructor(){super(...arguments),this.$type=6,this._clickName=!1,this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&e.offsetWidth>=e.scrollWidth||(this._clickName=!this._clickName)}}render(){const{content:t,gender:e}=this.$info;let i;i=t?"type6":"type6 dis",2===this.$type&&(i+=" type-text");const s=at(this.$info),{thumbnail:o,showName:r,realName:n}=s;return T.dy`
			${ct}
			<div class="bottom ${i}">
				${o?T.dy`<img src="${o}" class="user-img ${this.$subTheme}">`:T.dy`<span class="thumb-name ${this.$subTheme} ${e}">${r}</span>`}

				${2===this.$type?T.dy`<span class="ico-text"></span>`:void 0}
				${this._clickName?T.dy`<marquee .scrollDelay=${10} class="user-name" @click=${this._toggleClick}>${n}</marquee>`:T.dy`<span class="user-name" @click=${this._toggleClick}>${n}</span>`}
				
			</div>
		`}};dt([(0,S.Cb)({type:Number})],ft.prototype,"$type",void 0),dt([(0,S.SB)()],ft.prototype,"_clickName",void 0),ft=dt([(0,S.Mo)("v-r-item-type6")],ft);let vt=class extends T.oi{constructor(){super(...arguments),this._viewList=!1,this._viewMenu=!1,this._viewListOpened=!1,this._total=[],this._returns=[],this._type=0,this._viewType="C",this._subTheme="future",this._swiper=null,this._onSendStamp=t=>{this.dispatchEvent(new CustomEvent("send-stamp",{detail:t.detail}))},this._itemClick=t=>{this._detail&&t.content&&(z(),this._detail.$setItem(t,this._returns),this._detail.$type=this._type,this._detail.$view=!0,this._detail.$setFlipButton())},this._close=()=>{z(),this.$close()}}get $viewList(){return this._viewList}get $viewMenu(){return this._viewMenu}get $type(){return this._type}get $viewType(){return this._viewType}render(){const t=this._total,e=this._returns;let i;return i=4===this._type?"sound_list":5===this._type?"mov_list":3===this._type?"image_list":2===this._type?"stu_list text_list":"stu_list",T.dy`
			${ht}
			<v-cover-popup .$view=${this._viewList} .$zindex=${60}>
				<div class="report-wrap">
					<div class="report-list ${this._subTheme}">
						<div class="user-num"><span class="submitted">${e.length}</span> <span class="slash">/</span> <span class="total">${t.length}</span></div>

						<div class="swiper-container submit-wrap ${i} ${this._subTheme}">
							<div class="swiper-wrapper" >
								<ul class="swiper-slide submit-list ">
									${e.map((t=>function(t,e,i,s,o,r){return 4===e||5===e?T.dy`<li><v-r-item-media .$type=${e} .$info=${t} .$subTheme=${s} @click=${()=>r(t)}></v-r-item-media></li>`:6===e?T.dy`<li><v-r-item-type6 .$type=${e} .$info=${t} .$subTheme=${s}></v-r-item-type6></li>`:2===e?T.dy`<li><v-r-item-type6 .$type=${e} .$info=${t} .$subTheme=${s} @click=${()=>r(t)}></v-r-item-type6></li>`:T.dy`<li><v-r-item-image .$subType=${i} .$info=${t} .$subTheme=${s} @click=${()=>r(t)} .$opened=${o}></v-r-item-image></li>`}(t,this._type,this._subType,this._subTheme,this._viewListOpened,this._itemClick)))}
									${void 0}
								</ul>
							</div>
							<div class="swiper-scrollbar swiper-no-swiping"></div>
						</div>
						<button class="goback ${this._subTheme}" @click=${this._close}></button>
					</div>
				</div>
				<v-report-detail @send-stamp=${this._onSendStamp} .$subTheme=${this._subTheme}></v-report-detail>
			</v-cover-popup>
		`}$getInfo(){return{total:this._total.length,current:this._returns.length}}$start(t,e,i,s,o){return lt(this,void 0,void 0,(function*(){let e,r;this._type=t,this._subType=s,this._returns.length=0,this._total.length=0,"object"==typeof o?(e=o.theme,r=o.subTheme):(e=o,r="future"),this._subTheme="discover"===r?r:"future",i.forEach(((t,e)=>{this._total[e]=Object.assign(Object.assign({},t),{content:void 0})})),yield function(t){return lt(this,void 0,void 0,(function*(){if(pt===t)return;pt=t;const e=yield Promise.all([fetch(`./report/${t}/report-popup.css`),fetch(`./report/${t}/report-popup-item.css`),J(t)]),i=yield Promise.all([e[0].text(),e[1].text()]);ht=T.dy`<style>${i[0]}</style>`,ct=T.dy`<style>${i[1]}</style>`}))}(null!=e?e:"oxford"),this.requestUpdate()}))}$add(t){var e,i;let s=this._returns.find((e=>e.id===t.id));s||(s=this._total.find((e=>e.id===t.id)),s&&(s.content=r.cloneDeep(t.content),this._returns.push(s),this._swiper&&(this._swiper.update(),this._swiper.updateSize(),null===(e=this._swiper.scrollbar)||void 0===e||e.updateSize()),null===(i=this._detail)||void 0===i||i.$setFlipButton(),this.requestUpdate()))}$getReturns(){return r.cloneDeep(this._returns)}$setViewMenu(t){}$setViewList(t){this._viewList!==t&&(this._viewList=t,t?setTimeout((()=>{var t;this._swiper&&(this._swiper.destroy(),this._swiper=null);const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".swiper-container"),i=e.querySelector(".swiper-scrollbar");this._swiper=new U.Z(e,{direction:"vertical",resizeObserver:!0,slidesPerView:"auto",freeMode:!0,scrollbar:{el:i,draggable:!0,snapOnRelease:!1},mousewheel:!0}),this._viewListOpened=!0,this.requestUpdate()}),500):(this._viewListOpened=!1,this._swiper&&(this._swiper.destroy(),this._swiper=null)))}$close(){this._detail&&this._detail.$close(),this.$setViewList(!1),this._viewMenu=!1}};dt([(0,S.IO)("v-report-detail")],vt.prototype,"_detail",void 0),dt([(0,S.SB)()],vt.prototype,"_viewList",void 0),dt([(0,S.SB)()],vt.prototype,"_viewMenu",void 0),vt=dt([(0,S.Mo)("v-t-report-popup")],vt);var yt=function(t,e,i,s){var o,r=arguments.length,n=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(r<3?o(n):r>3?o(e,i,n):o(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n};const bt=i(136).Z,xt=i(11).Z,kt=i(881).Z,wt=i(81).Z,$t=i(505).Z;function Tt(t,e){t<0&&(t=0);let i="";e&&(i=Math.floor(t/3600)+":");const s=Math.floor(t%3600/60),o=t%60;return i=i+(s<10?"0":"")+s+":",i=i+(o<10?"0":"")+o,i}let St=null,It=class extends T.oi{constructor(){super(),this._type="",St=this}static get styles(){return bt}render(){return T.dy`
			<v-video-ui></v-video-ui>
			<v-audio-ui></v-audio-ui>
			<slot></slot>
		`}firstUpdated(t){super.firstUpdated(t)}load(t,e,i,s){return o=this,r=void 0,a=function*(){this._callback&&this._callback!==s&&this._callback(this.getScripts()),this._unload(),this._callback=s,this.style.display="","mp4"===e||"mp3"===e?this._type=e:t.endsWith(".mp4")?this._type="mp4":t.endsWith(".mp3")?this._type="mp3":this._type="","mp3"===this._type&&this._audioUI?(this.style.display="unset",this._audioUI.load(t,i,this)):"mp4"===this._type&&this._videoUI?(this.style.display="unset",this._videoUI.load(t,i,this)):(this.style.display="none",this._callback=void 0),this.requestUpdate()},new((n=void 0)||(n=Promise))((function(t,e){function i(t){try{d(a.next(t))}catch(t){e(t)}}function s(t){try{d(a.throw(t))}catch(t){e(t)}}function d(e){var o;e.done?t(e.value):(o=e.value,o instanceof n?o:new n((function(t){t(o)}))).then(i,s)}d((a=a.apply(o,r||[])).next())}));var o,r,n,a}_unload(){this._callback=void 0,this._audioUI&&this._audioUI.unload(),this._videoUI&&this._videoUI.unload(),this.style.display="none"}setEditor(t){this.appendChild(t)}setScripts(t){"mp3"===this._type&&this._audioUI?this._audioUI.setScripts(t):"mp4"===this._type&&this._videoUI&&this._videoUI.setScripts(t)}getScripts(){return"mp3"===this._type&&this._audioUI?this._audioUI.getScripts():"mp4"===this._type&&this._videoUI?this._videoUI.getScripts():[]}close(t,e){e?this._unload():(this._callback&&(t||(t=this.getScripts()),this._callback(t),this._callback=void 0),"none"!==this.style.display&&(this._unload(),this.dispatchEvent(new CustomEvent("close-player"))))}changedFocusIdx(t,e){this.dispatchEvent(new CustomEvent("changed-focus-idx",{detail:{focusIdx:t,scrollIdx:e}}))}sendScripts(t){this.dispatchEvent(new CustomEvent("send-scripts",{detail:t}))}};yt([(0,S.IO)("v-video-ui")],It.prototype,"_videoUI",void 0),yt([(0,S.IO)("v-audio-ui")],It.prototype,"_audioUI",void 0),It=yt([(0,S.Mo)("v-player-manager")],It);class Et extends T.oi{constructor(){super(),this.isFullscreen=!1,this._player=new k,this._scripts=[],this._numOfScript=0,this._manager=null,this._scrollIdx=0,this._focusIdx=-1,this._focusIdx_seek=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._mode="",this._viewScriptBtn=!1,this._sendedScript=!1,this._bPlay=!1,this._muted=!1,this._state=0,this._timeRatio=0,this._volumeRatio=0,this._repeatStart=-1,this._repeatEnd=-1,this._playTime="",this._remainTime="",this._isHour=!1,this.onChangeTime=t=>{let e=t.detail*this._player.duration;this._repeatStart>=0&&e<this._repeatStart?e=this._repeatStart:this._repeatEnd>=0&&e>this._repeatEnd&&(e=this._repeatEnd),this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._player.seek(e,!this.isRepeatMode)},this.onChangeVolume=t=>{this._volumeRatio=t.detail,this._muted=!1,this._player.setMuted(!1),this._player.setVolume(t.detail)};const t=r.throttle(((t,e,i)=>{this._playTime=Tt(Math.round(t/1e3),i),this._remainTime=Tt(Math.round((e-t)/1e3),i)}),100);this._player.on("state-changed",((e,i)=>{this._bPlay=this._player.bPlay,this._state=e,3===e&&(this._isHour=this._player.duration>=36e5,this._volumeRatio=this._player.volume,this._muted=!1,this._player.setMuted(!1),this._timeRatio=this._player.currentTime/this._player.duration,t(this._player.currentTime,this._player.duration,this._isHour),setTimeout((()=>this._initPos()),100))}));let e=-1;this._player.on("time-changed",(i=>{var s;const o=this._scripts;if(this._numOfScript>0){let t=-1,r=-1;if(this._focusIdx_click>=0&&i>this._focusIdx_click_end&&(this._focusIdx_click=-1),this._focusIdx_maintain>=0&&i>this._focusIdx_click_end+100&&(this._focusIdx_maintain=-1),this._focusIdx_click_end>=0&&this._focusIdx_click<0&&this._focusIdx_maintain<0&&(this._focusIdx_click_end=-1),this._focusIdx_seek>=0)t=this._focusIdx_seek,this._focusIdx_seek=-1;else if(this._focusIdx_click>=0)t=this._focusIdx_click;else if(this._focusIdx_maintain>=0)t=this._focusIdx_maintain;else{if(e>=0){const s=o[e];if(s)if(i>=s.dms_start)for(let s=e;s<this._numOfScript;s++){const e=o[s];if(i<e.dms_start){r=s;break}if(i>=e.dms_start&&i<=e.dms_end){t=s;break}}else for(let s=e;s>=0;s--){const e=o[s];if(i>e.dms_end){r=s;break}if(i>=e.dms_start&&i<=e.dms_end){t=s;break}}}if(t<0)for(let e=0;e<this._numOfScript;e++){const s=o[e];if(i<s.dms_start){r=e;break}if(i>=s.dms_start&&i<=s.dms_end){t=e;break}}t>=0&&(e=t)}t>=0?r=t:r<0&&(r=i<=o[0].dms_start?0:this._numOfScript-1),this._scrollIdx===r&&this._focusIdx===t||this._sendedScript&&(null===(s=this._manager)||void 0===s||s.changedFocusIdx(t,r)),this._scrollIdx=r,this._focusIdx=t}this._timeRatio=i/this._player.duration,t(i,this._player.duration,this._isHour)})),this._player.on("volume-changed",(t=>{this._volumeRatio=t})),this._player.on("play-end",(()=>{var t;this._focusIdx_seek=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,e=-1,(this._scrollIdx>=0||this._focusIdx>=0)&&(this._scrollIdx=-1,this._focusIdx=-1,this._sendedScript&&(null===(t=this._manager)||void 0===t||t.changedFocusIdx(-1,-1)))})),this._player.on("play-end-temp",(()=>{setTimeout((()=>{var t;this._focusIdx_seek=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,(this._scrollIdx>=0||this._focusIdx>=0)&&(this._scrollIdx=-1,this._focusIdx=-1,this._sendedScript&&(null===(t=this._manager)||void 0===t||t.changedFocusIdx(-1,-1)))}),10)}))}get isRepeatMode(){return this._repeatStart>=0&&this._repeatEnd>this._repeatStart}_initPos(){const t=this._boxEl,e=this._middleEl,i=this._mediaEl;if(!(t&&e&&i))return!1;if(this._player.myState<3)return!1;let s;return s=i instanceof HTMLVideoElement?e.offsetWidth*i.videoHeight/i.videoWidth:e.offsetHeight,t.style.position="absolute",t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px",t.style.width=t.offsetWidth+"px",e.style.height=s+"px",!0}_clearPos(){this._focusIdx=-1,this._scrollIdx=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._focusIdx_seek=-1,this._mode="",this._viewScriptBtn=!1,this._sendedScript=!1,this.isFullscreen=!1,this._bPlay=!1,this._muted=!1,this._state=0,this._timeRatio=0,this._volumeRatio=0,this._repeatStart=-1,this._repeatEnd=-1,this._playTime="",this._remainTime="",this._isHour=!1,this._boxEl&&(this._boxEl.style.position="relative",this._boxEl.style.left="",this._boxEl.style.top="",this._boxEl.style.width="",this._boxEl.style.height="",this._middleEl.style.height="")}_checkBoxPosition(){if(!this._boxEl)return;if("absolute"!==this._boxEl.style.position)return;const t=this._boxEl,e=t.style,i=this.offsetWidth,s=this.offsetHeight,o=t.offsetLeft,r=t.offsetTop,n=t.offsetLeft+t.offsetWidth,a=t.offsetTop+t.offsetHeight;let d=parseFloat(e.left);isNaN(d)&&(d=0);let l=parseFloat(e.top);isNaN(l)&&(l=0),o<0?d=d+0-o:n>i&&(d=d+i-n),r<0?l=l+0-r:a>s&&(l=l+s-a),e.left=d+"px",e.top=l+"px"}firstUpdated(t){super.firstUpdated(t);let e=0,i=0,s=0,o=0,r=0,n=0,a=0,d=0,l=0,h=0,c=0,p=0;const m=()=>{const t=this._boxEl,m=this._middleEl;return!(this.isFullscreen||this._player.myState<3||(c=this.offsetWidth,p=this.offsetHeight,l=r=t.offsetWidth,n=t.offsetHeight,h=a=m.offsetHeight,d=n-a,s=e=t.offsetLeft,o=i=t.offsetTop,t.style.position="absolute",t.style.left=e+"px",t.style.top=i+"px",t.style.width=r+"px",m.style.height=a+"px",0))};new $(this._boxEl,{preventDefault:!1},(t=>{const e=t.target;if(!(e instanceof HTMLElement))return!1;if(this.isFullscreen)return!1;let i=e,s=!0;for(;i&&i!==this._boxEl;){if(i.classList.contains("not-drag")){s=!1;break}i=i.parentElement}return s&&(s=m()),s}),((t,a,d)=>{e=s+t,e<0?e=0:e+r>c&&(e=c-r),i=o+a,i<0?i=0:i+n>p&&(i=p-n),this._boxEl.style.left=e+"px",this._boxEl.style.top=i+"px"}),(t=>{this._checkBoxPosition()})),new $(this._sizeDragTgt,{preventDefault:!0},(t=>!this.isFullscreen&&m()),((t,e,i)=>{r=l+t,s+r>c&&(r=c-s),a=h+e,o+a+d>p&&(a=p-(o+d)),this._boxEl.style.width=r+"px",this._middleEl.style.height=a+"px"}),(t=>{this._checkBoxPosition()}))}load(t,e,i){this._manager=i,this._clearPos(),this.setScripts(e),this.style.display="",this._player.initMedia(this._mediaEl),this._player.load(t)}unload(){this._clearPos(),this._scripts.length=0,this._numOfScript=0,this.style.display="none",this._player.unload()}_togglePlay(){this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._player.bPlay?this._player.pause(!this.isRepeatMode):this._player.play(!this.isRepeatMode)}_clickStop(){this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._repeatStart=-1,this._repeatEnd=-1,this._player.pause(),this._player.seek(0)}_toggleMode(t){return r.isString(t)||(""===this._mode?t="hor":"hor"===this._mode?t="ver":"ver"===this._mode&&(t="")),null!=t?t:""}_toggleScriptBtn(t){if(0!==this._scripts.length){if(this._viewScriptBtn)return this._toggleMode(""),void(this._viewScriptBtn=!1);r.isBoolean(t)||(t=!this._viewScriptBtn),this._viewScriptBtn=t}}getScripts(){return r.cloneDeep(this._scripts)}setScripts(t){this._scripts=t,this._numOfScript=t.length,this._focusIdx=-1,this._scrollIdx=0,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._focusIdx_seek=-1,this.requestUpdate()}_sendScript(){var t;0!==this._scripts.length&&(this._sendedScript=!0,null===(t=this._manager)||void 0===t||t.sendScripts(r.cloneDeep(this._scripts)),L(O))}_clickScript(t,e){this._repeatStart=-1,this._repeatEnd=-1;const i=this._scripts[t],s=this._scripts[t+1];e?this._player.gotoAndPlay(i.dms_start,i.dms_end,1):this._player.seek(i.dms_start),this._focusIdx_click=t,this._focusIdx_maintain=e?t:-1,this._focusIdx_click_end=s?s.dms_start:i.dms_end}_gotoPrevScript(){let t=-1;this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1;let e=this._player.currentTime;if(this._focusIdx_seek>=0)t=this._focusIdx_seek-1;else if(this._focusIdx>=0)t=this._focusIdx-1;else{const i=this._scripts;for(let s=this._numOfScript-1;s>=0;s--)if(e>i[s].dms_start){t=s;break}}let i=!1;t>=0&&t<this._numOfScript&&(this._repeatStart<0||this._scripts[t].dms_start>this._repeatStart)&&(i=!0,this._focusIdx_seek=t,this._player.seek(this._scripts[t].dms_start,!this.isRepeatMode)),i||(e-=3e3,this._repeatStart>=0&&e<this._repeatStart&&(e=this._repeatStart),e<0&&(e=0),this._player.seek(e),this._focusIdx_seek=-1)}_gotoNextScript(){let t=-1;this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1;let e=this._player.currentTime;if(this._focusIdx_seek>=0)t=this._focusIdx_seek+1;else if(this._focusIdx>=0)t=this._focusIdx+1;else{const i=this._scripts;for(let s=0;s<this._numOfScript;s++)if(e<i[s].dms_start){t=s;break}}let i=!1;t>=0&&t<this._numOfScript&&(this._repeatEnd<0||this._scripts[t].dms_start<this._repeatEnd)&&(i=!0,this._focusIdx_seek=t,this._player.seek(this._scripts[t].dms_start,!this.isRepeatMode)),i||(e+=3e3,this._repeatEnd>=0&&e>this._repeatEnd&&(e=this._repeatEnd),e>this._player.duration&&(e=this._player.duration),this._player.seek(e),this._focusIdx_seek=-1)}_close(){var t;z(),null===(t=this._manager)||void 0===t||t.close(this._scripts)}_toggleMuted(t){r.isBoolean(t)||(t=!this._muted),this._muted=t,this._player.setMuted(t)}}yt([(0,S.IO)(".player-box")],Et.prototype,"_boxEl",void 0),yt([(0,S.IO)(".player-box>.top")],Et.prototype,"_topEl",void 0),yt([(0,S.IO)(".player-box>.middle")],Et.prototype,"_middleEl",void 0),yt([(0,S.IO)(".player-box>.bottom")],Et.prototype,"_bottomEl",void 0),yt([(0,S.IO)(".size-drag-tgt")],Et.prototype,"_sizeDragTgt",void 0),yt([(0,S.SB)()],Et.prototype,"_scrollIdx",void 0),yt([(0,S.SB)()],Et.prototype,"_focusIdx",void 0),yt([(0,S.SB)()],Et.prototype,"_mode",void 0),yt([(0,S.SB)()],Et.prototype,"_viewScriptBtn",void 0),yt([(0,S.SB)()],Et.prototype,"_sendedScript",void 0),yt([(0,S.SB)()],Et.prototype,"_bPlay",void 0),yt([(0,S.SB)()],Et.prototype,"_muted",void 0),yt([(0,S.SB)()],Et.prototype,"_state",void 0),yt([(0,S.SB)()],Et.prototype,"_timeRatio",void 0),yt([(0,S.SB)()],Et.prototype,"_volumeRatio",void 0),yt([(0,S.SB)()],Et.prototype,"_repeatStart",void 0),yt([(0,S.SB)()],Et.prototype,"_repeatEnd",void 0);const Rt=[18,23,27,32,36];let Pt=class extends Et{constructor(){super(...arguments),this._fontSize=27,this._questions=[]}static get styles(){return xt}render(){const t=this._player.duration,e=""!==this._mode,i=(this._repeatStart>=0&&t)>0?T.dy`<div class="repeat-marker" style="left: ${100*this._repeatStart/t}%;"></div>`:void 0,s=(this._repeatEnd>=0&&t)>0?T.dy`<div class="repeat-marker" style="left: ${100*this._repeatEnd/t}%;"></div>`:void 0;return T.dy`
			<!-- script: 스크립트 띄움 -->
			<div class="${`player-box ${this._mode} ${this.isFullscreen?"fullscreen":""}`}">
				<div class="top">
				
					<button class=${"minimize-button not-drag"+(e?"":" hide")} @click=${this._toggleMode}></button>
					<button class="close-button not-drag" @click=${()=>this._close()}></button>
				</div>
				<div class="middle">
					<audio></audio>
					<v-media-script class="script-box not-drag"
						.view=${e}
						.scripts=${this._scripts}
						.scrollIdx=${e?this._scrollIdx:-1}
						.focusIdx=${e?this._focusIdx:-1}
						.fontSize=${this._fontSize}
						@clickScript=${t=>this._clickScript(t.detail,!0)}
					></v-media-script>

				</div>
				<div class="bottom not-drag">
					<div class="top-controls">
						<span class="time-current">${this._playTime}</span>
						<div class="progress-bnd">
							<v-media-progress 
								class="progress-bar" 
								.type=${"audio"} 
								.ratio=${this._timeRatio}
								.min=${this._repeatStart/t}
								.max=${this._repeatEnd/t}
								@change=${this.onChangeTime}
							></v-media-progress>
							${this._repeatStart<0&&t>0?this._questions.map(((e,i)=>T.dy`<div class="num-marker" @click=${()=>this._clickScript(e.idx,!1)} style="left: ${100*e.start/t}%;">${i+1}</div>`)):void 0}
							${i}
							${s}
						</div>
						<span class="time-remaining">${this._remainTime}</span>
						<button class=${"sound-button "+(this._muted?"mute":"")} @click=${this._toggleMuted}></button>
						<v-media-progress class="volume-bar" .ratio=${this._volumeRatio} @change=${this.onChangeVolume}></v-media-progress>
					</div>
					<div class="btm-controls">
						<div class="left">
							<div class="play-pause">
									<button class=${"play-button"+(this._bPlay?" play":"")} @click=${this._togglePlay}></button>
							</div>
							<button class="stop-button" @click=${this._clickStop}></button>
							<button class="prev-button" @click=${this._gotoPrevScript}></button>
							<button class="next-button" @click=${this._gotoNextScript}></button>
							<button class=${"repeat-button"+(this._repeatStart>=0?" on":"")} @click=${this._clickRepeat}></button>
						</div>
						<div class=${"right"+(0===this._numOfScript?" hide":"")}>
								<div class=${"text-adjust"+(e?"":" hide")}>
										<button class="minus-button" 
											?disabled=${this._fontSize<=Rt[0]} 
											@click=${()=>this._downFontSize(-1)}
										></button>
										<button 
											class="plus-button" 
											?disabled=${this._fontSize>=Rt[Rt.length-1]} 
											@click=${()=>this._downFontSize(1)}

										></button>
								</div>
								<button class=${"script-button"+(e?" on":"")} @click=${this._toggleMode}></button>
								
								<button class=${`down-button ${this._numOfScript>0?"":"hide"} ${e?"":"hidden"} ${this._sendedScript?"sended":""}`} @click=${this._sendScript}></button>
								<button class="fullscreen-button ${this._numOfScript>0?"":"hide"} ${e?"":"hidden"}"  @click=${this._toggleFullscreen}></button>
						</div>
					</div>
				</div>
				<span class="size-drag-tgt"></span>
			</div>
		`}_toggleFullscreen(){this._boxEl&&(this.isFullscreen=!this.isFullscreen,this.requestUpdate())}_downFontSize(t){let e=Rt.indexOf(this._fontSize);e<0&&(e=0),e+=t,e<0?e=0:e>Rt.length-1&&(e=Rt.length-1),this._fontSize=Rt[e]}_clearPos(){super._clearPos(),this._fontSize=27}_toggleMode(t){var e,i,s,o;r.isString(t)||(t=""===this._mode?"ver":""),this.isFullscreen=!1;const n=this._middleEl,a=this._boxEl,d=null!==(e=null==n?void 0:n.offsetHeight)&&void 0!==e?e:0,l=super._toggleMode(t);if(l===this._mode)return l;let h;if(z(),this._mode=l,""===l)h=0;else if(n){const t=window.getComputedStyle(n);h=parseFloat(null!==(i=t.height)&&void 0!==i?i:"0"),(isNaN(h)||h<=0)&&(h=parseFloat(null!==(s=t.minHeight)&&void 0!==s?s:"0"))}else h=0;let c=parseFloat(null!==(o=null==a?void 0:a.style.top)&&void 0!==o?o:"0");return isNaN(c)&&(c=0),c+=(d-h)/2,c<0&&(c=0),a&&(a.style.top=c+"px"),setTimeout((()=>this._checkBoxPosition()),100),l}_clickRepeat(){if(this._player.duration<=0)return;z();const t=this._player.currentTime;this._repeatStart<0?this._repeatStart=t:this._repeatEnd<0?t>this._repeatStart+1&&(this._repeatEnd=t,this._player.gotoAndPlay(this._repeatStart,this._repeatEnd,1e5)):(this._player.bPlay?this._player.play():this._player.pause(),this._repeatStart=-1,this._repeatEnd=-1)}setScripts(t){this._questions.length=0,t.forEach(((t,e)=>{t.dms_question&&t.dms_question>0&&this._questions.push({start:t.dms_start,end:t.dms_end,idx:e})})),super.setScripts(t)}};yt([(0,S.IO)("audio")],Pt.prototype,"_mediaEl",void 0),yt([(0,S.SB)()],Pt.prototype,"_fontSize",void 0),Pt=yt([(0,S.Mo)("v-audio-ui")],Pt);let Ct=class extends Et{static get styles(){return kt}render(){const t=""!==this._mode;return T.dy`
			<div class="${`player-box ${this._mode} ${this.isFullscreen?"fullscreen":""}`}">
				<div class="top">
					<button class=${"minimize-button not-drag"+(t?"":" hide")} @click=${()=>this._toggleMode("")}></button>
					<button class="close-button not-drag" @click=${()=>this._close()}></button>
				</div>
				<div class="middle">
					<div class="media-box"><video class="not-drag" @pointerdown=${this._togglePlay}></video></div>
					<v-media-script class="script-box not-drag"
						.view=${t}
						.scripts=${this._scripts}
						.scrollIdx=${t?this._scrollIdx:-1}
						.focusIdx=${t?this._focusIdx:-1}
						.fontSize=${27}
						@clickScript=${t=>this._clickScript(t.detail,!0)}
					></v-media-script>
				</div>
				<div class="bottom not-drag">      <!-- 하단 컨트롤 --> 
					<div class="left-controls">
						<div class="play-pause">
							<button class=${"play-button"+(this._bPlay?" play":"")} @click=${this._togglePlay}></button>
						</div>
						<button class="stop-button" @click=${this._clickStop}></button>
						<button class="prev-button" @click=${this._gotoPrevScript}></button>
						<button class="next-button" @click=${this._gotoNextScript}></button>
						<span class="time-current">${this._playTime}</span>

						<v-media-progress class="progress-bar" .ratio=${this._timeRatio} @change=${this.onChangeTime}></v-media-progress>

						<span class="time-remaining">${this._remainTime}</span>
						<button class=${"sound-button "+(this._muted?"mute":"")} @click=${this._toggleMuted}></button>
						<v-media-progress class="volume-bar" .ratio=${this._volumeRatio} @change=${this.onChangeVolume}></v-media-progress>
					</div>
					<div class="right-controls">
						<div class="script-choice" style=${"display:"+(this._viewScriptBtn?"":"none")}>
							<button class="script-ver" @click=${()=>this._toggleMode("ver")}></button>
							<button class="script-hor" @click=${()=>this._toggleMode("hor")}></button>
						</div>
						<button class=${"script-button "+(this._numOfScript<=0?"hide":"")} @click=${this._toggleScriptBtn}></button>
						<button class=${`down-button ${this._numOfScript>0?"":"hide"} ${t?"":"hidden"} ${this._sendedScript?"sended":""}`} @click=${this._sendScript}></button>
						<button class="fullscreen-button"  @click=${this._toggleFullscreen}></button>
					</div>
				</div>

				<span class="drag size-drag-tgt ${this.isFullscreen?"fullscreen":""}"></span>
			</div>
		`}_toggleFullscreen(){this._boxEl&&(this.isFullscreen=!this.isFullscreen,this.requestUpdate())}_toggleMode(t){const e=super._toggleMode(t);return this._viewScriptBtn=!1,e===this._mode||(z(),this._mode=e,setTimeout((()=>this._checkBoxPosition()),100)),e}};yt([(0,S.IO)(".media-box>video")],Ct.prototype,"_mediaEl",void 0),Ct=yt([(0,S.Mo)("v-video-ui")],Ct);let Mt=class extends T.oi{constructor(){super(),this.type="video",this.ratio=0,this.min=-1,this.max=-1,this.mouseRatio=-1,this._pid=-1;let t=0,e=-1;const i=t=>{e=t,this.dispatchEvent(new CustomEvent("change",{detail:t}))},s=r.throttle((t=>{t>=0&&this._pid>=0&&i(t)}),500,{leading:!1,trailing:!0});this.addEventListener("pointerdown",(i=>{if(this._pid>=0)return;if(!i.isPrimary)return;if(1!==i.buttons)return;e=-1,t=this.offsetWidth;let o=i.offsetX/t;this.min>=0&&o<this.min?o=this.min:this.max>=0&&o>this.max&&(o=this.max),o<0?o=0:o>1&&(o=1),this.mouseRatio=o,this._pid=i.pointerId,this.setPointerCapture(this._pid),s(o)})),this.addEventListener("pointermove",(e=>{if(this._pid<0)return;if(!e.isPrimary)return;if(1!==e.buttons)return;let i=e.offsetX/t;this.min>=0&&i<this.min?i=this.min:this.max>=0&&i>this.max&&(i=this.max),i<0?i=0:i>1&&(i=1),this.mouseRatio=i,s(i)}));const o=o=>{if(this._pid<0)return;this.releasePointerCapture(this._pid),this._pid=-1;let r=o.offsetX/t;this.min>=0&&r<this.min?r=this.min:this.max>=0&&r>this.max&&(r=this.max),r<0?r=0:r>1&&(r=1),(r<e-.01||r>e+.01)&&(this.mouseRatio=r,s.cancel(),i(r))};this.addEventListener("pointerup",o),this.addEventListener("pointercancel",o)}static get styles(){return wt}render(){return T.dy`
			<div class="box"></div>
			<div class=${"btn "+this.type} style=${`left:${100*(this.mouseRatio>=0?this.mouseRatio:this.ratio)}%`}></div>
		`}shouldUpdate(t){return t.has("ratio")&&this._pid<0&&(this.mouseRatio=-1),super.shouldUpdate(t)}};yt([(0,S.Cb)()],Mt.prototype,"type",void 0),yt([(0,S.Cb)({type:Number})],Mt.prototype,"ratio",void 0),yt([(0,S.Cb)({type:Number})],Mt.prototype,"min",void 0),yt([(0,S.Cb)({type:Number})],Mt.prototype,"max",void 0),yt([(0,S.SB)()],Mt.prototype,"mouseRatio",void 0),Mt=yt([(0,S.Mo)("v-media-progress")],Mt);let Ot=class extends T.oi{constructor(){super(...arguments),this.scripts=[],this.view=!1,this.focusIdx=-1,this.scrollIdx=-1,this.fontSize=27}static get styles(){return $t}render(){return T.dy`
			<div class="scroll">
				${this.scripts.map(((t,e)=>T.dy`
						${t.no_line_break||0===e?void 0:T.dy`<br/>`}
						${t.dms_speaker?T.dy`<span class="speaker">${t.dms_speaker}:</span>`:void 0}
						<span 
							class=${`script${this.focusIdx===e?" on":""}${this.scrollIdx===e?" scroll-to":""}`} 
							@click=${()=>this._clickScript(e)}
							.innerHTML=${t.dms_eng}
						></span>
					`))}
			</div>
		`}updated(t){if(super.updated(t),this.shadowRoot&&this.view){let e=t.has("scrollIdx")||t.has("focusIdx");const i=t.has("fontSize");if((i||t.has("view"))&&(e=!0,this.style.fontSize=this.fontSize+"px"),e){const t=this.shadowRoot.querySelector(".script.scroll-to"),e=this.shadowRoot.querySelector(".scroll");t&&e&&(i&&(e.style.scrollBehavior="auto"),e.scrollTop=t.offsetTop-(e.offsetHeight-t.offsetHeight)/2,i&&(e.style.scrollBehavior="smooth"))}}}_clickScript(t){this.dispatchEvent(new CustomEvent("clickScript",{detail:t}))}};yt([(0,S.Cb)({type:Array})],Ot.prototype,"scripts",void 0),yt([(0,S.Cb)({type:Boolean})],Ot.prototype,"view",void 0),yt([(0,S.Cb)({type:Number})],Ot.prototype,"focusIdx",void 0),yt([(0,S.Cb)({type:Number})],Ot.prototype,"scrollIdx",void 0),yt([(0,S.Cb)({type:Number})],Ot.prototype,"fontSize",void 0),Ot=yt([(0,S.Mo)("v-media-script")],Ot),window.cfg_debug=!1;try{"boolean"!=typeof cfg_debug&&(cfg_debug=!1)}catch(t){cfg_debug=!1}window.canConsole=()=>cfg_debug,(()=>{let t="./";var e;t.endsWith("/")||(t+="/"),t=new URL(t,location.href).href,(e="./assets/mp3/").endsWith("/")||(e+="/"),M=e,O=e+"to_pad_eng.mp3",B=e+"btn_tab.mp3",N=e+"popup.mp3",A(O),A(B),A(N),window.g_lib_url=t,console.info("version=>","0.8.371-20220426",`g_lib_url='${g_lib_url}', 'SKIN=i-book`)})();let Bt="oxford";(()=>{const{tFrm:t,sEl:e,sFrameBox:i,reportPopup:p,playerManager:m,btnAdd:u}=function(){const t=document.getElementById("teacher"),e=t.querySelector("iframe"),i=document.getElementById("student"),r=i.querySelector(".frame-box"),n=t.querySelector("v-t-report-popup"),a=t.querySelector("v-player-manager"),d=document.querySelector(".control .add"),l=document.querySelector(".control .teacher"),h=document.querySelector(".control .same"),c=document.querySelector(".control .student");let p="same",m=-1;const u=(e,s)=>{p=e,l.disabled="teacher"===e,c.disabled="student"===e,h.disabled="same"===e,m>0&&(window.clearTimeout(m),t.classList.remove("animation"),i.classList.remove("animation")),s&&(t.classList.add("animation"),i.classList.add("animation"),m=window.setTimeout((()=>{t.classList.remove("animation"),i.classList.remove("animation")}),300)),_()},_=()=>{const e=window.innerWidth,r=window.innerHeight;let n=("student"===p?1920:"teacher"===p?640:o)/o,a=("student"===p?640:"teacher"===p?1920:s)/s;const d=e/(s*a+o*n),l=r/(800*a+800*n);let h=Math.max(d,l);t.style.transform=`scale(${h*a})`,i.style.transform=`scale(${h*n})`};return window.addEventListener("resize",_),l.addEventListener("click",(()=>u("teacher",!0))),c.addEventListener("click",(()=>u("student",!0))),h.addEventListener("click",(()=>u("same",!0))),setTimeout((()=>u("same")),300),{tEl:t,tFrm:e,sEl:i,sFrameBox:r,reportPopup:n,playerManager:a,btnAdd:d}}();u.onclick=()=>{g.addStudent(!1)};const _=n.map(((t,e)=>function(t){const e=t%d.length,i=t%n.length,s=t%a.length;return{id:1e3+t,learn_idx:1e4+t,name:d[e],nickName:l[t%l.length],thumbnail:n[i],defaultThumbnail:n[i],profileThumbnail:a[s],birthday:"",gender:"M",displayMode:comm_o.displayMode}}(e))),g=function(t,e,i,s){let o="";const n=[];function a(){return n.map((t=>r.cloneDeep(t.info)))}let d=null;function l(t){d.blur(t.idx),d=t.focus()}function h(t){if(n.length>=s.length)return;const r=n.length,h=s[r],c=new C(h,i,l,a),p=c.container;e.appendChild(p),t?d=c.focus():c.blur(r),n.push(c),c.frame.src=o}return h(!0),{handlePostMessage:t=>P(this,void 0,void 0,(function*(){let e=n.length;for(let i=0;i<e;i++)if(yield n[i].handlePostMessage(t))return!0;return!1})),handleWssMessage:t=>{n.forEach((e=>e.handleWssMessage(t)))},sendPADToID:(t,e)=>{var i;let s=n.length;for(let o=0;o<s;o++){const{frame:s,info:r}=n[o];if(r.id===t)return void(null===(i=s.contentWindow)||void 0===i||i.postMessage(e,"*"))}},sendAllPAD:t=>{n.forEach((e=>{var i;return null===(i=e.frame.contentWindow)||void 0===i?void 0:i.postMessage(t,"*")}))},addStudent:h,getLoginStudents:a,gotoBook:t=>{o=t,n.forEach((e=>e.frame.src=t))}}}(0,i,t.contentWindow,_),f={prevkey:-1,prevpage:-1,curkey:-1,curpage:-1,study:void 0,SB:{topOff:!1,bottomOff:!1,pages:[-1,-1],viewAnswerBtn:!1},WB:{topOff:!1,bottomOff:!1,pages:[-1,-1],viewAnswerBtn:!1},malist:[]};let v="",y="";const b=(e,i,s,o,r,n,a,d,l,h,c,p)=>{let m,u;const _=new URLSearchParams,f=new URLSearchParams;i&&i>0&&_.append("page",i+""),r&&r>0&&_.append("sbookPage",r+""),s&&(_.append("uniq",s),f.append("uniq",s)),d&&_.append("study",d),l&&_.append("topOff","y"),h&&_.append("bottomOff","y"),c&&_.append("pages",c.join(",")),p&&_.append("viewAnswerBtn","y"),m=`${e}teacher/index.html?${_.toString()}`,u=`${e}student/index.html?${f.toString()}`,t.src=m,g.gotoBook(u)},x=(t,e,i,s,o,r,n,a,d,l,h,c)=>{f.curkey=t,f.curpage=null!=e?e:-1,v=y+t+"/",b(y+t+"/",e,i,0,o,0,0,a,d,l,h,c)};(()=>{var t,e,i,s,o,r,n,a;const d=document.baseURI,l=parseInt(null!==(t=comm_o.getQuery("book-key"))&&void 0!==t?t:"-1",10),h=parseInt(null!==(e=comm_o.getQuery("page"))&&void 0!==e?e:"-1",10),c=(parseInt(null!==(i=comm_o.getQuery("spage"))&&void 0!==i?i:"-1",10),parseInt(null!==(s=comm_o.getQuery("epage"))&&void 0!==s?s:"-1",10),comm_o.getQuery("example"),(null!==(o=comm_o.getQuery("uniq"))&&void 0!==o?o:"").trim()),p=(null!==(r=comm_o.getQuery("reportTheme"))&&void 0!==r?r:"").trim();if(y=(null!==(n=comm_o.getQuery("book-base-url"))&&void 0!==n?n:"").trim(),v=(null!==(a=comm_o.getQuery("url"))&&void 0!==a?a:"").trim(),Bt="elif"===p?"elif":"oxford",""!==v){if(""===y){const t=v.split("/");t.pop(),v.endsWith("/")&&t.pop(),y=t.join("/")}y=new URL(y,d).href,v=new URL(v,d).href,y.endsWith("/")||(y+="/"),v.endsWith("/")||(v+="/"),b(v,h,c,0,void 0)}else{if(!(""!==y&&l>0))throw"request query가 이상. book-key/book-base-url 혹은 url 미입력";y=new URL(y,d).href,v=y+l+"/",x(l,h,c,0,void 0)}})(),function(t,e,i,s,o,n,a,d,l,p){function m(e){var i;null===(i=t.contentWindow)||void 0===i||i.postMessage(e,"*")}function u(t){const i={type:"notifyEtcMsg",from:"launcher",fromId:"",msg:t};e.handleWssMessage(i)}h=n,c=void 0,i.addEventListener("send-stamp",(t=>{console.log("stamp",t)})),s.addEventListener("close-player",(t=>{m({type:"notifyClosedPlayer",from:"launcher",msg:void 0}),u({etcType:"endScript",etcMsg:void 0})})),s.addEventListener("changed-focus-idx",(t=>{u({etcType:"changedFocusIdx",etcMsg:t.detail})})),s.addEventListener("send-scripts",(t=>{u({etcType:"sendScript",etcMsg:t.detail})})),window.addEventListener("message",(n=>{return a=this,c=void 0,g=function*(){var a,c;if(canConsole()&&console.info("base:base.ts",n.data,n.source===t.contentWindow),n.source===t.contentWindow){const t=n.data;if(!t||"content"!==t.from)return;switch(canConsole()&&console.info("base:teacher=>app",t.type,t),t.type){case"getMyProfile":m({type:"notifyMyProfile",from:"launcher",msg:{id:1,learn_idx:1,name:"A",nickName:"B",thumbnail:"C",defaultThumbnail:"C",profileThumbnail:"C",birthday:"C",gender:"M",displayMode:"1"}});break;case"getServerHost":m({type:"notifyServerHost",from:"launcher",msg:{host:""}});break;case"getAllStudentsProfile":m({type:"notifyAllStudentsProfile",from:"launcher",msg:r.cloneDeep(o)});break;case"getLoginStudentsProfile":m({type:"notifyLoginStudentsProfile",from:"launcher",msg:e.getLoginStudents()});break;case"init":m({type:"notifyStartContent",from:"launcher",msg:{addOnHost:"",bookid:1,contentProgress:0,lesson:"Lesson",step:"Step",curriculumId:1}});break;case"sendMsgToStudent":{const i=t.msg;e.sendPADToID(i.id,{type:"notifyReceiveMsg",from:"launcher",msg:i})}break;case"broadcastMsgToStudents":{const i=t.msg;e.sendAllPAD({type:"notifyReceiveMsg",from:"launcher",msg:i})}break;case"gotoBookByKey":d&&d(t);break;case"gotoBookParent":l&&l();break;case"uploadFileToServer":m({type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:t.msg.url}});break;case"uploadImageToServer":m({type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:t.msg.src}});break;case"uploadFileToServerMulti":{const e=[];t.msg.forEach((t=>{r.isString(t)?e.push({result:"success",url:t}):t&&r.isString(t.url)&&e.push({result:"success",url:t.url})})),m({type:"notifyUploadToServerMultiResult",from:"launcher",msg:e})}break;case"startStudentReportProcess":{const s=r.cloneDeep(e.getLoginStudents()),o=t;o.msg.viewType,yield i.$start(o.msg.type,null!==(a=o.msg.viewType)&&void 0!==a?a:"C",s,o.msg.subType,{theme:h,subTheme:"i-book"}),6===o.msg.type&&o.msg.data&&r.isArray(o.msg.data.studentIdList)?(o.msg.data.studentIdList.forEach((t=>{const e=r.find(s,{id:t});e&&i.$add({id:e.id,name:e.name,nickName:e.nickName,thumbnail:e.thumbnail,defaultThumbnail:e.defaultThumbnail,profileThumbnail:e.profileThumbnail,displayMode:e.displayMode,gender:e.gender,noImage:e.noImage,noProfileImage:e.noProfileImage,content:{value:"",option:""}})})),i.$setViewList(!0),i.$setViewMenu(!1)):(i.$setViewList(!1),i.$setViewMenu(!1))}break;case"showStudentReportUI":i.$setViewMenu(!0);break;case"hideStudentReportUI":i.$setViewMenu(!1);break;case"showStudentReportListPage":i.$setViewList(!0);break;case"hideStudentReportListPage":i.$setViewList(!1);break;case"addStudentForStudentReportType6":if(6===i.$type){const s=t,o=e.getLoginStudents(),n=r.find(o,{id:s.msg.studentId});n&&i.$add({id:n.id,name:n.name,nickName:n.nickName,thumbnail:n.thumbnail,defaultThumbnail:n.defaultThumbnail,profileThumbnail:n.profileThumbnail,displayMode:n.displayMode,gender:n.gender,noImage:n.noImage,noProfileImage:n.noProfileImage,content:{value:"",option:""}})}break;case"getReportReturns":m({type:"notifyReportReturns",from:"launcher",msg:i.$getReturns()});break;case"addReportItem":{const e=t;i.$add(e.msg)}break;case"showContentToolTitlebar":case"hideContentToolTitlebar":break;case"popupPlayer":{const e=t;if(e.msg.url){const t=e.msg.url,i=t.toLocaleLowerCase().endsWith(".mp3")?"mp3":"mp4";s.load(t,i,null!==(c=e.msg.scripts)&&void 0!==c?c:[])}}break;case"closePlayer":s.close();break;case"sendEtcMsg":u(t.msg);break;case"moveNextContent":case"movePrevContent":p&&p("movePrevContent"===t.type?-1:1);break;default:console.warn("from teacher",t)}}else if(n.source===window){const t=n.data;if(!t)return;if("notifyStudentReport"===t.type){const s=t,o=e.getLoginStudents(),n=r.find(o,(e=>"S"+e.id===t.fromId));if(!n)return;const a=r.cloneDeep(n);a.content=s.msg.data,i.$add(a),s.msg&&s.msg.data&&s.msg.data.subData&&m(s)}}else e.handlePostMessage(n)},new((_=void 0)||(_=Promise))((function(t,e){function i(t){try{o(g.next(t))}catch(t){e(t)}}function s(t){try{o(g.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof _?o:new _((function(t){t(o)}))).then(i,s)}o((g=g.apply(a,c||[])).next())}));var a,c,_,g}))}(t,g,p,m,_,Bt,0,(t=>{var e;const i=t.msg;let s,o,r,n,a;f.prevkey=f.curkey,"student"===i.curbook?f.study=i.studyElement:f.study=void 0,i.curpage&&i.curpage>0?("work"===i.tobook&&"student"===i.curbook&&(s=i.curpage),f.prevpage=i.curpage):f.prevpage=f.curpage,"student"===i.tobook?(o=f.SB.topOff,r=f.SB.bottomOff,n=f.SB.pages,a=f.SB.viewAnswerBtn,f.malist=[]):"work"===i.tobook?(o=f.WB.topOff,r=f.WB.bottomOff,n=f.WB.pages,a=f.WB.viewAnswerBtn,f.malist=[]):f.malist=null!==(e=i.malist)&&void 0!==e?e:[],i.pages&&("student"===i.curbook?(f.SB.topOff=!!i.topOff,f.SB.bottomOff=!!i.bottomOff,f.SB.pages=i.pages,f.SB.viewAnswerBtn=!!i.viewAnswerBtn):"work"===i.curbook&&(f.WB.topOff=!!i.topOff,f.WB.bottomOff=!!i.bottomOff,f.WB.pages=i.pages,f.WB.viewAnswerBtn=!!i.viewAnswerBtn)),x(i.bookkey,i.page,void 0,i.isExample,s,0,0,void 0,o,r,n,a)}),(()=>{f.prevkey<=0||(f.malist=[],x(f.prevkey,f.prevpage,void 0,0,void 0,0,0,f.study,f.SB.topOff,f.SB.bottomOff,f.SB.pages,f.SB.viewAnswerBtn),f.prevkey=-1,f.prevpage=-1,f.study=void 0)}),(t=>{let e=f.malist.indexOf(f.curkey);if(e<0)return;if(e+=t,e<0)return;const i=f.malist[e];"number"==typeof i&&i>0&&x(i,void 0,void 0)}))})()}},i={};function s(t){var o=i[t];if(void 0!==o)return o.exports;var r=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=e,t=[],s.O=(e,i,o,r)=>{if(!i){var n=1/0;for(h=0;h<t.length;h++){for(var[i,o,r]=t[h],a=!0,d=0;d<i.length;d++)(!1&r||n>=r)&&Object.keys(s.O).every((t=>s.O[t](i[d])))?i.splice(d--,1):(a=!1,r<n&&(n=r));if(a){t.splice(h--,1);var l=o();void 0!==l&&(e=l)}}return e}r=r||0;for(var h=t.length;h>0&&t[h-1][2]>r;h--)t[h]=t[h-1];t[h]=[i,o,r]},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),s.p="/content/",(()=>{var t={348:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var o,r,[n,a,d]=i,l=0;if(n.some((e=>0!==t[e]))){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(d)var h=d(s)}for(e&&e(i);l<n.length;l++)r=n[l],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(h)},i=self.webpackChunki_book_viewer=self.webpackChunki_book_viewer||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),s.O(void 0,[821],(()=>s(139)));var o=s.O(void 0,[821],(()=>s(875)));o=s.O(o)})();