(()=>{"use strict";var t,e={577:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`*{margin:0;padding:0;box-sizing:border-box}:host{position:absolute;left:0;top:0;width:100%;height:100%;background-image:linear-gradient(0deg,#333d6a 0,#5b6faa 100%);user-select:none}.bg{position:absolute;left:30px;top:42px;right:30px;bottom:42px;background-color:#e1e2e9;border-radius:20px}.container{position:absolute;left:50px;top:70px;right:50px;bottom:70px;overflow-y:auto;white-space:normal;padding:20px;color:#000;line-height:1.6em;font-weight:600;scroll-behavior:smooth;font-family:noto-sans-scott;font-size:40px;text-align:left}.container::-webkit-scrollbar-track{box-shadow:inset 0 0 0 rgba(0,0,0,.2);border-radius:4px;background-color:rgba(0,0,0,0)}.container::-webkit-scrollbar{width:24px;background-color:rgba(0,0,0,0)}.container::-webkit-scrollbar-thumb{border-radius:24px;box-shadow:inset 0 0 0 rgba(0,0,0,.2);background-color:rgba(0,0,0,.3);background-clip:padding-box;border:8px solid transparent}.speaker{font-weight:700;display:inline-block;padding-top:.3em}.speaker:first-child{padding-top:unset!important}.script{transition-property:color;transition-duration:.2s}.script.on{color:#00f!important}.script.on *{color:#00f!important}`},421:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host *{margin:0;padding:0;box-sizing:border-box}:host button{border:none;cursor:pointer;background:0 0;outline:0}:host .player-box{border-radius:5px;overflow:hidden;background-color:#323232;min-width:530px;min-height:128px;width:700px;box-shadow:0 0 30.45px 4.55px rgba(0,0,0,.2);position:relative;pointer-events:all}:host .player-box.fullscreen{position:absolute;left:0!important;top:0!important;width:100%!important;height:100%!important;box-shadow:none;display:flex;flex-direction:column}:host .player-box>.top{height:35px;display:flex;align-items:center;justify-content:flex-end;background-color:#1f1f1f}:host .player-box .close-button{width:19px;height:19px;background:url(js/images/audio/close.png);background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button{width:18px;height:15px;background:url(js/images/audio/ico_mini.png);background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button.hide{display:none}:host .player-box>.middle{display:none;min-height:200px}:host .player-box.fullscreen>.middle{flex-grow:1}:host .player-box .script-box{background-color:#fff;height:100%;display:block}:host .player-box>.bottom{height:127px;padding:0 20px}:host .top-controls{height:50%;display:flex;align-items:center;padding-top:28px}:host .time-current,:host .time-remaining{font-size:16px;color:#bdbdbd;line-height:1}:host .progress-bnd{flex-grow:1;margin:0 15px;position:relative}:host .progress-bnd .progress-bar{display:block;width:100%}:host .sound-button{margin-left:23px;width:32px;height:24px;background:url(js/images/video/ico_sound.png);background-position:1px 0;background-size:29px 24px;background-repeat:no-repeat;margin-right:5px}:host .sound-button.mute{background-position:0 0;background-size:32px 24px;background-image:url(js/images/audio/ico_mute.png)}:host .volume-bar{width:68px;margin-left:5px}:host .num-marker{width:19px;height:26px;background:url(js/images/audio/num_marker.png);background-size:100% 100%;background-repeat:no-repeat;position:absolute;top:calc(-3px - 100%);transform:translateX(-50%);cursor:pointer;font-size:12px;color:#fff;text-align:center;padding-top:1px}:host .repeat-marker{width:10px;height:13px;background:url(js/images/audio/repeat_marker.png);background-repeat:no-repeat;position:absolute;top:calc(10px - 100%);transform:translateX(-50%)}:host .btm-controls{height:50%;display:flex;align-items:center;justify-content:space-between}:host .play-pause{width:22px;height:100%;display:flex;align-items:center;justify-content:center}:host .play-button{width:20px;height:25px;background:url(js/images/audio/ico_play.png);background-size:100% 100%;background-repeat:no-repeat}:host .play-button.play{width:22px;height:22px;background:url(js/images/audio/ico_pause.png);background-size:100% 100%;background-repeat:no-repeat}:host .stop-button{width:22px;height:22px;background:url(js/images/audio/ico_stop.png);background-size:100% 100%;background-repeat:no-repeat}:host .prev-button{width:28px;height:24px;background:url(js/images/audio/ico_prev.png);background-size:100% 100%;background-repeat:no-repeat}:host .next-button{width:28px;height:24px;background:url(js/images/audio/ico_next.png);background-size:100% 100%;background-repeat:no-repeat}:host .btm-controls>div{display:flex;align-items:center}:host .btm-controls .left>button{margin-left:30px}:host .btm-controls .right{margin-right:0;position:relative}:host .btm-controls .right.hide{display:none}:host .repeat-button{width:30px;height:25px;background:url(js/images/audio/ico_repeat.png);background-size:100% 100%;background-repeat:no-repeat}:host .repeat-button.on{background:url(js/images/audio/ico_repeat_on.png)}:host .text-adjust{position:relative;top:1px;margin-right:20px;bottom:0;width:78px;height:30px;border:2px solid #7088d1;border-radius:15px;background-image:url(js/images/audio/ico_text.png);background-position:center center;background-repeat:no-repeat;background-size:20px 20px;display:flex;align-items:center;justify-content:space-between;padding:0 3px}:host .text-adjust.hide{display:none}:host .text-adjust .minus-button,:host .text-adjust .plus-button{width:20px;height:20px;border-radius:50%;background:#7088d1;background-repeat:no-repeat;background-position:center}:host .text-adjust .minus-button{background-image:url(js/images/audio/ico_minus.png);background-position:4.5px 10px}:host .text-adjust .plus-button{background-image:url(js/images/audio/ico_plus.png);background-position:4px 4.5px}:host .script-button{width:25px;height:31px;margin-right:20px;background:url(js/images/audio/ico_script.png);background-size:auto auto;background-position:center center;background-repeat:no-repeat}:host .script-button.on{background-image:url(js/images/audio/ico_script_on.png)}:host .down-button{width:33px;height:31px;margin-right:20px;background:url(js/images/audio/ico_down.png);background-size:100% 100%;background-repeat:no-repeat;transition-duration:.3s;opacity:1;transition-property:transform opacity}:host .down-button.hide{display:none}:host .down-button.hidden{visibility:hidden}:host .down-button.sended{pointer-events:none;transform:translate(0,50px);opacity:0}:host .fullscreen-button{width:29px;height:28px;background:url(js/images/audio/ico_fullscreen.png);background-size:27px 28px;background-repeat:no-repeat;background-size:100% 100%;background-position:center}:host .fullscreen-button.hide{display:none}:host .fullscreen-button.hidden{visibility:hidden}:host .player-box.fullscreen .fullscreen-button{background-size:100% 100%;background-image:url(js/images/audio/ico_smallscreen.png)}:host .size-drag-tgt{width:20px;height:20px;background:url(js/images/audio/drag.png);background-size:100% 100%;position:absolute;bottom:-5px;right:-3px;cursor:pointer}:host .player-box.ver>.top{background-color:#323232}:host .player-box.ver>.middle{display:block}`},714:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{background-color:rgba(255,255,255,0);position:relative;cursor:pointer;height:20px}:host .box{pointer-events:none;left:-3px;right:-3px;top:7px;height:6px;background:#707070;border-radius:3px;position:absolute}:host .btn{pointer-events:all;width:16px;height:16px;background:#fff;border-radius:8px;position:absolute;top:50%;transform:translate(-50%,-50%);z-index:1}:host .btn.audio{width:16px;height:16px;border-radius:8px}`},311:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:relative}:host *{margin:0;padding:0;box-sizing:border-box}:host .scroll{position:absolute;overflow-y:auto;white-space:normal;padding-right:15px;color:#000;left:.8em;right:5px;top:20px;bottom:20px;line-height:1.6em;font-weight:600;scroll-behavior:smooth;text-align:left}:host .scroll::-webkit-scrollbar{width:10px}:host .scroll::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.2);border-radius:5px}:host .speaker{font-weight:700;display:inline-block;padding-top:.3em}:host .speaker:first-child{padding-top:unset!important}:host .script{cursor:pointer;transition-property:color;transition-duration:.2s}:host .script.on{color:#00f!important}:host .script.on *{color:#00f!important}`},907:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}:host *{margin:0;padding:0;box-sizing:border-box}:host button{border:none;cursor:pointer;background:0 0;outline:0}:host::after{content:url(js/images/audio/ico_mini.png) url(js/images/video/ico_pause.png) url(js/images/video/ico_mute.png) url(js/images/video/ico_script_ver.png) url(js/images/video/ico_script_hor.png) url(js/images/video/ico_script_ver_on.png) url(js/images/video/ico_script_hor_on.png) url(js/images/video/ico_smallscreen.png) url(js/images/video/ico_down.png);width:0;height:0;overflow:hidden}:host .player-box{border-radius:5px;background-color:#323232;min-width:640px;width:860px;height:auto;box-shadow:0 0 30.45px 4.55px rgba(0,0,0,.2);position:relative;pointer-events:all}:host .player-box.fullscreen{position:absolute;left:0!important;top:0!important;width:100%!important;height:100%!important;box-shadow:none}:host .player-box>.top{height:35px;display:flex;align-items:center;justify-content:flex-end}:host .player-box .close-button{width:19px;height:19px;background:url(js/images/video/close.png);background-repeat:no-repeat;background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button{width:18px;height:15px;background:url(js/images/audio/ico_mini.png);background-repeat:no-repeat;background-size:100% 100%;background-repeat:no-repeat;margin-right:15px}:host .player-box .minimize-button.hide{display:none}:host .player-box>.bottom{height:50px;display:flex;align-items:center;justify-content:space-between}:host .left-controls{display:flex;flex-grow:1;align-items:center;height:100%;width:75%}:host .play-pause{margin-left:20px;width:22px;height:100%;display:flex;align-items:center;justify-content:center}:host .play-button{width:20px;height:25px;background:url(js/images/video/ico_play.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%}:host .play-button.play{width:22px;height:22px;background:url(js/images/video/ico_pause.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%}:host .stop-button{margin-left:18px;width:22px;height:22px;background:url(js/images/video/ico_stop.png);background-size:100% 100%;background-repeat:no-repeat}:host .prev-button{margin-left:18px;width:28px;height:24px;background:url(js/images/video/ico_prev.png);background-size:100% 100%;background-repeat:no-repeat}:host .next-button{margin-left:18px;width:28px;height:24px;background:url(js/images/video/ico_next.png);background-size:100% 100%;background-repeat:no-repeat}:host .time-current,:host .time-remaining{font-size:16px;color:#bdbdbd;line-height:1}:host .time-current{margin-left:18px}:host .progress-bar{flex-grow:1;margin:0 15px}:host .sound-button{margin-left:3%;width:32px;height:24px;background:url(js/images/video/ico_sound.png);background-position:1px 0;background-size:29px 24px;background-repeat:no-repeat;background-size:29px 24px;margin-right:8px}:host .sound-button.mute{background-position:0 0;background-size:32px 24px;background:url(js/images/video/ico_mute.png);background-size:32px 24px}:host .volume-bar{width:50px;margin-left:4px;margin-right:25px}:host .right-controls{display:flex;align-items:center;height:100%;margin-right:22px;position:relative}:host .script-choice{position:absolute;bottom:100%;right:60%;background:rgba(50,50,50,.85);border-radius:5px;display:flex;align-items:center;padding:4px 9px}:host .script-choice .script-ver{width:22px;height:27px;background:url(js/images/video/ico_script_ver.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%}:host .script-choice .script-hor{width:23px;height:29px;background:url(js/images/video/ico_script_hor.png);background-size:100% 100%;background-repeat:no-repeat;background-size:100% 100%;margin-left:11px}:host .script-button{margin-right:13px;width:23px;height:27px;background:url(js/images/video/ico_script.png);background-size:100% 100%;background-repeat:no-repeat}:host .script-button.hide{display:none}:host .down-button{margin-right:13px;width:33px;height:31px;background:url(js/images/video/ico_down.png);background-size:100% 100%;background-repeat:no-repeat;transition-duration:.3s;opacity:1;transition-property:transform opacity}:host .down-button.hide{display:none}:host .down-button.hidden{visibility:hidden}:host .down-button.sended{pointer-events:none;transform:translate(0,50px);opacity:0}:host .fullscreen-button{width:29px;height:28px;background:url(js/images/video/ico_fullscreen.png);background-size:27px 28px;background-repeat:no-repeat;background-size:100% 100%;background-position:center}:host .player-box>.middle{position:relative;min-height:240px}:host .media-box{text-align:center;height:100%}:host .media-box video{background-color:#000;width:100%;height:100%;object-fit:contain;outline-style:none}:host .player-box .script-box{background-color:#fff;height:49%;display:none}:host .player-box.ver .middle{min-height:360px}:host .player-box.ver .media-box{height:51%}:host .player-box.ver .script-box{display:block;height:49%}:host .player-box.ver .script-button{background-image:url(js/images/video/ico_script_ver_on.png)}:host .player-box.hor{min-width:600px}:host .player-box.hor .middle{display:flex}:host .player-box.hor .media-box{width:49%;height:100%}:host .player-box.hor .script-box{display:block;width:51%;height:100%}:host .player-box.hor .script-button{background-image:url(js/images/video/ico_script_hor_on.png)}:host .player-box.fullscreen>.top{display:none!important}:host .player-box.fullscreen>.middle{height:calc(100% - 50px)!important}:host .player-box.fullscreen .media-box video{object-fit:fill!important}:host .player-box.ver.fullscreen .media-box video{height:100%!important;object-fit:contain!important}:host .player-box.hor.fullscreen .media-box video{width:100%!important;object-fit:contain!important}:host .player-box.fullscreen .fullscreen-button{background-size:100% 100%;background-image:url(js/images/video/ico_smallscreen.png)}:host .drag{width:17px;height:17px;background:url(js/images/video/drag.png);background-size:100% 100%;position:absolute;bottom:-4px;right:-2px;cursor:pointer}:host .player-box.fullscreen .drag{display:none}`},835:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i(897).iv`:host{position:absolute;display:flex;z-index:50;left:0;width:100%;top:0;height:100%;align-items:center;justify-content:center;touch-action:none;user-select:none}`},105:()=>{},107:(t,e,i)=>{const s=1280,o=1280;var n=i(486);const r=[{bookkey:9323,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23161,classid:1423,unitid:19972,lessonid:19977,curriType:""},{bookkey:10041,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23162,classid:1423,unitid:19972,lessonid:19977,curriType:""},{bookkey:9971,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23163,classid:1423,unitid:19972,lessonid:19977,curriType:""},{bookkey:10040,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23164,classid:1423,unitid:19972,lessonid:19977,curriType:""},{bookkey:9404,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23165,classid:1423,unitid:19972,lessonid:19977,curriType:""},{bookkey:9405,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23166,classid:1423,unitid:19972,lessonid:19977,curriType:""},{bookkey:9849,curriculum:{thumbnail:"",code:"0001000100010005",progbooktype:0,subDiv:"",depth_name:"Concept 5",cmsLevel:"C5",div:"M0408",depth:4,name:"Compare Numbers to 5",extraactivity:null,useYn:"Y",id:19977,info:""},bookid:23167,classid:1423,unitid:19972,lessonid:19977,curriType:""}],a=[{thumbnail:"",code:"00010001000100050001",progbooktype:0,book:{ibooktype:0,path:"/content/9323",cmsKey:9323,ibookstart:0,id:23161,completed:0,viewMode:2,updatetime:"",key:9005,ibookend:0},subDiv:"M050101",depth_name:"Get Ready",cmsLevel:"",div:"M0501",depth:5,name:"Quiz",extraactivity:null,useYn:"",id:20108,info:"Warm-Up"},{thumbnail:"",code:"00010001000100050002",progbooktype:0,book:{ibooktype:0,path:"/content/10041",cmsKey:10041,ibookstart:0,id:23162,completed:0,viewMode:2,updatetime:"",key:9418,ibookend:0},subDiv:"M050102",depth_name:"What Will We Learn?",cmsLevel:"",div:"M0501",depth:5,name:"Learning Objective",extraactivity:null,useYn:"",id:20109,info:"Warm-Up"},{thumbnail:"https://attach.fel40.com/2021/10/27/FILE202110271835274901.png",code:"00010001000100050003",progbooktype:0,book:{ibooktype:0,path:"/content/9971",cmsKey:9971,ibookstart:0,id:23163,completed:0,viewMode:2,updatetime:"",key:9411,ibookend:0},subDiv:"M050202",depth_name:"Take a Look",cmsLevel:"",div:"M0502",depth:5,name:"Concept Activity",extraactivity:null,useYn:"",id:20110,info:"Concept Learning"},{thumbnail:"https://attach.fel40.com/2021/10/27/FILE202110271835391291.png",code:"00010001000100050004",progbooktype:0,book:{ibooktype:0,path:"/content/10040",cmsKey:10040,ibookstart:0,id:23164,completed:0,viewMode:2,updatetime:"",key:9419,ibookend:0},subDiv:"M050204",depth_name:"Let&#39;s Review",cmsLevel:"",div:"M0502",depth:5,name:"Concept Summary",extraactivity:null,useYn:"",id:20111,info:"Concept Learning"},{thumbnail:"",code:"00010001000100050005",progbooktype:0,book:{ibooktype:0,path:"/content/9404",cmsKey:9404,ibookstart:0,id:23165,completed:0,viewMode:2,updatetime:"",key:10353,ibookend:0},subDiv:"M050501",depth_name:"Learning the Basics",cmsLevel:"",div:"M0505",depth:5,name:"Independent Practice",extraactivity:null,useYn:"",id:20112,info:"Problem Solving"},{thumbnail:"",code:"00010001000100050006",progbooktype:0,book:{ibooktype:0,path:"/content/9405",cmsKey:9405,ibookstart:0,id:23166,completed:0,viewMode:2,updatetime:"",key:10352,ibookend:0},subDiv:"M050502",depth_name:"Learning in Depth",cmsLevel:"",div:"M0505",depth:5,name:"Extended Practice",extraactivity:null,useYn:"",id:20113,info:"Problem Solving"},{thumbnail:"",code:"00010001000100050007",progbooktype:0,book:{ibooktype:0,path:"/content/9849",cmsKey:9849,ibookstart:0,id:23167,completed:0,viewMode:2,updatetime:"",key:9405,ibookend:0},subDiv:"M050601",depth_name:"Let&#39;s Check",cmsLevel:"",div:"M0506",depth:5,name:"Math Talk",extraactivity:null,useYn:"",id:20114,info:"Wrap-Up"}];const d=["","/content/sample/male_01.png","/content/sample/user_none_01.png","/content/sample/thumb0.jpg","/content/sample/user_none_02.png","/content/sample/male_02.png","/content/sample/female_03.png","/content/sample/male_03.png","/content/sample/female_04.png","/content/sample/female_04.png"],l=["/content/sample/male_02.png","/content/sample/female_03.png","/content/sample/male_03.png","/content/sample/female_04.png","/content/sample/female_04.png","/content/sample/male_01.png","/content/sample/male_01.png","/content/sample/user_none_01.png","/content/sample/female_02.png","/content/sample/user_none_02.png"],h=["Olivia","Ray","Aiden","Leonardo","Blue","Lisa","Irene","Ted","Helen","Kate"],c=["Olivia","Ray","Aiden","Kevin","Blue","Lisa","Irene","Ted","Helen","Kate"];let p,m;function u(t,e,i,s,o,d,l,h,c,u){function _(e){var i;null===(i=t.contentWindow)||void 0===i||i.postMessage(e,"*")}function g(t,i){const s={type:"notifyEtcMsg",from:"launcher",fromId:"",msg:t};e.handleWssMessage(s,i)}p=d,m=l,i.addEventListener("send-stamp",(t=>{g({etcType:"stamp",etcMsg:void 0},t.detail)})),s.addEventListener("close-player",(t=>{_({type:"notifyClosedPlayer",from:"launcher",msg:void 0}),g({etcType:"endScript",etcMsg:void 0})})),s.addEventListener("changed-focus-idx",(t=>{g({etcType:"changedFocusIdx",etcMsg:t.detail})})),s.addEventListener("send-scripts",(t=>{g({etcType:"sendScript",etcMsg:t.detail})})),window.addEventListener("message",(d=>{return l=this,f=void 0,y=function*(){var l,f;if(canConsole()&&console.info("base:base.ts",d.data,d.source===t.contentWindow),d.source===t.contentWindow){const t=d.data;if(!t||"content"!==t.from)return;switch(canConsole()&&console.info("base:teacher=>app",t.type,t),t.type){case"getMyProfile":_({type:"notifyMyProfile",from:"launcher",msg:{id:1,learn_idx:1,name:"A",nickName:"B",thumbnail:"C",defaultThumbnail:"C",profileThumbnail:"C",birthday:"C",gender:"M",displayMode:"1"}});break;case"getServerHost":_({type:"notifyServerHost",from:"launcher",msg:{host:""}});break;case"getAllStudentsProfile":_({type:"notifyAllStudentsProfile",from:"launcher",msg:n.cloneDeep(o)});break;case"getLoginStudentsProfile":_({type:"notifyLoginStudentsProfile",from:"launcher",msg:e.getLoginStudents()});break;case"init":_({type:"notifyStartContent",from:"launcher",msg:{addOnHost:"",bookid:1,contentProgress:0,lesson:"Lesson",step:"Step",curriculumId:1}});break;case"sendMsgToStudent":{const i=t.msg;e.sendPADToID(i.id,{type:"notifyReceiveMsg",from:"launcher",msg:i})}break;case"broadcastMsgToStudents":{const i=t.msg;e.sendAllPAD({type:"notifyReceiveMsg",from:"launcher",msg:i})}break;case"gotoBookByKey":h&&h(t);break;case"gotoBookParent":c&&c();break;case"uploadFileToServer":_({type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:t.msg.url}});break;case"uploadImageToServer":_({type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:t.msg.src}});break;case"uploadFileToServerMulti":{const e=[];t.msg.forEach((t=>{n.isString(t)?e.push({result:"success",url:t}):t&&n.isString(t.url)&&e.push({result:"success",url:t.url})})),_({type:"notifyUploadToServerMultiResult",from:"launcher",msg:e})}break;case"startStudentReportProcess":{const s=n.cloneDeep(e.getLoginStudents()),o=t;o.msg.viewType,yield i.$start(o.msg.type,null!==(l=o.msg.viewType)&&void 0!==l?l:"C",s,o.msg.subType,{theme:p,subTheme:null!=m?m:"js"}),6===o.msg.type&&o.msg.data&&n.isArray(o.msg.data.studentIdList)?(o.msg.data.studentIdList.forEach((t=>{const e=n.find(s,{id:t});e&&i.$add({id:e.id,name:e.name,nickName:e.nickName,thumbnail:e.thumbnail,defaultThumbnail:e.defaultThumbnail,profileThumbnail:e.profileThumbnail,displayMode:e.displayMode,gender:e.gender,noImage:e.noImage,noProfileImage:e.noProfileImage,content:{value:"",option:""}})})),i.$setViewList(!0),i.$setViewMenu(!1)):(i.$setViewList(!1),i.$setViewMenu(!1))}break;case"showStudentReportUI":i.$setViewMenu(!0);break;case"hideStudentReportUI":i.$setViewMenu(!1);break;case"showStudentReportListPage":i.$setViewList(!0);break;case"hideStudentReportListPage":i.$setViewList(!1);break;case"addStudentForStudentReportType6":if(6===i.$type){const s=t,o=e.getLoginStudents(),r=n.find(o,{id:s.msg.studentId});r&&i.$add({id:r.id,name:r.name,nickName:r.nickName,thumbnail:r.thumbnail,defaultThumbnail:r.defaultThumbnail,profileThumbnail:r.profileThumbnail,displayMode:r.displayMode,gender:r.gender,noImage:r.noImage,noProfileImage:r.noProfileImage,content:{value:"",option:""}})}break;case"getReportReturns":_({type:"notifyReportReturns",from:"launcher",msg:i.$getReturns()});break;case"addReportItem":{const e=t;i.$add(e.msg)}break;case"showContentToolTitlebar":case"hideContentToolTitlebar":break;case"popupPlayer":{const e=t;if(e.msg.url){const t=e.msg.url,i=t.toLocaleLowerCase().endsWith(".mp3")?"mp3":"mp4";s.load(t,i,null!==(f=e.msg.scripts)&&void 0!==f?f:[])}}break;case"closePlayer":s.close();break;case"sendEtcMsg":g(t.msg);break;case"moveNextContent":case"movePrevContent":u&&u("movePrevContent"===t.type?-1:1,0);break;case"internalMsg":if("getNaviInfo"===t.msg.subType){const e=function(t){const e=r.find((t=>0===t.bookkey));if(e){const t=n.cloneDeep(e);return t.curriculum.childrenList=n.cloneDeep(a),t}return null}();if(e){const i={type:"internalMsg",from:"content",msg:{to:"book",subType:"notifyNaviInfo",info:e}};console.log("************************************internalMsg",i,t),_(i)}}else console.warn("************************************not support internalMsg",t);break;default:console.warn("from teacher",t)}}else if(d.source===window){const t=d.data;if(!t)return;if("notifyStudentReport"===t.type){const s=t,o=e.getLoginStudents(),r=n.find(o,(e=>"S"+e.id===t.fromId));if(!r)return;const a=n.cloneDeep(r);a.content=s.msg.data,i.$add(a),s.msg&&s.msg.data&&s.msg.data.subData&&_(s)}}else e.handlePostMessage(d)},new((v=void 0)||(v=Promise))((function(t,e){function i(t){try{o(y.next(t))}catch(t){e(t)}}function s(t){try{o(y.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof v?o:new v((function(t){t(o)}))).then(i,s)}o((y=y.apply(l,f||[])).next())}));var l,f,v,y}))}var _=i(527);function g(t){return new Promise((e=>{setTimeout((()=>e()),t)}))}let f=Date.now();var v,y,b,x=function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}d((s=s.apply(t,e||[])).next())}))};function k(t){t.getTracks().forEach((e=>{try{e.stop()}catch(t){}t.removeTrack(e)}))}class w extends _.TypedEmitter{constructor(t,e){super(),this._videoRecorder=null,this._audioRecorder=null,this._isRear=!1,this._stream_cam=null,this._stream=null,this._mimeAudio="",this._mimeVideo="",this._mimeType="",this._timerid=-1,this._chunks=[],this._state="",this._mirror_state=0,this._ctx=null,this._zIndexTop=!1,this._draggable=!1,this._notifyRecordTime=!1,this._videoBnd={top:"0",left:"0",width:"100%",height:"100%"},this._cameraStarting=!1,this.drawCanvas=()=>{if(0===this._mirror_state)return;if(""===this._state)return;if(this._isRear)return;if(!this._stream)return;if(this._mimeType!==this._mimeVideo)return;const t=this._video,e=this._ctx_mirror;if(1===this._mirror_state){if("starting"!==this._state)return;if(t.videoWidth>0&&t.videoHeight>0){this._mirror_state=2;const i=Math.min(720,4*t.videoWidth),s=Math.round(i*t.videoHeight/t.videoWidth);e.canvas.width=i,e.canvas.height=s,e.canvas.captureStream(12).getVideoTracks().forEach((t=>{var e;const i=t;i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)}))}}this._mirror_state>1&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save(),e.setTransform(-1,0,0,1,e.canvas.width,0),e.drawImage(t,0,0,e.canvas.width,e.canvas.height),e.setTransform(1,0,0,1,0,0),e.restore()),window.requestAnimationFrame(this.drawCanvas)},this._isMobile=t,this._worker=new Worker("./js/recorder-worker.js"),this._camDirFnc=e;try{["audio/mpeg-1","audio/mpeg","audio/mp3","audio/wav","audio/webm","audio/wav","audio/pcm","audio/ogg"].some((t=>!!MediaRecorder.isTypeSupported(t)&&(this._mimeAudio=t,!0))),["video/mpeg-4","video/mp4","video/webm","video/ogg"].some((t=>!!MediaRecorder.isTypeSupported(t)&&(this._mimeVideo=t,!0))),this.isSupported=!0}catch(t){canConsole()&&console.error("[recorder]error",`/util/record.ts constructor error=${t}`),this.isSupported=!1}canConsole()&&(""===this._mimeAudio&&console.warn("[recorder]warn",0,"/util/record.ts constructor this._mimeAudio is empty"),""===this._mimeVideo&&console.warn("[recorder]warn",0,"/util/record.ts constructor this._mimeVideo is empty"));const i=document.createElement("canvas");this._ctx_mirror=i.getContext("2d"),this._video=document.createElement("video"),this._video.autoplay=!0,this._video.muted=!0,this._video.id="recorder-"+function(){const t=Date.now();return t>f?f=t:f+=1,f.toString(36)}()}get state(){return this._state}get video(){return this._video}get zIndexTop(){return this._zIndexTop}get draggable(){return this._draggable}get videoBnd(){return this._videoBnd}startCamera(t,e,i){return x(this,void 0,void 0,(function*(){const s=Date.now();if(canConsole()&&console.log("[recorder]a => startCamera",this._state,s),"loading"!==this._state)return void i();this._stopStream();const o=navigator.mediaDevices.getSupportedConstraints(),n={audio:!0};let r=!1;this._isMobile?e&&t&&o.facingMode?(n.video={facingMode:"environment"},r=!0):(e=!1,n.video=t,r=!0):(e=!1,n.video=t),this._isRear=e;let a=null;try{if(canConsole()&&console.log("[recorder]b => startCamera",this._state,Date.now()-s,s,n),this._state="starting",this.emit("change-state"),this._cameraStarting=!0,a=yield navigator.mediaDevices.getUserMedia(n),this._cameraStarting=!1,canConsole()&&console.log("[recorder]c => startCamera",this._state,Date.now()-s,s),"starting"!==this._state)return"ready"!==this._state&&k(a),void i();r=!0,this._stream_cam=a}catch(t){return this._cameraStarting=!1,this._stream=null,void i()}if(a)if(t)if(e)this._mirror_state=0,r?this._stream=a:(this._stream=new MediaStream,a.getTracks().forEach((t=>{var e;const i=t.clone();i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)}))),this._video.style.transform="",this._video.srcObject=this._stream,i();else{for(this._mirror_state=1,this._video.style.transform="scale(-1, 1)",this._video.srcObject=a,this._stream=new MediaStream,a.getAudioTracks().forEach((t=>{var e;const i=t.clone();i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)})),canConsole()&&console.log("[recorder]d => startCamera",this._state,Date.now()-s,s),this.drawCanvas();1===this._mirror_state;)yield g(100);canConsole()&&console.log("[recorder]e => startCamera",this._state,Date.now()-s,s),i()}else this._mirror_state=0,r?this._stream=a:(this._stream=new MediaStream,a.getAudioTracks().forEach((t=>{var e;const i=t.clone();i.enabled||(i.enabled=!0),null===(e=this._stream)||void 0===e||e.addTrack(i)}))),i();else this._mirror_state=0,i()}))}setUI(t,e,i,s){this._videoBnd.left=t.left+"px",this._videoBnd.top=t.top+"px",this._videoBnd.width=t.width>0?t.width+"px":"100%",this._videoBnd.height=t.height>0?t.height+"px":"100%",this._zIndexTop=e,this._draggable=i,this._notifyRecordTime=s}initRecord(t,e,i){return x(this,void 0,void 0,(function*(){if(n.isUndefined(i)&&(i=this._isRear),!this.isSupported)return void e(!1);if("ready"===this._state){if("video"===t&&this._isRear===i&&this._mimeType===this._mimeVideo)return void e(!0);if("voice"===t&&this._mimeType===this._mimeAudio)return void e(!0)}else if(""!==this._state)return void e();let s=0;for(;this._cameraStarting&&(yield g(100),s++,!(s>30)););this.clear(),"video"===t?this._mimeType=this._mimeVideo:(this._mimeType=this._mimeAudio,this._videoBnd={left:"0",top:"0",width:"100%",height:"100%"}),this._state="loading",this.emit("change-state"),this.startCamera(this._mimeType===this._mimeVideo,i,(()=>"starting"===this._state?this._stream?(this._state="ready",this.emit("change-state"),void e(!0)):(this._stopStream(),void e(!1)):(this._stopStream(),void e())))}))}toggleCam(t,e){"ready"===this._state&&this._mimeType===this._mimeVideo?n.isUndefined(t)||!this._stream||this._isRear!==t?(n.isUndefined(t)&&(t=!this._isRear),this._state="loading",this.emit("change-state"),this.startCamera(!0,t,(()=>"starting"===this._state?this._stream?(this._state="ready",this.emit("change-state"),void e(!0)):void e(!1):void e()))):e(!0):e(!1)}capture(t,e,i,s){return x(this,void 0,void 0,(function*(){if(!this.isSupported)return void s("");if("ready"!==this._state||!this._stream)return void s("");const o=this._video;for(;1===this._mirror_state||!o.videoWidth||!o.videoHeight;)yield g(100);if("ready"!==this._state||!this._stream)return void s("");let n;this._state="recording",this.emit("change-state");let r=this._ctx;r?(n=r.canvas,r.clearRect(0,0,n.width,n.height)):(n=document.createElement("canvas"),r=n.getContext("2d")),this._ctx=r,n.width=t.width,n.height=t.height;const a=o.videoWidth/e,d=o.videoHeight/i;r.save(),this._isRear||r.setTransform(-1,0,0,1,t.width,0),r.drawImage(o,t.left*a,t.top*d,t.width*a,t.height*d,0,0,t.width,t.height),r.setTransform(1,0,0,1,0,0),r.restore();const l=n.toDataURL("image/jpeg",.7);this._state="ready",this.emit("change-state"),r.clearRect(0,0,n.width,n.height),s(l)}))}record(){return x(this,void 0,void 0,(function*(){return new Promise(((t,e)=>x(this,void 0,void 0,(function*(){if(this.isSupported)if("ready"===this._state&&this._stream)if(this._clearRecorder(),this._state="recording",this.emit("change-state"),this._mimeType===this._mimeAudio){const e=new AudioContext;e.createScriptProcessor||(e.createScriptProcessor=e.createJavaScriptNode);const i=e.createGain(),s=e.createMediaStreamSource(this._stream);s.connect(i);const o=e.createScriptProcessor(void 0,2,2);i.connect(o),o.connect(e.destination),this._audioRecorder={ctx:e,mic:s,mixer:i,processor:o};const n={type:"start",msg:{sampleRate:e.sampleRate,bitRate:128}};this._worker.postMessage(n);let r=!0,a=0;o.addEventListener("audioprocess",(i=>{if(r&&t(!0),r=!1,"recording"!==this._state)return;const s=[];for(let t=0;t<2;++t)s[t]=i.inputBuffer.getChannelData(t);const o={type:"record",msg:s};if(this._worker.postMessage(o),this._notifyRecordTime){const t=e.currentTime,i=Math.round(10*t);a!==i&&(a=i,this.emit("record-time",t))}}))}else{const e=this._video;for(;1===this._mirror_state||!e.videoWidth||!e.videoHeight;)yield g(100);this._videoRecorder=new MediaRecorder(this._stream,{mimeType:this._mimeType,audioBitsPerSecond:64e3,videoBitsPerSecond:64e4}),this._videoRecorder.ondataavailable=t=>{const e=t.data;this._chunks.push(e)},this._videoRecorder.start();let i=!0;const s=e.currentTime,o=()=>{i&&t(!0),i=!1,this._videoRecorder&&"recording"===this._state?(this._notifyRecordTime&&this.emit("record-time",e.currentTime-s),this._videoRecorder.requestData()):e.removeEventListener("timeupdate",o)};e.addEventListener("timeupdate",o)}else t(!1);else t(!1)}))))}))}stopAndSave(){return new Promise((t=>{var e,i;if(canConsole()&&console.info("[recorder] stopAndSave this._state",this._state),"recording"===this._state)if(this.isSupported)if(canConsole()&&console.info("[recorder] stopAndSave this._state",this._state,null===(e=this._videoRecorder)||void 0===e?void 0:e.state),this._timerid>=0&&(window.clearInterval(this._timerid),this._timerid=0),this._mimeType===this._mimeAudio){const e=new MessageChannel;e.port1.onmessage=e=>{const i=e.data;if(i&&i.type&&(canConsole()&&console.info("[recorder] stopAndSave audio receiveMessage, this._state",this._state),"encoded"===i.type)){const i=e.data.msg,s=new FileReader;s.readAsDataURL(i),s.onloadend=()=>{var e;canConsole()&&console.info("[recorder] stopAndSave audio receiveMessage, reader.onloadend this._state",this._state),this.clear();const i=null===(e=s.result)||void 0===e?void 0:e.toString();t(null!=i?i:null),this.emit("recorded",null!=i?i:""),s.onloadend=null}}},canConsole()&&console.info("[recorder] stopAndSave audio postMessage, this._state",this._state),this._state="saving",this.emit("change-state");const i={type:"end",msg:void 0};this._worker.postMessage(i,[e.port2])}else{if(!this._videoRecorder)return this._state="ready",this.emit("change-state"),void t(null);this._videoRecorder.onstop=e=>{canConsole()&&console.log("[recorder] this._videoRecorder.onstop",this._state,this._chunks.length);const i=new Blob(this._chunks,{type:this._mimeType}),s=new FileReader;s.onloadend=()=>{var e;canConsole()&&console.log("[recorder] reader.onloadend",this._state,s.result,"<--reader.result");const i=null===(e=s.result)||void 0===e?void 0:e.toString();t(null!=i?i:null),this.emit("recorded",null!=i?i:""),this._clearRecorder(),s.onloadend=null},s.readAsDataURL(i)},canConsole()&&console.log("[recorder] this._videoRecorder.stop",this._state,null===(i=this._videoRecorder)||void 0===i?void 0:i.state),this._state="saving",this.emit("change-state"),canConsole()&&console.log("this._videoRecorder.stop",this._video.currentTime),this._videoRecorder.stop()}else t(null);else t(null)}))}_clearRecorder(){if(this._timerid>=0&&(canConsole()&&console.info("_clearRecorder _timerid",this._timerid),window.clearInterval(this._timerid),this._timerid=0),this._videoRecorder&&(canConsole()&&console.info("_clearRecorder _videoRecorder"),this._videoRecorder.onstop=null,this._videoRecorder.ondataavailable=null,"recording"===this._videoRecorder.state&&this._videoRecorder.stop(),this._videoRecorder=null),this._chunks=[],this._audioRecorder){canConsole()&&console.info("_clearRecorder _audioRecorder");const{ctx:t,mic:e,mixer:i,processor:s}=this._audioRecorder;s.disconnect(),e.disconnect(),i.disconnect();const o={type:"cancel",msg:void 0};this._worker.postMessage(o),this._audioRecorder=null}canConsole()&&console.info("[recorder]_clearRecorder this._state",this._state),""!==this._state&&"loading"!==this._state&&(this._state="ready",this.emit("change-state"))}_stopStream(){this._stream_cam&&(canConsole()&&console.info("[recorder]_stopStream _stream_cam"),k(this._stream_cam),this._stream_cam=null),this._stream&&(canConsole()&&console.info("[recorder]_stopStream _stream"),k(this._stream),this._stream=null)}clear(){this._video.style.transform="",this._video.srcObject=null,this._video.load(),this._clearRecorder(),this._stopStream(),this._chunks.length=0,this._state="",this.emit("change-state"),this._mirror_state=0,this._isRear=!1,this._videoBnd={left:"0",top:"0",width:"100%",height:"100%"}}}!function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.LOADING=1]="LOADING",t[t.PLAYBACK_ERROR=2]="PLAYBACK_ERROR",t[t.READY=3]="READY",t[t.STANDBY=4]="STANDBY",t[t.BUFFERING=5]="BUFFERING",t[t.PAUSED=6]="PAUSED",t[t.PLAYING=7]="PLAYING"}(v||(v={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(y||(y={})),function(t){t[t.NETWORK_EMPTY=0]="NETWORK_EMPTY",t[t.NETWORK_IDLE=1]="NETWORK_IDLE",t[t.NETWORK_LOADING=2]="NETWORK_LOADING",t[t.NETWORK_NO_SOURCE=3]="NETWORK_NO_SOURCE"}(b||(b={}));class $ extends _.TypedEmitter{constructor(){super(),this.m_media=null,this.m_url=null,this.m_startTime=0,this.m_endTime=0,this.m_maxTime=0,this.m_seekTime=-1,this.m_onTimer=-1,this.m_playEnded=!1,this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=-1,this.m_bPlay=!1,this.m_myState=0,this.m_duration=0,this.m_currentTime=0,this.fullscreen=!1,this.m_muted=!1,this.m_volume=1,this._onTime=t=>{this.m_onTimer>=0&&(this._onTimeUpdate(),this.m_onTimer=window.requestAnimationFrame(this._onTime))},this.m_bPlay=!1,this.m_startTime=-1,this.m_endTime=-1}get bPlay(){return this.m_bPlay}get myState(){return this.m_myState}get duration(){return this.m_duration}get muted(){return this.m_muted}get volume(){return this.m_volume}get media(){return this.m_media}get currentTime(){return this.m_currentTime}setStartEndTime(t,e){this.m_startTime=t,this.m_endTime=e}setMuted(t){this.m_muted=t,this.m_media&&(this.m_media.muted=t)}setVolume(t){this.m_volume=t,this.m_media&&(this.m_media.volume=t)}setMutedTemp(t){this.m_media&&(this.m_media.muted=t)}_initTemp(){this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=0}play(t){void 0===t&&(t=!0),this.m_bPlay=!0,t&&this._initTemp(),this.m_playEnded&&this.m_media&&this.m_myState>=3&&(this.m_media.currentTime=this.m_startTime/1e3),this.m_playEnded=!1,this._playOrPause()}pause(t){void 0===t&&(t=!0),this.m_bPlay=!1,t&&this._initTemp(),this._playOrPause()}start(){this.seek(0),this.play()}seek(t,e){if(void 0===e&&(e=!0),!this.m_media||this.m_myState<3)this.m_seekTime=t;else{if(e&&this._initTemp(),this.m_seekTime=-1,isNaN(t)||t<0)t=0;else if(t>=this.m_duration-100)return t=this.m_duration,void this._playEnded();this.m_playEnded=!1,this.m_media.currentTime=(this.m_startTime+t)/1e3,this._onTimeUpdate()}}gotoAndPlay(t,e,i){if(this.m_standBy=!1,!this.m_media||this.m_duration<=0)return this._load(),this.m_bPlay_temp=!0,this.m_startTime_temp=t,this.m_endTime_temp=e,void(this.m_loop_temp=i);this.m_playEnded=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=t,this.m_endTime_temp=e,t=t>=0?t:this.currentTime,e=e>=0&&e<this.m_duration?e:this.m_duration,this.m_bPlay=!0,t>=e||i<=0?(this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=0):(this.m_endTime_temp>=this.m_duration&&(this.m_endTime_temp=-1),this.m_loop_temp=i,this.m_loopCnt_temp=0,this.m_startTime_temp>=0&&(this.m_media.currentTime=(t+this.m_startTime)/1e3,this._onTimeUpdate())),this._playOrPause()}gotoAndPause(t,e){void 0===e&&(e=!0),this.m_bPlay=!1,e&&this._initTemp(),this.m_media&&(t=t>=0&&t<this.m_duration?t:this.currentTime,this.m_media.currentTime=(t+this.m_startTime)/1e3,this._onTimeUpdate(),this._playOrPause())}connect(){this.m_media&&this.m_url&&this.m_myState>=1&&3===this.m_media.networkState&&0===this.m_media.readyState&&(this.m_media.src=this.m_url,this.m_media.load())}unconnect(){this.m_media&&(this.m_media.paused||this.m_media.pause(),this.m_myState>=1&&(this.m_myState>=3&&(this.m_seekTime=1e3*this.m_media.currentTime-this.m_startTime),this.m_media.src="",this.m_media.load(),this.m_onTimer>=0&&(window.cancelAnimationFrame(this.m_onTimer),this.m_onTimer=-1),this.m_maxTime=0,this.m_seekTime=-1,this.m_playEnded=!1,this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=-1,this.m_bPlay=!1,this.m_duration=0,this.m_url=null,this.m_muted=!1,this.m_media.muted=!1,this.m_media.volume=1,this._setState(0)))}_load(){this.m_media&&this.m_url&&this.m_myState<1&&(this._setState(1),this.m_media.src=this.m_url,this.m_media.load())}load(t){this.m_url=t,this._load()}unload(){this.clearMedia(),this.m_url=null,this.m_bPlay=!1,this.m_bPlay_temp=!1,this.m_startTime=0,this.m_endTime=0,this.m_maxTime=0,this.m_seekTime=-1,this.m_onTimer=-1,this.m_playEnded=!1,this.m_standBy=!1,this.m_bPlay_temp=!1,this.m_startTime_temp=-1,this.m_endTime_temp=-1,this.m_loop_temp=-1,this.m_loopCnt_temp=-1,this.m_duration=0,this.m_currentTime=0,this.fullscreen=!1,this.m_muted=!1,this.m_volume=1,this._setState(0)}initMedia(t){if(this.m_media||!t)return;this.m_media=t;const e=e=>{if(this.m_media&&t.duration>0){if(t.duration>1e6)return void(t.currentTime=1e6);t.muted=this.m_muted,t.volume=this.m_volume,this.m_maxTime<=0?(this.m_maxTime=1e3*t.duration,this.m_endTime>=this.m_maxTime?this.m_endTime=0:this.m_endTime>0&&(this.m_maxTime=this.m_endTime),(this.m_startTime<0||this.m_startTime>=this.m_maxTime)&&(this.m_startTime=0),this.m_duration=this.m_maxTime-this.m_startTime,this.m_bPlay_temp?(this._setState(3),this.gotoAndPlay(this.m_startTime_temp,this.m_endTime_temp,this.m_loop_temp)):this.m_seekTime>0&&this.m_seekTime<this.m_duration?(this._setState(3),this.m_media.currentTime=(this.m_seekTime+this.m_startTime)/1e3):0===this.m_startTime?(this.m_media.currentTime=0,this._setState(3),this._playOrPause()):this.m_media.currentTime=this.m_startTime/1e3,this.m_seekTime=-1):this.m_seekTime>=0&&(this.m_seekTime<this.m_duration&&(this.m_media.currentTime=(this.m_seekTime+this.m_startTime)/1e3),this.m_seekTime=-1)}};t.muted=this.m_muted,t.volume=this.m_volume,t.onabort=t=>{console.log("onabort")},t.oncanplay=e,t.oncanplaythrough=e,t.ondurationchange=e,t.onloadeddata=e,t.onloadedmetadata=e,t.onerror=t=>{1===this.m_myState&&this._setState(2)},t.onended=t=>{this.m_media&&(this.m_maxTime<=0||this.m_myState<3||this._playEnded())},t.onpause=t=>{this.m_media&&(this.m_maxTime<=0||this.m_myState<3||(this.m_bPlay=!1,this._setState(6)))},t.onplaying=t=>{this.m_media&&(this.m_maxTime<=0||this.m_myState<3||!this.m_bPlay?this.m_media.paused||this.m_media.pause():this._setState(7))},t.onseeking=t=>{!this.m_media||this.m_maxTime<=0||this.m_myState>=3&&this._setState(5)},t.onseeked=t=>{!this.m_media||this.m_maxTime<=0||(this.m_myState>=3?this._playOrPause():this.m_myState<3&&this.m_startTime>0&&(Math.abs(this.m_startTime-1e3*this.m_media.currentTime)<100?(this._setState(3),this._playOrPause()):this.m_media.currentTime=this.m_startTime/1e3))},t.ontimeupdate=t=>{this.m_myState<=2||this._onTimeUpdate()},t.onvolumechange=t=>{!this.m_media||this.m_maxTime<=0||this.emit("volume-changed",this.m_media.volume)}}clearMedia(){this.m_media&&(this.m_media.paused||this.m_media.pause(),this.m_myState>=1&&(this.m_media.src="",this.m_media.load()),this.m_media.onabort=null,this.m_media.oncanplay=null,this.m_media.oncanplaythrough=null,this.m_media.ondurationchange=null,this.m_media.onemptied=null,this.m_media.onended=null,this.m_media.onerror=null,this.m_media.onloadeddata=null,this.m_media.onloadedmetadata=null,this.m_media.onpause=null,this.m_media.onplaying=null,this.m_media.onseeked=null,this.m_media.onseeking=null,this.m_media.ontimeupdate=null,this.m_media.onvolumechange=null,this.m_media=null)}_setState(t){if(this.m_myState===t)return;7===t?this.m_onTimer<0&&(this.m_onTimer=window.requestAnimationFrame(this._onTime)):6===t&&this.m_onTimer>=0&&(window.cancelAnimationFrame(this.m_onTimer),this.m_onTimer=-1);const e=this.m_myState;this.m_myState=t,this.emit("state-changed",t,e)}_playOrPause(){if(this.m_media&&!(this.m_myState<3))if(this.m_bPlay){if(this._setState(7),this.m_media.paused){const t=this.m_media.play();t&&t.then((t=>{!this.m_media||this.m_bPlay||this.m_media.paused||this.m_media.pause()})).catch((t=>{!this.m_media||this.m_bPlay||this.m_media.paused||this.m_media.pause()}))}}else this._setState(6),this.m_media.paused||this.m_media.pause()}_onTimeUpdate(){if(!this.m_media)return;let t=1e3*this.m_media.currentTime;if(this.m_loop_temp>0&&this.m_bPlay)t<this.m_startTime?t=this.m_startTime:this.m_endTime_temp>0&&t>=this.m_endTime_temp+this.m_startTime?(this.m_currentTime=this.m_endTime_temp,this.emit("time-changed",this.m_currentTime),this._playEnded()):(this.m_currentTime=t-this.m_startTime,this.emit("time-changed",this.m_currentTime));else if(t<this.m_startTime)t=this.m_startTime;else{if(this.m_endTime>0&&t>=this.m_endTime)return this.m_currentTime=this.m_endTime-this.m_startTime,this.emit("time-changed",this.m_currentTime),void this._playEnded();this.m_currentTime=t-this.m_startTime,this.emit("time-changed",this.m_currentTime)}}_playEnded(){if(this.m_media&&!this.m_playEnded)if(this.m_loop_temp>0&&this.m_bPlay)if(this.m_loopCnt_temp++,this.m_endTime_temp<=0&&(this.m_bPlay=!1,this.emit("play-end")),this.m_loopCnt_temp<this.m_loop_temp){const t=this.m_startTime_temp>=0&&this.m_startTime_temp<this.m_duration?this.m_startTime_temp:0;this.m_media.currentTime=(t+this.m_startTime)/1e3,this.m_media.paused&&this.m_media.play()}else this.m_media.paused||this.m_media.pause(),this.m_bPlay=!1,this.emit("play-end-temp");else this.emit("play-end"),this.m_playEnded=!0,this.m_bPlay=!1,this.m_media.paused||this.m_media.pause(),1e3*this.m_media.currentTime<this.m_maxTime-100&&(this.m_media.currentTime=this.m_maxTime/1e3),this.m_currentTime=this.m_maxTime-this.m_startTime,console.log("playEnd",this.m_myState,6),this._setState(6)}reset(){}}function T(t,e=1){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}class V{constructor(t,e,i,s,o,n,r){let a=!1,d=-1,l=0,h=0;t.style.touchAction="none",t.ondragstart=t.ondrag=t=>{t.preventDefault(),t.stopImmediatePropagation()};let c=new DOMMatrix;const p=[];let m=0;const u=t=>{if(d!==t.pointerId)return;e.preventDefault&&(t.preventDefault(),t.stopImmediatePropagation());const i=c.transformPoint({x:t.clientX,y:t.clientY});if(r){const t=m++%10;p[t]={t:Date.now(),x:i.x,y:i.y}}s(i.x-l,i.y-h,t)},_=i=>{d===i.pointerId&&(e.preventDefault&&(i.preventDefault(),i.stopImmediatePropagation()),t.removeEventListener("pointermove",u,!0),t.removeEventListener("pointerup",_,!0),t.removeEventListener("pointercancel",_,!0),t.releasePointerCapture(d),d=-1,o&&o(i))},g=s=>{if(!s.isPrimary||1!==s.buttons)return;let o;const r=i(s);if("boolean"==typeof r){if(!r)return;o=!1}else{if(!r.ok)return;o=r.preventCapture}e.preventDefault&&(s.preventDefault(),s.stopImmediatePropagation()),c=function(t){if(t instanceof SVGGElement||t instanceof SVGSVGElement){const e=new DOMMatrix,i=t.getScreenCTM();return i&&(e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e.e=i.e,e.f=i.f),e}const e=[];let i=t;for(;i;)e.unshift(i),i=i.offsetParent;let s=window.scrollY,o=window.scrollX;const n=new DOMMatrix;for(let t=0;t<e.length;t++){i=e[t],n.translateSelf(i.offsetLeft-o,i.offsetTop-s);const r=window.getComputedStyle(i);if(r.transform&&r.transform.startsWith("matrix(")){let t=null;try{t=new DOMMatrix(r.transform)}catch(e){t=null}if(t&&!t.isIdentity){const e=r.transformOrigin.split(" ");let i=parseFloat(e[0]),s=parseFloat(e[1]);isNaN(i)&&(i=0),isNaN(s)&&(s=0),n.translateSelf(i,s),n.multiplySelf(t).translateSelf(-i,-s)}}s=i.scrollTop,o=i.scrollLeft}return function(t){return t.a=T(t.a,3),t.b=T(t.b,3),t.c=T(t.c,3),t.d=T(t.d,3),t.e=T(t.e,3),t.f=T(t.f,3),t}(n)}(null!=n?n:t),c.invertSelf();const a=c.transformPoint({x:s.clientX,y:s.clientY});l=a.x,h=a.y,p.length=0,m=0,d=s.pointerId,o||t.setPointerCapture(d),t.addEventListener("pointermove",u,!0),t.addEventListener("pointerup",_,!0),t.addEventListener("pointercancel",_,!0)};t.addEventListener("pointerdown",g),e.detectEnter&&t.addEventListener("pointerenter",g),a=!0,this.getSwipe=()=>{const t={vx:0,vy:0,length:0,deg:0};if(p.length<3)return t;const e=p.length;let i,s;for(let t=0;t<e;t++){let o=(m-1)%10-t;o=o<0?e+o:o;const n=p[o];if(0===t)i=n;else if(i&&n.t<i.t){s=n;break}}return i&&s&&(t.vx=(i.x-s.x)/(i.t-s.t),t.vy=(i.y-s.y)/(i.t-s.t),t.length=Math.pow(Math.pow(t.vx,2)+Math.pow(t.vy,2),.5),t.length<.2?(t.vx=0,t.vy=0,t.length=0):0===t.vx?t.deg=t.vy>0?90:-90:0===t.vy?t.deg=t.vx>0?0:180:t.vx<0&&t.vy<0?t.deg=180*Math.atan(t.vy/t.vx)/Math.PI-180:t.vx<0&&t.vy>0?t.deg=180+180*Math.atan(t.vy/t.vx)/Math.PI:t.deg=180*Math.atan(t.vy/t.vx)/Math.PI),t},this.load=()=>{a||(t.addEventListener("pointerdown",g),e.detectEnter&&t.addEventListener("pointerenter",g),a=!0)},this.unload=()=>{d>=0&&(t.releasePointerCapture(d),d=-1),p.length=0,a=!1,t.removeEventListener("pointerdown",g),t.removeEventListener("pointermove",u,!0),t.removeEventListener("pointerup",_,!0),t.removeEventListener("pointercancel",_,!0)}}}var S=function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}d((s=s.apply(t,e||[])).next())}))};let I="",M="",E="",C="",P=null;try{P=new AudioContext;try{P=new AudioContext;const t=e=>{const i=new Audio;cfg_debug&&console.log("b=>fixAudioContext",i),i.autoplay=!0,i.src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",i.play(),document.removeEventListener("touchstart",t),document.removeEventListener("touchend",t)};document.addEventListener("touchstart",t),document.addEventListener("touchend",t)}catch(t){}}catch(t){}function R(t){return S(this,void 0,void 0,(function*(){if(!P)return;if(!t)return;0!==t.indexOf(I)&&(t=I+t);const e=yield A(t);if(e&&e.buffer){yield P.resume();const t=P.createBufferSource();t.buffer=e.buffer,t.connect(P.destination),t.start()}}))}function A(t){return S(this,void 0,void 0,(function*(){if(!P)return null;if(!t)throw"url is empty";const e=function(){let t=window["k-effect-sound-map"];return t||(t=new Map,window["k-effect-sound-map"]=t),t}();0!==t.indexOf(I)&&(t=I+t);let i=e.get(t);if(AudioContext&&!i){i={buffer:null},e.set(t,i);const s=yield fetch(t),o=yield s.arrayBuffer();i.buffer=yield P.decodeAudioData(o)}return i}))}function L(){R(E)}var O=i(897),B=i(685),N=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};const U=i(577).Z;let j=class extends O.oi{constructor(){super(...arguments),this._view=!1,this._focusIdx=-1,this._scrollIdx=-1,this._scripts=[]}static get styles(){return U}render(){return O.dy`
			<style>
				:host {
					display: ${this._view?O.iv``:O.iv`none`};
				}
			</style>
			<div class="bg"></div>
			<div class="container">
				${this._scripts.map(((t,e)=>O.dy`
						${t.no_line_break||0===e?void 0:O.dy`<br/>`}
						${t.dms_speaker?O.dy`<span class="speaker">${t.dms_speaker}:</span>`:void 0}
						<span 
							class=${`script${this._focusIdx===e?" on":""} script${e}`} 
							.innerHTML=${t.dms_eng}
						></span>
					`))}
			</div>
			
		`}$unload(){this._container&&(this._container.style.scrollBehavior="auto",this._container.scrollTop=0,this._container.style.scrollBehavior="smooth"),this._view=!1,this._focusIdx=-1,this._scrollIdx=-1,this._scripts=[],this.requestUpdate()}$setScripts(t){this._focusIdx=-1,this._scrollIdx=-1,this._scripts=t,this._view=!0,this.requestUpdate(),this._container&&(this._container.style.scrollBehavior="auto",this._container.scrollTop=0,this._container.style.scrollBehavior="smooth")}$setFocusIdx(t,e){var i;if(this._focusIdx!==t||this._scrollIdx!==e){if(this._scrollIdx!==e){const t=this._container;let s=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector(".script"+e);t&&s&&(t.scrollTop=s.offsetTop-(t.offsetHeight-s.offsetHeight)/2)}this._focusIdx=t,this._scrollIdx=e,this.requestUpdate()}}};N([(0,B.IO)(".container")],j.prototype,"_container",void 0),j=N([(0,B.Mo)("v-s-script-box")],j);var z=function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}d((s=s.apply(t,e||[])).next())}))};function D(t){return new Promise(((e,i)=>{const s=document.createElement("script");s.type="text/javascript",s.src=t,(document.head[0]?document.head[0]:document.head).appendChild(s),s.onload=()=>e(),s.onerror=t=>i(t)}))}function F(t){return new Promise(((e,i)=>{const s=document.createElement("img");s.onload=()=>e(s),s.onerror=t=>i(t),s.src=t}))}class W{constructor(t,e,i,s){this.idx=-1,this._stampTimer=-1,this._initedMathAlive=!1,this._uploadMsg=null,this._frames={pen:null,teaching:null},this.info=t;const o=this.container=document.createElement("div");o.style.transitionProperty="bottom, transform",o.style.transitionDuration="0.3s",o.style.transformOrigin="bottom right",o.style.width="1280px",o.style.height="800px";const r=this.frame=document.createElement("iframe");r.frameBorder="0px",r.scrolling="no",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.allow="autoplay;camera;microphone";const a=t=>{var e;canConsole()&&console.info("base.student:app=>student(postMsgToFrame)",t.type,t),null===(e=r.contentWindow)||void 0===e||e.postMessage(t,"*")};let d="";const l=new w(!1),h=new $,c=(t,e,i)=>{a({type:"notifyRecordPlayerState",from:"launcher",msg:{bPlay:t,time:e,duration:i}})};h.on("state-changed",((t,e)=>{"video"===d&&l.zIndexTop&&c(h.bPlay,h.currentTime,h.duration)})),h.on("time-changed",(t=>{"video"===d&&l.zIndexTop&&c(h.bPlay,h.currentTime,h.duration)})),h.on("play-end",(()=>{"video"===d&&l.zIndexTop&&c(!1,h.currentTime,h.duration)}));const p=document.createElement("div"),m=document.createElement("video"),u=l.video;p.appendChild(u),p.appendChild(m),p.style.position="absolute",p.style.visibility="hidden",u.style.position="absolute",u.style.left="0",u.style.top="0",u.style.width="100%",u.style.height="100%",u.style.pointerEvents="none",m.style.position="absolute",m.style.left="0",m.style.top="0",m.style.width="100%",m.style.height="100%",m.style.pointerEvents="none",m.style.display="none",h.initMedia(m),o.appendChild(p),o.appendChild(r),l.on("recorded",(t=>{"video"===d&&l.zIndexTop&&(m.style.display="",h.load(t))})),l.on("change-state",(()=>{"ready"!==l.state&&(h.unconnect(),m.style.display="none"),"video"===d&&l.zIndexTop?p.style.zIndex="1":p.style.zIndex="-1"})),l.on("record-time",(t=>{c(!1,t,t)}));const _=o.appendChild(document.createElement("button"));_.className="student-send-btn",_.style.display="none",_.onclick=t=>{"none"!==_.style.display&&a({type:"clickSendButton",from:"launcher",msg:void 0})};const f=o.appendChild(document.createElement("v-s-script-box")),v=o.appendChild(document.createElement("div"));v.className="loading",v.style.position="absolute",v.style.left="0px",v.style.right="0px",v.style.top="0px",v.style.bottom="0px",v.style.display="none",v.style.zIndex="2",v.style.backgroundColor="rgba(0, 0, 0, 0.3)";let y=0,b=0,x=0,k=0,T=0,S=0;new V(p,{preventDefault:!0},(t=>"video"===d&&!!l.zIndexTop&&(T=o.offsetWidth,S=o.offsetHeight,y=p.offsetLeft,b=p.offsetTop,x=p.offsetWidth,k=p.offsetHeight,!0)),((t,e,i)=>{let s=y+t;s<0?s=0:s+x>T&&(s=T-x);let o=b+e;o<0?o=0:o+k>S&&(o=S-k),p.style.left=s+"px",p.style.top=o+"px"}));const I=o.appendChild(document.createElement("div"));I.style.position="absolute",I.style.left="0px",I.style.right="0px",I.style.top="0px",I.style.bottom="0px",I.style.display="none",I.style.zIndex="3",I.style.backgroundColor="rgba(0, 0, 0, 0)",I.onclick=()=>{this.idx<0||i(this)};const M=o.appendChild(document.createElement("img"));M.style.position="absolute",M.style.left="0px",M.style.right="0px",M.style.top="0px",M.style.bottom="0px",M.style.display="none",M.style.zIndex="2",M.src="./assets/good.svg",A("stamp.mp3"),this.focus=()=>(this.idx=-1,o.style.position="absolute",o.style.right="0",o.style.bottom="0",o.style.transform="scale(1)",I.style.display="none",this),this.blur=t=>(this.idx=t,o.style.position="absolute",o.style.right="0",o.style.bottom=800+200*(t-1)+"px",o.style.transform="scale(0.25)",I.style.display="",this);const E=t=>z(this,void 0,void 0,(function*(){const e=this._uploadMsg;if(!e)return;t.startsWith("data:")||(t="data:"+t);let i=e.msg.src;i.startsWith("data:")||(i="data:"+i);const s=()=>{a({type:"notifyUploadToServerResult",from:"launcher",msg:{result:"fail",url:""}})};let o,n=null;try{n=yield F(t)}catch(e){if(t.length>20)return void s();n=null}try{o=yield F(i)}catch(t){return void s()}try{let t;t=e.msg.rect?e.msg.rect:n?{left:0,top:0,width:n.naturalWidth,height:n.naturalHeight}:{left:0,top:0,width:o.naturalWidth,height:o.naturalHeight};const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const s=i.getContext("2d");if(s){s.fillStyle="#fff",s.fillRect(0,0,i.width,i.height),s.drawImage(o,0,0),n&&s.drawImage(n,-t.left,-t.top);const e={type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:i.toDataURL()}};a(e)}}catch(t){return void s()}}));this.handlePostMessage=t=>z(this,void 0,void 0,(function*(){return t.source===r.contentWindow&&(yield this._handlePostMessage(t.data))})),this._handlePostMessage=i=>z(this,void 0,void 0,(function*(){var o,r,c,m,u;if(!i||!i.type||!i.from)return!0;switch(canConsole()&&console.info("base.student:student=>app",i.type,i),i.type){case"getServerHost":a({type:"notifyServerHost",from:"launcher",msg:{host:""}});break;case"getAllStudentsProfile":a({type:"notifyAllStudentsProfile",from:"launcher",msg:s()});break;case"getLoginStudentsProfile":a({type:"notifyLoginStudentsProfile",from:"launcher",msg:s()});break;case"init":{v.style.display="none",_.style.display="none";const e={type:"notifyStartContent",from:"launcher",msg:{myInfo:Object.assign({},t),addOnHost:q,bookid:1,contentProgress:0,lesson:"Lesson",step:"Step",curriculumId:1}};a(e)}break;case"getMyProfile":{const e={type:"notifyMyProfile",from:"launcher",msg:Object.assign({},t)};a(e)}break;case"sendMsgToTeacher":(t=>{canConsole()&&console.info("base.student:app=>teacher(postMsgToTeacher)",t.type,t),e.postMessage(t,"*")})({type:"notifyReceiveMsg",from:"launcher",msg:i.msg});break;case"uploadStudentReport":{const e=i.msg,s={type:"notifyStudentReport",from:"launcher",fromId:"S"+t.id,msg:e};window.top.postMessage(s,"*")}break;case"startCamera":case"startCustomCamera":{let t,e="",s=!1,o=!1,n=!1,r=!1;if("startCustomCamera"===i.type)t=i.msg,s=!!t.rearCamera,o=!!t.zIndexTop,n=!!t.draggable,r=!!t.notifyRecordTime;else{const e=i;t={left:0,top:0,width:0,height:0},void 0===e.msg?s=!1:"boolean"==typeof e.msg?s=e.msg:"object"==typeof e.msg&&(s=!!e.msg.rearCamera,r=!!e.msg.notifyRecordTime)}l.setUI(t,o,n,r);const h=l.videoBnd;p.style.visibility="visible",p.style.left=h.left,p.style.top=h.top,p.style.width=h.width,p.style.height=h.height,d="video",l.initRecord("video",(t=>z(this,void 0,void 0,(function*(){if(void 0===t)return;!1===t&&alert("Camera is not working. Please check the system settings."),e=t?"success":"",yield g(50);const i={type:"notifyStartCamera",from:"launcher",msg:{result:e,videoId:l.video.id}};a(i)}))),s)}break;case"stopCamera":{const t=()=>{"saving"===l.state?setTimeout(t,300):(d="",p.style.visibility="hidden",l.clear(),a({type:"notifyStopCamera",from:"launcher",msg:{result:"success"}}))};t()}break;case"switchCamera":{const t=i;l.toggleCam(t.msg,(t=>{a({type:"notifySwitchCamera",from:"launcher",msg:{result:t?"success":"fail"}})}))}break;case"startVideoRecord":for(;"loading"===l.state||"starting"===l.state;)yield g(100);l.initRecord("video",(t=>z(this,void 0,void 0,(function*(){void 0!==t&&(t&&(t=yield l.record()),a(t?{type:"notifyStartVideoRecord",from:"launcher",msg:{result:"success"}}:{type:"notifyVideoRecordCanceled",from:"launcher",msg:{url:""}}))}))),void 0);break;case"stopVideoRecord":{let t=yield l.stopAndSave();t&&t.length<16&&(t=null),canConsole()&&console.log("base.student:[recorder]this.recorder.stopAndSave",t),a({type:"notifyVideoRecordResult",from:"launcher",msg:{result:t?"success":"fail",url:null!=t?t:""}})}break;case"takePicture":{const t=i.msg,e=t=>{let e="",i="";if(t&&""!==t){const s=t.split(",");s.length>1&&(s.shift(),i=s.join(","),e="success")}a({type:"notifyTakePicture",from:"launcher",msg:{result:e,url:t,src:i}})},s=t.rearCamera;l.initRecord("video",(i=>{void 0!==i&&(i?l.capture(t,1280,800,e):!1===i&&e(""))}),s)}break;case"startVoiceRecord":{const t=i;let e="";d="voice",p.style.visibility="hidden",l.setUI({left:0,top:0,width:0,height:0},!1,!1,!!t.msg),l.initRecord("voice",(t=>z(this,void 0,void 0,(function*(){void 0!==t&&(t&&(t=yield l.record()),e=t?"success":"",a({type:"notifyStartVoice",from:"launcher",msg:{result:e}}))}))),void 0)}break;case"stopVoiceRecord":{d="",p.style.visibility="hidden";let t=yield l.stopAndSave();t&&t.length<16&&(t=null),a({type:"notifyVoiceRecordResult",from:"launcher",msg:{result:t?"success":"fail",url:null!=t?t:""}}),l.clear()}break;case"playRecordPlayer":if("video"!==d)return!0;if(!l.zIndexTop)return!0;h.play();break;case"pauseRecordPlayer":h.pause();break;case"viewOrHideRecordPlayer":{const t=i.msg;p.style.visibility="hide"===t.command?"hidden":"visible"}break;case"uploadFileToServer":{const t={type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:i.msg.url}};a(t)}break;case"uploadImageToServer":{const t=i;if(t.msg.mixPen){this._uploadMsg=t;const e={type:"pen-capture",from:"launcher",msg:void 0};canConsole()&&console.log("pen-capture",e,this._frames.pen,null===(o=this._frames.teaching)||void 0===o?void 0:o.win.postMessage,null===(r=this._frames.teaching)||void 0===r?void 0:r.win.sendMessage),null===(c=this._frames.pen)||void 0===c||c.win.postMessage(e,"")}else{this._uploadMsg=null;const e={type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:t.msg.src}};a(e)}}break;case"notify-pen-capture":if(this._uploadMsg){const t=i;if(t.msg)E(t.msg);else{const t={type:"notifyUploadToServerResult",from:"launcher",msg:{result:"success",url:this._uploadMsg.msg.src}};a(t)}}break;case"uploadFileToServerMulti":{const t=i;console.log("smsg=>uploadFileToServerMulti",t);const e=[];t.msg.forEach((t=>{n.isString(t)?e.push({result:"success",url:t}):t&&n.isString(t.url)&&e.push({result:"success",url:t.url})})),a({type:"notifyUploadToServerMultiResult",from:"launcher",msg:e})}break;case"showLoading":{const t=i.msg;v.style.display=t?"":"none"}break;case"showSendButton":{const t=i.msg;n.isBoolean(t)?_.style.display=t?"":"none":(void 0!==t.view&&(_.style.display=t.view?"":"none"),_.style.bottom=(null!==(m=t.bottom)&&void 0!==m?m:0)+"px",_.style.right=(null!==(u=t.right)&&void 0!==u?u:0)+"px")}break;case"unloadScript":f.$unload();break;case"internalMsg":{const t=i;"teaching"===t.msg.to&&this._frames.teaching?this._frames.teaching.win.postMessage(t,"*"):"pen"===t.msg.to&&this._frames.pen?this._frames.pen.win.postMessage(t,"*"):console.warn("internalMsg",t,this._frames.pen,this._frames.teaching)}break;case"internalDisplay":this._internalDisplay(i);break;default:console.warn("stundent message ",i)}return!0})),this.handleWssMessage=t=>{if("notifyEtcMsg"===t.type){const e=t.msg;switch(e.etcType){case"sendScript":{const t=e;f.$setScripts(t.etcMsg)}break;case"changedFocusIdx":{const t=e;f.$setFocusIdx(t.etcMsg.focusIdx,t.etcMsg.scrollIdx)}break;case"endScript":f.$unload();break;case"stamp":this._stampTimer>0&&window.clearTimeout(this._stampTimer),R("stamp.mp3"),M.style.display="block",this._stampTimer=window.setTimeout((()=>{M.style.display="none"}),1e3)}}else console.log(t)}}initMathAlive(){return z(this,void 0,void 0,(function*(){if(this._initedMathAlive)return;this._initedMathAlive=!0;try{yield Promise.all([D("./mathalive/react.production.min.js"),D("./mathalive/mobx.umd.min.js"),D("./mathalive/lodash.min.js"),D("./mathalive/jquery.min.js")]),yield D("./mathalive/react-dom.production.min.js"),yield D("./mathalive/mobxreactlite.umd.production.min.js"),yield D("./mathalive/mobxreact.umd.production.min.js")}catch(t){console.error(t)}const t=this.container,e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href="./mathalive/student/style/app.css",document.body.appendChild(e);const i=document.createElement("div");i.classList.add("launcher-pen"),i.classList.add("d-none"),i.appendChild(document.createElement("div")).style.pointerEvents="none",t.appendChild(i);try{this._frames.pen={box:i,win:yield this.embedFrameJS("./mathalive/toolkit/pen/pen.0.js","pen",i)}}catch(t){console.error(t),this._frames.pen=null}const s=document.createElement("div");s.classList.add("launcher-teaching"),s.classList.add("d-none"),t.appendChild(s);const o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href="./mathalive/toolkit/teaching_s/teaching_s.0.css",document.body.appendChild(o);try{yield this.embedFrameJS("./mathalive/toolkit/teaching_s/teaching_s~modules.teaching_s.0.js","teaching",s)}catch(t){console.error(t)}try{this._frames.teaching={box:s,win:yield this.embedFrameJS("./mathalive/toolkit/teaching_s/main.teaching_s.0.js","teaching",s)}}catch(t){console.error(t)}}))}embedFrameJS(t,e,i){return new Promise(((s,o)=>{const n=document.createElement("script");n.type="text/javascript",n.src=t,document.body.appendChild(n),n.onload=()=>{canConsole()&&console.log("embedframe _refBox",t,"js loaded",window["launcher_"+e]);const n=window["launcher_"+e];n?(n.init(((t,e)=>{canConsole()&&console.log("embedframe frameObj.init message",t,n),this._handlePostMessage(t)}),i),s(n)):o(`window['launcher_${e}] => null`)},n.onerror=t=>o(t)}))}_internalDisplay(t){const e=t.msg;let i=null;switch(e.to){case"teaching":i=this._frames.teaching;break;case"pen":i=this._frames.pen;break;default:i=null}i&&(n.isUndefined(e.display)||("pen"===e.to?e.display?this.showPentool(!1):this.hidePentool():e.display?i.box.classList.remove("d-none"):i.box.classList.add("d-none")))}showPentool(t){const e={type:"notifySetPentool",from:"launcher",msg:{remote:t,view:!0}};this._frames.teaching&&this._frames.teaching.win.postMessage(e,"*")}hidePentool(){this._frames.teaching&&this._frames.teaching.win.postMessage({type:"notifySetPentool",from:"launcher",msg:{remote:!1,view:!1}},"*")}clear(){this._uploadMsg=null,this.hidePentool(),this._frames.teaching&&this._frames.teaching.box.classList.add("d-none")}}let q="";var H=i(845),Y=i(14),Z=i(224);function K(t){return new Promise((e=>{setTimeout((()=>e()),t)}))}!function*(){let t=0;for(;;){const e=Date.now();e>t?t=e:t+=1,yield t}}(),(()=>{const t=document.createElement("style");t.innerHTML=" ",document.getElementsByTagName("head")[0].appendChild(t),t.sheet})();const G=O.iv`:host slot{position:absolute;display:block;left:0;width:100%;top:0;height:100%;pointer-events:none;opacity:0;transform:scale(.2,.2);transition:transform .3s,opacity .3s}:host slot.open{pointer-events:unset;opacity:1;transform:scale(1,1);transition:transform .3s cubic-bezier(.405,.42,.135,1.2)}:host slot.closing{pointer-events:unset;opacity:0;transform:scale(.2,.2);transition:transform .3s,opacity .3s}:host slot.closed{display:none}`;var Q=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};let X=class extends O.oi{constructor(){super(...arguments),this._view=!1,this.$view=!1,this.$zindex=-1,this.$pointerEvents="all",this.$background="transparent",this._class="closed"}static get styles(){return[G]}render(){return O.dy`<slot 
				class="${this._class}" 
				style="z-index: ${this.$zindex}; pointer-events: ${this.$pointerEvents}; background-color: ${this.$background}"></slot>`}shouldUpdate(t){const e=super.shouldUpdate(t);return this._view!==this.$view&&(this.$view?(this._class="",setTimeout((()=>this._class="open"),10)):(this._class="closing",setTimeout((()=>this._class="closed"),300)),this._view=this.$view),e}};Q([(0,B.Cb)({type:Boolean})],X.prototype,"$view",void 0),Q([(0,B.Cb)({type:Number})],X.prototype,"$zindex",void 0),Q([(0,B.Cb)()],X.prototype,"$pointerEvents",void 0),Q([(0,B.Cb)()],X.prototype,"$background",void 0),Q([(0,B.SB)()],X.prototype,"_class",void 0),X=Q([(0,B.Mo)("v-cover-popup")],X);var J=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},tt=function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}d((s=s.apply(t,e||[])).next())}))};function et(t){t=Math.round(t/1e3);const e=Math.floor(t/60),i=t%60;let s,o;return s=e<10?"0"+e:""+e,o=i<10?"0"+i:""+i,s+":"+o}let it,st,ot;H.Z.use([Y.Z,Z.Z]);let nt="";function rt(t){return tt(this,void 0,void 0,(function*(){if(nt===t)return;nt=t;const e=yield Promise.all([fetch(`./report/${t}/report-detail.css`),fetch(`./report/${t}/report-detail-item.css`),fetch(`./report/${t}/report-progress.css`)]),i=yield Promise.all([e[0].text(),e[1].text(),e[2].text()]);it=O.dy`<style>${i[0]}</style>`,st=O.dy`<style>${i[1]}</style>`,ot=O.dy`<style>${i[2]}</style>`}))}let at=class extends O.oi{constructor(){super(),this.$ratio=0,this.$min=-1,this.$max=-1,this._mouseRatio=-1,this._pid=-1;let t=0,e=-1;const i=t=>{e=t,this.dispatchEvent(new CustomEvent("change",{detail:t}))},s=n.throttle((t=>{t>=0&&this._pid>=0&&i(t)}),500,{leading:!1,trailing:!0});this.addEventListener("pointerdown",(i=>{if(this._pid>=0)return;if(!i.isPrimary)return;if(1!==i.buttons)return;e=-1,t=this.offsetWidth;let o=i.offsetX/t;this.$min>=0&&o<this.$min?o=this.$min:this.$max>=0&&o>this.$max&&(o=this.$max),o<0?o=0:o>1&&(o=1),this._mouseRatio=o,this._pid=i.pointerId,this.setPointerCapture(this._pid),s(o)})),this.addEventListener("pointermove",(e=>{if(this._pid<0)return;if(!e.isPrimary)return;if(1!==e.buttons)return;let i=e.offsetX/t;this.$min>=0&&i<this.$min?i=this.$min:this.$max>=0&&i>this.$max&&(i=this.$max),i<0?i=0:i>1&&(i=1),this._mouseRatio=i,s(i)}));const o=o=>{if(this._pid<0)return;this.releasePointerCapture(this._pid),this._pid=-1;let n=o.offsetX/t;this.$min>=0&&n<this.$min?n=this.$min:this.$max>=0&&n>this.$max&&(n=this.$max),n<0?n=0:n>1&&(n=1),(n<e-.01||n>e+.01)&&(this._mouseRatio=n,s.cancel(),i(n))};this.addEventListener("pointerup",o),this.addEventListener("pointercancel",o)}render(){return O.dy`
			${ot}
			<div class="box"><div style=${`width: ${100*this.$ratio}%`}></div></div>
			<div class="btn" style=${`left:${100*(this._mouseRatio>=0?this._mouseRatio:this.$ratio)}%`}></div>
		`}shouldUpdate(t){return t.has("$ratio")&&this._pid<0&&(this._mouseRatio=-1),super.shouldUpdate(t)}};J([(0,B.Cb)({type:Number})],at.prototype,"$ratio",void 0),J([(0,B.Cb)({type:Number})],at.prototype,"$min",void 0),J([(0,B.Cb)({type:Number})],at.prototype,"$max",void 0),J([(0,B.SB)()],at.prototype,"_mouseRatio",void 0),at=J([(0,B.Mo)("v-r-video-progress")],at);const dt={cur:0,max:0,flip:null,updateFlip:null};let lt=class extends O.oi{constructor(){super(...arguments),this.$item={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future",this._imgs=[],this._scroll=!1,this._swiper=null,this._onIdx=t=>{dt.cur!==t&&(L(),dt.cur=t,dt.updateFlip&&dt.updateFlip(),this.requestUpdate())},this._imgLoad=t=>tt(this,void 0,void 0,(function*(){const t=this._img;if(t instanceof HTMLImageElement&&t.naturalWidth>0&&this._swiper&&this._swiper.el){yield K(100);const e="oxford"===nt,i=this._swiper.el,s=i.offsetWidth-(e?36:0),o=i.offsetHeight;t.style.verticalAlign="top";const n=Math.min(s,t.naturalWidth);let r=t.naturalHeight*n/t.naturalWidth;const a=r/o;a>=.9&&a<1.1&&(r=o),t.style.opacity="1",r<=o?(this._scroll=!1,i.classList.add("swiper-no-swiping"),t.style.top=e?(o-r)/2+"px":"0px"):(this._scroll=!0,t.style.top="0px",i.classList.remove("swiper-no-swiping")),t.setAttribute("width",n+"px"),t.setAttribute("height",r+"px")}this._delayUpdate(),yield K(300),this._delayUpdate()}))}render(){const t=dt.cur<=dt.max?this._imgs[dt.cur]:"";return O.dy`
			${st}
			<div class="swiper-container">
				<div class="swiper-wrapper">
					<div class="swiper-slide">
						<img class="image-view" .src=${t} .draggable=${!1} @load=${this._imgLoad}>
					</div>
				</div>
				<div class="swiper-scrollbar"></div>
			</div>
			<div class="navi ${this._imgs.length<2?"d-none":""}">
				${this._imgs.map(((t,e)=>O.dy`<button class="${e===dt.cur?"on":""}" @click=${()=>this._onIdx(e)}>${e+1}</button>`))}
			</div>
		`}shouldUpdate(t){const e=super.shouldUpdate(t),i=this.$item.content;let s;return s=i?n.isArray(i.value)?i.value:[i.value]:[],n.isEqual(s,this._imgs)?console.log("aaaaaaaaa=>",s):(this._imgs=[...s],dt.cur=0,dt.max=this._imgs.length-1,dt.updateFlip&&dt.updateFlip(),this._delayUpdate()),e}firstUpdated(t){var e;super.firstUpdated(t),dt.flip=this._onIdx,this._swiper&&this._swiper.destroy(!0),dt.cur=0,this._scroll=!1;const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".swiper-container"),s=i.querySelector(".swiper-scrollbar");this._swiper=new H.Z(i,{direction:"vertical",resizeObserver:!0,slidesPerView:"auto",freeMode:!0,scrollbar:{el:s,draggable:!0,snapOnRelease:!1},mousewheel:!0})}disconnectedCallback(){super.disconnectedCallback(),this._swiper&&(this._swiper.destroy(!0),this._swiper=null),dt.cur=0,dt.max=0,this._scroll=!1,this._imgs.length=0}_delayUpdate(){setTimeout((()=>{this._swiper&&(this._swiper.update(),this._swiper.updateSize(),this._swiper.scrollbar.updateSize())}),300)}};J([(0,B.IO)(".image-view")],lt.prototype,"_img",void 0),J([(0,B.Cb)({type:Object})],lt.prototype,"$item",void 0),J([(0,B.Cb)({type:String})],lt.prototype,"$subTheme",void 0),lt=J([(0,B.Mo)("v-r-detail-image")],lt);const ht=new $;let ct=class extends O.oi{constructor(){super(),this.$type=5,this.$item={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future",this._timeRatio=0,this._isFullscreen=!1,this.onChangeTime=t=>{const e=t.detail*ht.duration;ht.seek(e)},this.onChangeVolume=t=>{ht.setMuted(!1),ht.setVolume(t.detail)},this._togglePlay=()=>{ht.bPlay?ht.pause():ht.play()},this._toggleFull=()=>{this._isFullscreen=!this._isFullscreen,this.dispatchEvent(new CustomEvent("change-fullscreen",{detail:this._isFullscreen})),this.requestUpdate()},this._stop=()=>{ht.bPlay&&ht.pause(),ht.seek(0)},this._rewind=()=>{ht.seek(ht.currentTime-3e3)},this._fastFwd=()=>{ht.seek(ht.currentTime+3e3)},this._toggleMute=()=>{ht.setMuted(!ht.muted),this.requestUpdate()}}render(){const t=ht,e=ht.bPlay||6!==ht.myState;return O.dy`
			${st}
			<div class="item-detail ${this.$subTheme} ${4===this.$type?"audio":"video"} ${this._isFullscreen?"fullscreen":""}">
				<div>
					<video 
						preload="metadata"
						poster = "${4===this.$type?`./report/${nt}/images/bg_sound.png`:""}"
					></video>
					<div class="video_controls_wrap video_controls">
						<div class="controls control">
							<div class="progress">
								<v-r-video-progress class="time-prog" .$ratio=${this._timeRatio} @change=${this.onChangeTime}></v-r-video-progress>
								<!-- DragBar onChanged={this._changedTime} current={$player.viewTime} max={$player.duration} / -->
								<div class="timer"><em class="curtime">${et(t.currentTime)}</em> / <em class="fulltime">${et(t.duration)}</em></div>
								<button class=${"sound-btn"+(t.muted||0===t.volume?" mute":"")} @click=${this._toggleMute}></button>
								<v-r-video-progress class="volume-prog" .$ratio=${t.muted?0:t.volume} @change=${this.onChangeVolume}></v-r-video-progress>
							</div>

							<div class="controlbtn">
								<button class=${e?"pause":"play"} @click=${this._togglePlay}></button>
								<button class="stop" @click=${this._stop}></button>
								<button class="rew" @click=${this._rewind}></button>
								<button class="fastFwd" @click=${this._fastFwd}></button>
								<button class="screen ${this._isFullscreen?"full":""}" @click=${this._toggleFull}></button>
							</div>
						</div>
					</div>
				</div>
			</div>
		`}disconnectedCallback(){super.disconnectedCallback(),this._isFullscreen&&(this._isFullscreen=!1,this.dispatchEvent(new CustomEvent("change-fullscreen",{detail:this._isFullscreen}))),ht.removeAllListeners(),ht.unload()}firstUpdated(t){var e;super.firstUpdated(t),dt.flip=null,dt.cur=0,dt.max=0,this._video&&(ht.on("volume-changed",(t=>{this.requestUpdate()})),ht.on("state-changed",((t,e)=>{3===t&&(ht.setMuted(!1),this._timeRatio=ht.currentTime/ht.duration),this.requestUpdate()})),ht.on("time-changed",(()=>{this._timeRatio=ht.currentTime/ht.duration,this.requestUpdate()})),ht.initMedia(this._video),ht.load(null===(e=this.$item.content)||void 0===e?void 0:e.value))}};J([(0,B.IO)("video")],ct.prototype,"_video",void 0),J([(0,B.Cb)({type:Number})],ct.prototype,"$type",void 0),J([(0,B.Cb)({type:Object})],ct.prototype,"$item",void 0),J([(0,B.Cb)({type:String})],ct.prototype,"$subTheme",void 0),ct=J([(0,B.Mo)("v-r-detail-media")],ct);let pt=class extends O.oi{constructor(){super(...arguments),this.$item={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future"}render(){var t;const e=null===(t=this.$item.content)||void 0===t?void 0:t.value;let i;return i=Array.isArray(e)?e.join(","):"string"==typeof e?e:"",O.dy`
			${st}
			<div class="text-view">
				<div class="tarea-bg"></div>
				<textarea 
					autocapitalize="off" 
					autocomplete="off"  
					spellcheck="false" 
					inputmode="none"
					disabled
					
				>${i}</textarea>
			</div>

		`}};J([(0,B.Cb)({type:Object})],pt.prototype,"$item",void 0),J([(0,B.Cb)({type:String})],pt.prototype,"$subTheme",void 0),pt=J([(0,B.Mo)("v-r-detail-text")],pt);let mt=class extends O.oi{constructor(){super(...arguments),this.$view=!1,this.$type=0,this.$subTheme="future",this._view=!1,this._clickName=!1,this._clickThumb=!1,this._nameWidth=0,this._videoFullscreen=!1,this._item=null,this._items=[],this._toggleThumbClick=t=>{t.preventDefault(),t.stopImmediatePropagation(),this._clickThumb=!this._clickThumb,this._clickName=!1,this.requestUpdate()},this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&(this._nameWidth=e.offsetWidth),this._clickName=!this._clickName,this.requestUpdate()},this._onFullscreen=t=>{},this._canNaviNext=!1,this._canNaviPrev=!1,this._flipNext=()=>tt(this,void 0,void 0,(function*(){if(!this._item)return;if(!this.$view)return;const t=this._items.indexOf(this._item);yield this._flip(t+1)})),this._flipPrev=()=>tt(this,void 0,void 0,(function*(){if(!this._item)return;if(!this.$view)return;const t=this._items.indexOf(this._item);yield this._flip(t-1)})),this._flip=t=>tt(this,void 0,void 0,(function*(){const e=this._items[t];e&&(this._item=null,this._clickName=!1,this._clickThumb=!1,this.requestUpdate(),yield K(100),this._item=e,this.$setFlipButton())})),this.$setFlipButton=()=>{if(!this._item)return;if(!this.$view)return;const t=this._items.indexOf(this._item);this._canNaviPrev=t>0,this._canNaviNext=t<this._items.length-1,this.requestUpdate()},this._sendStamp=()=>{this._item&&(L(),this.dispatchEvent(new CustomEvent("send-stamp",{detail:this._item.id})))},this._close=()=>{L(),this.$close()},this.$close=()=>{this.$view?(this.$view=!1,setTimeout((()=>{this._clickName=!1,this._clickThumb=!1,this._item=null,this.requestUpdate()}),300)):(this._clickName=!1,this._clickThumb=!1)}}render(){let t,e,i,s,o=this.$type;if(this._item){const o=ut(this._item,this._clickThumb);t=o.thumbnail,e=o.showName,i=o.realName,s=this._item.gender}else e="",t="",i="",s="",o=0;return O.dy`
			${it}
			<v-cover-popup .$view=${this.$view} .$zindex=${60}>
				<div class="report-detail ${this.$subTheme}">

					${this.$view?(n=this._item,r=o,a=this.$subTheme,d=5===this.$type?this._onFullscreen:void 0,null===n?void 0:4===r||5===r?O.dy`<v-r-detail-media .$type=${r} .$item=${n} .$subTheme=${a} @change-fullscreen=${d} ></v-r-detail-media>`:3===r||7===r?O.dy`<v-r-detail-image .$item=${n} .$subTheme=${a}></v-r-detail-image>`:2===r?O.dy`<v-r-detail-text .$item=${n} .$subTheme=${a}></v-r-detail-text>`:void 0):void 0}
					<div class="stu_profile">
						<p @click=${this._toggleThumbClick}>${t?O.dy`<img src=${t} class=""  />`:O.dy`<span class="thumb-name ${s}"><b>${e}</b></span>`}
						</p>
						${this._clickName?O.dy`<marquee .scrollDelay=${10} class="user-name" style="max-width:${this._nameWidth}px" @click=${this._toggleClick}>${i}</marquee>`:O.dy`<span class="user-name" @click=${this._toggleClick}>${i}</span>`}
					</div>
					<div class="navi left">
						<button class="btn-next" .disabled=${!this._canNaviNext} draggable="false" @click=${this._flipNext}></button>
						<button class="btn-prev" .disabled=${!this._canNaviPrev} draggable="false" @click=${this._flipPrev}></button>
					</div>
					<div class="navi right">
						<button class="btn-next" .disabled=${!this._canNaviNext} draggable="false" @click=${this._flipNext}></button>
						<button class="btn-prev" .disabled=${!this._canNaviPrev} draggable="false" @click=${this._flipPrev}></button>
					</div>
					
					<button class="stamp ${this.$subTheme}" @click=${this._sendStamp}></button>
					<button class="goback ${this.$subTheme}" @click=${this._close}></button>
				</div>		
			</v-cover-popup>
		`;var n,r,a,d}firstUpdated(t){super.firstUpdated(t),dt.updateFlip=this.$setFlipButton}shouldUpdate(t){const e=super.shouldUpdate(t);return this.$view!==this._view&&(this._view=this.$view),e}$setItem(t,e){this._items=e,this._item=t}};function ut(t,e){const{nickName:i,name:s,profileThumbnail:o,thumbnail:n,displayMode:r,noImage:a}=t;let d,l,h,c=r;return e&&(c="2"===c?"1":"2"),"2"===c?(d=l=i,h=o||""):(d=l=s,h=a||!n?"":n),h||(l=l.substring(0,2).toUpperCase()),{realName:d,showName:l,thumbnail:h}}J([(0,B.Cb)({type:Boolean})],mt.prototype,"$view",void 0),J([(0,B.Cb)({type:Number})],mt.prototype,"$type",void 0),J([(0,B.Cb)({type:String})],mt.prototype,"$subTheme",void 0),mt=J([(0,B.Mo)("v-report-detail")],mt);var _t=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},gt=function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{d(s.next(t))}catch(t){n(t)}}function a(t){try{d(s.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}d((s=s.apply(t,e||[])).next())}))};H.Z.use([Y.Z,Z.Z]);let ft,vt,yt="";const bt=1e6;class xt extends O.oi{constructor(){super(),this.$info={id:0,name:"",nickName:"",thumbnail:"",defaultThumbnail:"",profileThumbnail:"",displayMode:"1",gender:"M"},this.$subTheme="future",this.$opened=!1,this._opened=!1,this._duration="00:00",this._viewPlayBtn=!1,this._progress=0,this._clickName=!1,this._nameWidth=0,this._onMeta=t=>{const e=t.target;e.duration>bt&&(e.currentTime=bt)},this._onDuration=t=>{const e=t.target,i=Math.round(e.duration);i<bt?(this._duration=function(t){const e=Math.floor(t/60),i=t%60;let s,o;return s=e<10?"0"+e:""+e,o=i<10?"0"+i:""+i,s+":"+o}(i),this._viewPlayBtn=!0,e.currentTime=0,this._progress=0):this._viewPlayBtn=!1,this.requestUpdate()},this._onTime=t=>{const e=t.target;let i=100*e.currentTime/e.duration;isNaN(i)||i<0?i=0:i>100&&(i=100),this._progress=i,this.requestUpdate()},console.log("ReportItemBase")}shouldUpdate(t){const e=super.shouldUpdate(t);return this.$opened!==this._opened&&(this._clickName=!1,this._nameWidth=0,this._opened=this.$opened),e}}_t([(0,B.Cb)({type:Object})],xt.prototype,"$info",void 0),_t([(0,B.Cb)({type:String})],xt.prototype,"$subTheme",void 0),_t([(0,B.Cb)({type:Boolean})],xt.prototype,"$opened",void 0);let kt=class extends xt{constructor(){super(...arguments),this.$subType=void 0,this._inited=!1,this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&(this._nameWidth=e.offsetWidth),this._clickName=!this._clickName,this.requestUpdate()},this._onLoad=t=>{this._calc()},this._calc=()=>{if(this._inited)return;if(!this.$opened||!this._img)return;const t=this._img,e=t.parentElement;if(!e)return;this._inited=!0;const i=e.offsetWidth,s=e.offsetHeight,o=Math.min(i,t.naturalWidth),n=t.naturalHeight*o/t.naturalWidth;e.style.alignItems=n>s?"start":"center",t.style.opacity="1"}}render(){var t;const{content:e,gender:i}=this.$info;let s,o;e?(s="",o=n.isArray(e.value)?e.value[0]:e.value):(s="dis",o="");const r=ut(this.$info),{thumbnail:a,showName:d,realName:l}=r;return O.dy`
			${vt}
			<div class="top ${s}">
					<div class="thumb thumb-image ${null!==(t=this.$subType)&&void 0!==t?t:""}"><img .src=${o} @load=${this._onLoad}></div>
			</div>
			<div class="bottom ${s}">
				${a?O.dy`<img src="${a}" class="user-img ${this.$subTheme}" >`:O.dy`<span class="thumb-name ${this.$subTheme} ${i}">${d}</span>`}
				${this._clickName?O.dy`<marquee .scrollDelay=${10} class="user-name" style="max-width:${this._nameWidth}px" @click=${this._toggleClick}>${l}</marquee>`:O.dy`<span class="user-name" @click=${this._toggleClick}>${l}</span>`}
			</div>
		`}updated(t){super.updated(t),this._calc()}disconnectedCallback(){super.disconnectedCallback(),this._inited=!1}};_t([(0,B.IO)(".top .thumb img")],kt.prototype,"_img",void 0),_t([(0,B.Cb)()],kt.prototype,"$subType",void 0),kt=_t([(0,B.Mo)("v-r-item-image")],kt);let wt=class extends xt{constructor(){super(...arguments),this.$type=5,this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&(this._nameWidth=e.offsetWidth),this._clickName=!this._clickName,this.requestUpdate()}}render(){const{content:t,gender:e}=this.$info;let i,s;t?(i="",s=t.value):(i="dis",s="");const o=ut(this.$info),{thumbnail:n,showName:r,realName:a}=o;return O.dy`
			${vt}
			<div class="top ${i}">
					<video
						class="thumb ${5===this.$type?"video":"audio"}"
						preload="auto"	
						.autoplay=${!1}
						@loadedmetadata=${this._onMeta}
						@durationchange=${this._onDuration}
						@timeupdate=${this._onTime}
						src="${s}"
					></video>
					<button type="button" class="play-btn ${this._viewPlayBtn?"":" d-none"}"></button>
					<div class="time">${this._duration}</div>
			</div>
			<div class="bottom ${i}">
				${n?O.dy`<img src="${n}" class="user-img ${this.$subTheme}">`:O.dy`<span class="thumb-name ${this.$subTheme} ${e}">${r}</span>`}
				${this._clickName?O.dy`<marquee .scrollDelay=${10} class="user-name" style="max-width:${this._nameWidth}px" @click=${this._toggleClick}>${a}</marquee>`:O.dy`<span class="user-name" @click=${this._toggleClick}>${a}</span>`}
			</div>
		`}};_t([(0,B.Cb)({type:Number})],wt.prototype,"$type",void 0),_t([(0,B.IO)("video")],wt.prototype,"_media",void 0),wt=_t([(0,B.Mo)("v-r-item-media")],wt);let $t=class extends xt{constructor(){super(...arguments),this.$type=6,this._toggleClick=t=>{t.preventDefault(),t.stopImmediatePropagation();const e=t.target;e&&!this._clickName&&(this._nameWidth=e.offsetWidth),this._clickName=!this._clickName,this.requestUpdate()}}render(){const{content:t,gender:e}=this.$info;let i;i=t?"type6":"type6 dis",2===this.$type&&(i+=" type-text");const s=ut(this.$info),{thumbnail:o,showName:n,realName:r}=s;return O.dy`
			${vt}
			<div class="bottom ${i}">
				${o?O.dy`<img src="${o}" class="user-img ${this.$subTheme}">`:O.dy`<span class="thumb-name ${this.$subTheme} ${e}">${n}</span>`}

				${2===this.$type?O.dy`<span class="ico-text"></span>`:void 0}
				${this._clickName?O.dy`<marquee .scrollDelay=${10} class="user-name" style="max-width:${this._nameWidth}px" @click=${this._toggleClick}>${r}</marquee>`:O.dy`<span class="user-name" @click=${this._toggleClick}>${r}</span>`}
				
			</div>
		`}};_t([(0,B.Cb)({type:Number})],$t.prototype,"$type",void 0),$t=_t([(0,B.Mo)("v-r-item-type6")],$t);let Tt=class extends O.oi{constructor(){super(...arguments),this._viewList=!1,this._viewMenu=!1,this._viewListOpened=!1,this._total=[],this._returns=[],this._type=0,this._viewType="C",this._subTheme="future",this._swiper=null,this._onSendStamp=t=>{this.dispatchEvent(new CustomEvent("send-stamp",{detail:t.detail}))},this._itemClick=t=>{this._detail&&t.content&&(L(),this._detail.$setItem(t,this._returns),this._detail.$type=this._type,this._detail.$view=!0,this._detail.$setFlipButton())},this._close=()=>{L(),this.$close()}}get $viewList(){return this._viewList}get $viewMenu(){return this._viewMenu}get $type(){return this._type}get $viewType(){return this._viewType}render(){const t=this._total,e=this._returns;let i;return i=4===this._type?"sound_list":5===this._type?"mov_list":3===this._type?"image_list":2===this._type?"stu_list text_list":"stu_list",O.dy`
			${ft}
			<v-cover-popup .$view=${this._viewList} .$zindex=${60}>
				<div class="report-wrap">
					<div class="report-list ${this._subTheme}">
						<div class="user-num"><span class="submitted">${e.length}</span> <span class="slash">/</span> <span class="total">${t.length}</span></div>

						<div class="swiper-container submit-wrap ${i} ${this._subTheme}">
							<div class="swiper-wrapper" >
								<ul class="swiper-slide submit-list ">
									${e.map((t=>function(t,e,i,s,o,n){return 4===e||5===e?O.dy`<li><v-r-item-media .$type=${e} .$info=${t} .$subTheme=${s} @click=${()=>n(t)} .$opened=${o}></v-r-item-media></li>`:6===e?O.dy`<li><v-r-item-type6 .$type=${e} .$info=${t} .$subTheme=${s} .$opened=${o}></v-r-item-type6></li>`:2===e?O.dy`<li><v-r-item-type6 .$type=${e} .$info=${t} .$subTheme=${s} @click=${()=>n(t)} .$opened=${o}></v-r-item-type6></li>`:O.dy`<li><v-r-item-image .$subType=${i} .$info=${t} .$subTheme=${s} @click=${()=>n(t)} .$opened=${o}></v-r-item-image></li>`}(t,this._type,this._subType,this._subTheme,this._viewListOpened,this._itemClick)))}
									${void 0}
								</ul>
							</div>
							<div class="swiper-scrollbar swiper-no-swiping"></div>
						</div>
						<button class="goback ${this._subTheme}" @click=${this._close}></button>
					</div>
				</div>
				<v-report-detail @send-stamp=${this._onSendStamp} .$subTheme=${this._subTheme}></v-report-detail>
			</v-cover-popup>
		`}$getInfo(){return{total:this._total.length,current:this._returns.length}}$start(t,e,i,s,o){return gt(this,void 0,void 0,(function*(){let e,n;this._type=t,this._subType=s,this._returns.length=0,this._total.length=0,"object"==typeof o?(e=o.theme,n=o.subTheme):(e=o,n="future"),this._subTheme="discover"===n?n:"future",i.forEach(((t,e)=>{this._total[e]=Object.assign(Object.assign({},t),{content:void 0})})),yield function(t){return gt(this,void 0,void 0,(function*(){if(yt===t)return;yt=t;const e=yield Promise.all([fetch(`./report/${t}/report-popup.css`),fetch(`./report/${t}/report-popup-item.css`),rt(t)]),i=yield Promise.all([e[0].text(),e[1].text()]);ft=O.dy`<style>${i[0]}</style>`,vt=O.dy`<style>${i[1]}</style>`}))}(null!=e?e:"oxford"),this.requestUpdate()}))}$add(t){var e,i;let s=this._returns.find((e=>e.id===t.id));s||(s=this._total.find((e=>e.id===t.id)),s&&(s.content=n.cloneDeep(t.content),this._returns.push(s),this._swiper&&(this._swiper.update(),this._swiper.updateSize(),null===(e=this._swiper.scrollbar)||void 0===e||e.updateSize()),null===(i=this._detail)||void 0===i||i.$setFlipButton(),this.requestUpdate()))}$getReturns(){return n.cloneDeep(this._returns)}$setViewMenu(t){}$setViewList(t){this._viewList!==t&&(this._viewList=t,t?setTimeout((()=>{var t;this._swiper&&(this._swiper.destroy(),this._swiper=null);const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".swiper-container"),i=e.querySelector(".swiper-scrollbar");this._swiper=new H.Z(e,{direction:"vertical",resizeObserver:!0,slidesPerView:"auto",freeMode:!0,scrollbar:{el:i,draggable:!0,snapOnRelease:!1},mousewheel:!0}),this._viewListOpened=!0,this.requestUpdate()}),500):(this._viewListOpened=!1,this._swiper&&(this._swiper.destroy(),this._swiper=null)))}$close(){this._detail&&this._detail.$close(),this.$setViewList(!1),this._viewMenu=!1}};_t([(0,B.IO)("v-report-detail")],Tt.prototype,"_detail",void 0),_t([(0,B.SB)()],Tt.prototype,"_viewList",void 0),_t([(0,B.SB)()],Tt.prototype,"_viewMenu",void 0),Tt=_t([(0,B.Mo)("v-t-report-popup")],Tt);var Vt=function(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};const St=i(835).Z,It=i(421).Z,Mt=i(907).Z,Et=i(714).Z,Ct=i(311).Z;function Pt(t,e){t<0&&(t=0);let i="";e&&(i=Math.floor(t/3600)+":");const s=Math.floor(t%3600/60),o=t%60;return i=i+(s<10?"0":"")+s+":",i=i+(o<10?"0":"")+o,i}let Rt=null,At=class extends O.oi{constructor(){super(),this._type="",Rt=this}static get styles(){return St}render(){return O.dy`
			<v-video-ui></v-video-ui>
			<v-audio-ui></v-audio-ui>
			<slot></slot>
		`}firstUpdated(t){super.firstUpdated(t)}load(t,e,i,s){return o=this,n=void 0,a=function*(){this._callback&&this._callback!==s&&this._callback(this.getScripts()),this._unload(),this._callback=s,this.style.display="","mp4"===e||"mp3"===e?this._type=e:t.endsWith(".mp4")?this._type="mp4":t.endsWith(".mp3")?this._type="mp3":this._type="","mp3"===this._type&&this._audioUI?(this.style.display="unset",this._audioUI.load(t,i,this)):"mp4"===this._type&&this._videoUI?(this.style.display="unset",this._videoUI.load(t,i,this)):(this.style.display="none",this._callback=void 0),this.requestUpdate()},new((r=void 0)||(r=Promise))((function(t,e){function i(t){try{d(a.next(t))}catch(t){e(t)}}function s(t){try{d(a.throw(t))}catch(t){e(t)}}function d(e){var o;e.done?t(e.value):(o=e.value,o instanceof r?o:new r((function(t){t(o)}))).then(i,s)}d((a=a.apply(o,n||[])).next())}));var o,n,r,a}_unload(){this._callback=void 0,this._audioUI&&this._audioUI.unload(),this._videoUI&&this._videoUI.unload(),this.style.display="none"}setEditor(t){this.appendChild(t)}setScripts(t){"mp3"===this._type&&this._audioUI?this._audioUI.setScripts(t):"mp4"===this._type&&this._videoUI&&this._videoUI.setScripts(t)}getScripts(){return"mp3"===this._type&&this._audioUI?this._audioUI.getScripts():"mp4"===this._type&&this._videoUI?this._videoUI.getScripts():[]}close(t,e){e?this._unload():(this._callback&&(t||(t=this.getScripts()),this._callback(t),this._callback=void 0),"none"!==this.style.display&&(this._unload(),this.dispatchEvent(new CustomEvent("close-player"))))}changedFocusIdx(t,e){this.dispatchEvent(new CustomEvent("changed-focus-idx",{detail:{focusIdx:t,scrollIdx:e}}))}sendScripts(t){this.dispatchEvent(new CustomEvent("send-scripts",{detail:t}))}};Vt([(0,B.IO)("v-video-ui")],At.prototype,"_videoUI",void 0),Vt([(0,B.IO)("v-audio-ui")],At.prototype,"_audioUI",void 0),At=Vt([(0,B.Mo)("v-player-manager")],At);class Lt extends O.oi{constructor(){super(),this.isFullscreen=!1,this._player=new $,this._scripts=[],this._numOfScript=0,this._manager=null,this._scrollIdx=0,this._focusIdx=-1,this._focusIdx_seek=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._mode="",this._viewScriptBtn=!1,this._sendedScript=!1,this._bPlay=!1,this._muted=!1,this._state=0,this._timeRatio=0,this._volumeRatio=0,this._repeatStart=-1,this._repeatEnd=-1,this._playTime="",this._remainTime="",this._isHour=!1,this.onChangeTime=t=>{let e=t.detail*this._player.duration;this._repeatStart>=0&&e<this._repeatStart?e=this._repeatStart:this._repeatEnd>=0&&e>this._repeatEnd&&(e=this._repeatEnd),this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._player.seek(e,!this.isRepeatMode)},this.onChangeVolume=t=>{this._volumeRatio=t.detail,this._muted=!1,this._player.setMuted(!1),this._player.setVolume(t.detail)};const t=n.throttle(((t,e,i)=>{this._playTime=Pt(Math.round(t/1e3),i),this._remainTime=Pt(Math.round((e-t)/1e3),i)}),100);this._player.on("state-changed",((e,i)=>{this._bPlay=this._player.bPlay,this._state=e,3===e&&(this._isHour=this._player.duration>=36e5,this._volumeRatio=this._player.volume,this._muted=!1,this._player.setMuted(!1),this._timeRatio=this._player.currentTime/this._player.duration,t(this._player.currentTime,this._player.duration,this._isHour),setTimeout((()=>this._initPos()),100))}));let e=-1;this._player.on("time-changed",(i=>{var s;const o=this._scripts;if(this._numOfScript>0){let t=-1,n=-1;if(this._focusIdx_click>=0&&i>this._focusIdx_click_end&&(this._focusIdx_click=-1),this._focusIdx_maintain>=0&&i>this._focusIdx_click_end+100&&(this._focusIdx_maintain=-1),this._focusIdx_click_end>=0&&this._focusIdx_click<0&&this._focusIdx_maintain<0&&(this._focusIdx_click_end=-1),this._focusIdx_seek>=0)t=this._focusIdx_seek,this._focusIdx_seek=-1;else if(this._focusIdx_click>=0)t=this._focusIdx_click;else if(this._focusIdx_maintain>=0)t=this._focusIdx_maintain;else{if(e>=0){const s=o[e];if(s)if(i>=s.dms_start)for(let s=e;s<this._numOfScript;s++){const e=o[s];if(i<e.dms_start){n=s;break}if(i>=e.dms_start&&i<=e.dms_end){t=s;break}}else for(let s=e;s>=0;s--){const e=o[s];if(i>e.dms_end){n=s;break}if(i>=e.dms_start&&i<=e.dms_end){t=s;break}}}if(t<0)for(let e=0;e<this._numOfScript;e++){const s=o[e];if(i<s.dms_start){n=e;break}if(i>=s.dms_start&&i<=s.dms_end){t=e;break}}t>=0&&(e=t)}t>=0?n=t:n<0&&(n=i<=o[0].dms_start?0:this._numOfScript-1),this._scrollIdx===n&&this._focusIdx===t||this._sendedScript&&(null===(s=this._manager)||void 0===s||s.changedFocusIdx(t,n)),this._scrollIdx=n,this._focusIdx=t}this._timeRatio=i/this._player.duration,t(i,this._player.duration,this._isHour)})),this._player.on("volume-changed",(t=>{this._volumeRatio=t})),this._player.on("play-end",(()=>{var t;this._focusIdx_seek=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,e=-1,(this._scrollIdx>=0||this._focusIdx>=0)&&(this._scrollIdx=-1,this._focusIdx=-1,this._sendedScript&&(null===(t=this._manager)||void 0===t||t.changedFocusIdx(-1,-1)))})),this._player.on("play-end-temp",(()=>{setTimeout((()=>{var t;this._focusIdx_seek=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,(this._scrollIdx>=0||this._focusIdx>=0)&&(this._scrollIdx=-1,this._focusIdx=-1,this._sendedScript&&(null===(t=this._manager)||void 0===t||t.changedFocusIdx(-1,-1)))}),10)}))}get isRepeatMode(){return this._repeatStart>=0&&this._repeatEnd>this._repeatStart}_initPos(){const t=this._boxEl,e=this._middleEl,i=this._mediaEl;if(!(t&&e&&i))return!1;if(this._player.myState<3)return!1;let s;return s=i instanceof HTMLVideoElement?e.offsetWidth*i.videoHeight/i.videoWidth:e.offsetHeight,t.style.position="absolute",t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px",t.style.width=t.offsetWidth+"px",e.style.height=s+"px",!0}_clearPos(){this._focusIdx=-1,this._scrollIdx=-1,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._focusIdx_seek=-1,this._mode="",this._viewScriptBtn=!1,this._sendedScript=!1,this.isFullscreen=!1,this._bPlay=!1,this._muted=!1,this._state=0,this._timeRatio=0,this._volumeRatio=0,this._repeatStart=-1,this._repeatEnd=-1,this._playTime="",this._remainTime="",this._isHour=!1,this._boxEl&&(this._boxEl.style.position="relative",this._boxEl.style.left="",this._boxEl.style.top="",this._boxEl.style.width="",this._boxEl.style.height="",this._middleEl.style.height="")}_checkBoxPosition(){if(!this._boxEl)return;if("absolute"!==this._boxEl.style.position)return;const t=this._boxEl,e=t.style,i=this.offsetWidth,s=this.offsetHeight,o=t.offsetLeft,n=t.offsetTop,r=t.offsetLeft+t.offsetWidth,a=t.offsetTop+t.offsetHeight;let d=parseFloat(e.left);isNaN(d)&&(d=0);let l=parseFloat(e.top);isNaN(l)&&(l=0),o<0?d=d+0-o:r>i&&(d=d+i-r),n<0?l=l+0-n:a>s&&(l=l+s-a),e.left=d+"px",e.top=l+"px"}firstUpdated(t){super.firstUpdated(t);let e=0,i=0,s=0,o=0,n=0,r=0,a=0,d=0,l=0,h=0,c=0,p=0;const m=()=>{const t=this._boxEl,m=this._middleEl;return!(this.isFullscreen||this._player.myState<3||(c=this.offsetWidth,p=this.offsetHeight,l=n=t.offsetWidth,r=t.offsetHeight,h=a=m.offsetHeight,d=r-a,s=e=t.offsetLeft,o=i=t.offsetTop,t.style.position="absolute",t.style.left=e+"px",t.style.top=i+"px",t.style.width=n+"px",m.style.height=a+"px",0))};new V(this._boxEl,{preventDefault:!1},(t=>{const e=t.target;if(!(e instanceof HTMLElement))return!1;if(this.isFullscreen)return!1;let i=e,s=!0;for(;i&&i!==this._boxEl;){if(i.classList.contains("not-drag")){s=!1;break}i=i.parentElement}return s&&(s=m()),s}),((t,a,d)=>{e=s+t,e<0?e=0:e+n>c&&(e=c-n),i=o+a,i<0?i=0:i+r>p&&(i=p-r),this._boxEl.style.left=e+"px",this._boxEl.style.top=i+"px"}),(t=>{this._checkBoxPosition()})),new V(this._sizeDragTgt,{preventDefault:!0},(t=>!this.isFullscreen&&m()),((t,e,i)=>{n=l+t,s+n>c&&(n=c-s),a=h+e,o+a+d>p&&(a=p-(o+d)),this._boxEl.style.width=n+"px",this._middleEl.style.height=a+"px"}),(t=>{this._checkBoxPosition()}))}load(t,e,i){this._manager=i,this._clearPos(),this.setScripts(e),this.style.display="",this._player.initMedia(this._mediaEl),this._player.load(t)}unload(){this._clearPos(),this._scripts.length=0,this._numOfScript=0,this.style.display="none",this._player.unload()}_togglePlay(){this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._player.bPlay?this._player.pause(!this.isRepeatMode):this._player.play(!this.isRepeatMode)}_clickStop(){this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._repeatStart=-1,this._repeatEnd=-1,this._player.pause(),this._player.seek(0)}_toggleMode(t){return n.isString(t)||(""===this._mode?t="hor":"hor"===this._mode?t="ver":"ver"===this._mode&&(t="")),null!=t?t:""}_toggleScriptBtn(t){if(0!==this._scripts.length){if(this._viewScriptBtn)return this._toggleMode(""),void(this._viewScriptBtn=!1);n.isBoolean(t)||(t=!this._viewScriptBtn),this._viewScriptBtn=t}}getScripts(){return n.cloneDeep(this._scripts)}setScripts(t){this._scripts=t,this._numOfScript=t.length,this._focusIdx=-1,this._scrollIdx=0,this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1,this._focusIdx_seek=-1,this.requestUpdate()}_sendScript(){var t;0!==this._scripts.length&&(this._sendedScript=!0,null===(t=this._manager)||void 0===t||t.sendScripts(n.cloneDeep(this._scripts)),R(M))}_clickScript(t,e){this._repeatStart=-1,this._repeatEnd=-1;const i=this._scripts[t],s=this._scripts[t+1];e?this._player.gotoAndPlay(i.dms_start,i.dms_end,1):this._player.seek(i.dms_start),this._focusIdx_click=t,this._focusIdx_maintain=e?t:-1,this._focusIdx_click_end=s?s.dms_start:i.dms_end}_gotoPrevScript(){let t=-1;this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1;let e=this._player.currentTime;if(this._focusIdx_seek>=0)t=this._focusIdx_seek-1;else if(this._focusIdx>=0)t=this._focusIdx-1;else{const i=this._scripts;for(let s=this._numOfScript-1;s>=0;s--)if(e>i[s].dms_start){t=s;break}}let i=!1;t>=0&&t<this._numOfScript&&(this._repeatStart<0||this._scripts[t].dms_start>this._repeatStart)&&(i=!0,this._focusIdx_seek=t,this._player.seek(this._scripts[t].dms_start,!this.isRepeatMode)),i||(e-=3e3,this._repeatStart>=0&&e<this._repeatStart&&(e=this._repeatStart),e<0&&(e=0),this._player.seek(e),this._focusIdx_seek=-1)}_gotoNextScript(){let t=-1;this._focusIdx_click=-1,this._focusIdx_maintain=-1,this._focusIdx_click_end=-1;let e=this._player.currentTime;if(this._focusIdx_seek>=0)t=this._focusIdx_seek+1;else if(this._focusIdx>=0)t=this._focusIdx+1;else{const i=this._scripts;for(let s=0;s<this._numOfScript;s++)if(e<i[s].dms_start){t=s;break}}let i=!1;t>=0&&t<this._numOfScript&&(this._repeatEnd<0||this._scripts[t].dms_start<this._repeatEnd)&&(i=!0,this._focusIdx_seek=t,this._player.seek(this._scripts[t].dms_start,!this.isRepeatMode)),i||(e+=3e3,this._repeatEnd>=0&&e>this._repeatEnd&&(e=this._repeatEnd),e>this._player.duration&&(e=this._player.duration),this._player.seek(e),this._focusIdx_seek=-1)}_close(){var t;L(),null===(t=this._manager)||void 0===t||t.close(this._scripts)}_toggleMuted(t){n.isBoolean(t)||(t=!this._muted),this._muted=t,this._player.setMuted(t)}}Vt([(0,B.IO)(".player-box")],Lt.prototype,"_boxEl",void 0),Vt([(0,B.IO)(".player-box>.top")],Lt.prototype,"_topEl",void 0),Vt([(0,B.IO)(".player-box>.middle")],Lt.prototype,"_middleEl",void 0),Vt([(0,B.IO)(".player-box>.bottom")],Lt.prototype,"_bottomEl",void 0),Vt([(0,B.IO)(".size-drag-tgt")],Lt.prototype,"_sizeDragTgt",void 0),Vt([(0,B.SB)()],Lt.prototype,"_scrollIdx",void 0),Vt([(0,B.SB)()],Lt.prototype,"_focusIdx",void 0),Vt([(0,B.SB)()],Lt.prototype,"_mode",void 0),Vt([(0,B.SB)()],Lt.prototype,"_viewScriptBtn",void 0),Vt([(0,B.SB)()],Lt.prototype,"_sendedScript",void 0),Vt([(0,B.SB)()],Lt.prototype,"_bPlay",void 0),Vt([(0,B.SB)()],Lt.prototype,"_muted",void 0),Vt([(0,B.SB)()],Lt.prototype,"_state",void 0),Vt([(0,B.SB)()],Lt.prototype,"_timeRatio",void 0),Vt([(0,B.SB)()],Lt.prototype,"_volumeRatio",void 0),Vt([(0,B.SB)()],Lt.prototype,"_repeatStart",void 0),Vt([(0,B.SB)()],Lt.prototype,"_repeatEnd",void 0);const Ot=[18,23,27,32,36];let Bt=class extends Lt{constructor(){super(...arguments),this._fontSize=27,this._questions=[]}static get styles(){return It}render(){const t=this._player.duration,e=""!==this._mode,i=(this._repeatStart>=0&&t)>0?O.dy`<div class="repeat-marker" style="left: ${100*this._repeatStart/t}%;"></div>`:void 0,s=(this._repeatEnd>=0&&t)>0?O.dy`<div class="repeat-marker" style="left: ${100*this._repeatEnd/t}%;"></div>`:void 0;return O.dy`
			<!-- script: 스크립트 띄움 -->
			<div class="${`player-box ${this._mode} ${this.isFullscreen?"fullscreen":""}`}">
				<div class="top">
				
					<button class=${"minimize-button not-drag"+(e?"":" hide")} @click=${this._toggleMode}></button>
					<button class="close-button not-drag" @click=${()=>this._close()}></button>
				</div>
				<div class="middle">
					<audio></audio>
					<v-media-script class="script-box not-drag"
						.view=${e}
						.scripts=${this._scripts}
						.scrollIdx=${e?this._scrollIdx:-1}
						.focusIdx=${e?this._focusIdx:-1}
						.fontSize=${this._fontSize}
						@clickScript=${t=>this._clickScript(t.detail,!0)}
					></v-media-script>

				</div>
				<div class="bottom not-drag">
					<div class="top-controls">
						<span class="time-current">${this._playTime}</span>
						<div class="progress-bnd">
							<v-media-progress 
								class="progress-bar" 
								.type=${"audio"} 
								.ratio=${this._timeRatio}
								.min=${this._repeatStart/t}
								.max=${this._repeatEnd/t}
								@change=${this.onChangeTime}
							></v-media-progress>
							${this._repeatStart<0&&t>0?this._questions.map(((e,i)=>O.dy`<div class="num-marker" @click=${()=>this._clickScript(e.idx,!1)} style="left: ${100*e.start/t}%;">${i+1}</div>`)):void 0}
							${i}
							${s}
						</div>
						<span class="time-remaining">${this._remainTime}</span>
						<button class=${"sound-button "+(this._muted?"mute":"")} @click=${this._toggleMuted}></button>
						<v-media-progress class="volume-bar" .ratio=${this._volumeRatio} @change=${this.onChangeVolume}></v-media-progress>
					</div>
					<div class="btm-controls">
						<div class="left">
							<div class="play-pause">
									<button class=${"play-button"+(this._bPlay?" play":"")} @click=${this._togglePlay}></button>
							</div>
							<button class="stop-button" @click=${this._clickStop}></button>
							<button class="prev-button" @click=${this._gotoPrevScript}></button>
							<button class="next-button" @click=${this._gotoNextScript}></button>
							<button class=${"repeat-button"+(this._repeatStart>=0?" on":"")} @click=${this._clickRepeat}></button>
						</div>
						<div class=${"right"+(0===this._numOfScript?" hide":"")}>
								<div class=${"text-adjust"+(e?"":" hide")}>
										<button class="minus-button" 
											?disabled=${this._fontSize<=Ot[0]} 
											@click=${()=>this._downFontSize(-1)}
										></button>
										<button 
											class="plus-button" 
											?disabled=${this._fontSize>=Ot[Ot.length-1]} 
											@click=${()=>this._downFontSize(1)}

										></button>
								</div>
								<button class=${"script-button"+(e?" on":"")} @click=${this._toggleMode}></button>
								
								<button class=${`down-button ${this._numOfScript>0?"":"hide"} ${e?"":"hidden"} ${this._sendedScript?"sended":""}`} @click=${this._sendScript}></button>
								<button class="fullscreen-button ${this._numOfScript>0?"":"hide"} ${e?"":"hidden"}"  @click=${this._toggleFullscreen}></button>
						</div>
					</div>
				</div>
				<span class="size-drag-tgt"></span>
			</div>
		`}_toggleFullscreen(){this._boxEl&&(this.isFullscreen=!this.isFullscreen,this.requestUpdate())}_downFontSize(t){let e=Ot.indexOf(this._fontSize);e<0&&(e=0),e+=t,e<0?e=0:e>Ot.length-1&&(e=Ot.length-1),this._fontSize=Ot[e]}_clearPos(){super._clearPos(),this._fontSize=27}_toggleMode(t){var e,i,s,o;n.isString(t)||(t=""===this._mode?"ver":""),this.isFullscreen=!1;const r=this._middleEl,a=this._boxEl,d=null!==(e=null==r?void 0:r.offsetHeight)&&void 0!==e?e:0,l=super._toggleMode(t);if(l===this._mode)return l;let h;if(L(),this._mode=l,""===l)h=0;else if(r){const t=window.getComputedStyle(r);h=parseFloat(null!==(i=t.height)&&void 0!==i?i:"0"),(isNaN(h)||h<=0)&&(h=parseFloat(null!==(s=t.minHeight)&&void 0!==s?s:"0"))}else h=0;let c=parseFloat(null!==(o=null==a?void 0:a.style.top)&&void 0!==o?o:"0");return isNaN(c)&&(c=0),c+=(d-h)/2,c<0&&(c=0),a&&(a.style.top=c+"px"),setTimeout((()=>this._checkBoxPosition()),100),l}_clickRepeat(){if(this._player.duration<=0)return;L();const t=this._player.currentTime;this._repeatStart<0?this._repeatStart=t:this._repeatEnd<0?t>this._repeatStart+1&&(this._repeatEnd=t,this._player.gotoAndPlay(this._repeatStart,this._repeatEnd,1e5)):(this._player.bPlay?this._player.play():this._player.pause(),this._repeatStart=-1,this._repeatEnd=-1)}setScripts(t){this._questions.length=0,t.forEach(((t,e)=>{t.dms_question&&t.dms_question>0&&this._questions.push({start:t.dms_start,end:t.dms_end,idx:e})})),super.setScripts(t)}};Vt([(0,B.IO)("audio")],Bt.prototype,"_mediaEl",void 0),Vt([(0,B.SB)()],Bt.prototype,"_fontSize",void 0),Bt=Vt([(0,B.Mo)("v-audio-ui")],Bt);let Nt=class extends Lt{static get styles(){return Mt}render(){const t=""!==this._mode;return O.dy`
			<div class="${`player-box ${this._mode} ${this.isFullscreen?"fullscreen":""}`}">
				<div class="top">
					<button class=${"minimize-button not-drag"+(t?"":" hide")} @click=${()=>this._toggleMode("")}></button>
					<button class="close-button not-drag" @click=${()=>this._close()}></button>
				</div>
				<div class="middle">
					<div class="media-box"><video class="not-drag" @pointerdown=${this._togglePlay}></video></div>
					<v-media-script class="script-box not-drag"
						.view=${t}
						.scripts=${this._scripts}
						.scrollIdx=${t?this._scrollIdx:-1}
						.focusIdx=${t?this._focusIdx:-1}
						.fontSize=${27}
						@clickScript=${t=>this._clickScript(t.detail,!0)}
					></v-media-script>
				</div>
				<div class="bottom not-drag">      <!-- 하단 컨트롤 --> 
					<div class="left-controls">
						<div class="play-pause">
							<button class=${"play-button"+(this._bPlay?" play":"")} @click=${this._togglePlay}></button>
						</div>
						<button class="stop-button" @click=${this._clickStop}></button>
						<button class="prev-button" @click=${this._gotoPrevScript}></button>
						<button class="next-button" @click=${this._gotoNextScript}></button>
						<span class="time-current">${this._playTime}</span>

						<v-media-progress class="progress-bar" .ratio=${this._timeRatio} @change=${this.onChangeTime}></v-media-progress>

						<span class="time-remaining">${this._remainTime}</span>
						<button class=${"sound-button "+(this._muted?"mute":"")} @click=${this._toggleMuted}></button>
						<v-media-progress class="volume-bar" .ratio=${this._volumeRatio} @change=${this.onChangeVolume}></v-media-progress>
					</div>
					<div class="right-controls">
						<div class="script-choice" style=${"display:"+(this._viewScriptBtn?"":"none")}>
							<button class="script-ver" @click=${()=>this._toggleMode("ver")}></button>
							<button class="script-hor" @click=${()=>this._toggleMode("hor")}></button>
						</div>
						<button class=${"script-button "+(this._numOfScript<=0?"hide":"")} @click=${this._toggleScriptBtn}></button>
						<button class=${`down-button ${this._numOfScript>0?"":"hide"} ${t?"":"hidden"} ${this._sendedScript?"sended":""}`} @click=${this._sendScript}></button>
						<button class="fullscreen-button"  @click=${this._toggleFullscreen}></button>
					</div>
				</div>

				<span class="drag size-drag-tgt ${this.isFullscreen?"fullscreen":""}"></span>
			</div>
		`}_toggleFullscreen(){this._boxEl&&(this.isFullscreen=!this.isFullscreen,this.requestUpdate())}_toggleMode(t){const e=super._toggleMode(t);return this._viewScriptBtn=!1,e===this._mode||(L(),this._mode=e,setTimeout((()=>this._checkBoxPosition()),100)),e}};Vt([(0,B.IO)(".media-box>video")],Nt.prototype,"_mediaEl",void 0),Nt=Vt([(0,B.Mo)("v-video-ui")],Nt);let Ut=class extends O.oi{constructor(){super(),this.type="video",this.ratio=0,this.min=-1,this.max=-1,this.mouseRatio=-1,this._pid=-1;let t=0,e=-1;const i=t=>{e=t,this.dispatchEvent(new CustomEvent("change",{detail:t}))},s=n.throttle((t=>{t>=0&&this._pid>=0&&i(t)}),500,{leading:!1,trailing:!0});this.addEventListener("pointerdown",(i=>{if(this._pid>=0)return;if(!i.isPrimary)return;if(1!==i.buttons)return;e=-1,t=this.offsetWidth;let o=i.offsetX/t;this.min>=0&&o<this.min?o=this.min:this.max>=0&&o>this.max&&(o=this.max),o<0?o=0:o>1&&(o=1),this.mouseRatio=o,this._pid=i.pointerId,this.setPointerCapture(this._pid),s(o)})),this.addEventListener("pointermove",(e=>{if(this._pid<0)return;if(!e.isPrimary)return;if(1!==e.buttons)return;let i=e.offsetX/t;this.min>=0&&i<this.min?i=this.min:this.max>=0&&i>this.max&&(i=this.max),i<0?i=0:i>1&&(i=1),this.mouseRatio=i,s(i)}));const o=o=>{if(this._pid<0)return;this.releasePointerCapture(this._pid),this._pid=-1;let n=o.offsetX/t;this.min>=0&&n<this.min?n=this.min:this.max>=0&&n>this.max&&(n=this.max),n<0?n=0:n>1&&(n=1),(n<e-.01||n>e+.01)&&(this.mouseRatio=n,s.cancel(),i(n))};this.addEventListener("pointerup",o),this.addEventListener("pointercancel",o)}static get styles(){return Et}render(){return O.dy`
			<div class="box"></div>
			<div class=${"btn "+this.type} style=${`left:${100*(this.mouseRatio>=0?this.mouseRatio:this.ratio)}%`}></div>
		`}shouldUpdate(t){return t.has("ratio")&&this._pid<0&&(this.mouseRatio=-1),super.shouldUpdate(t)}};Vt([(0,B.Cb)()],Ut.prototype,"type",void 0),Vt([(0,B.Cb)({type:Number})],Ut.prototype,"ratio",void 0),Vt([(0,B.Cb)({type:Number})],Ut.prototype,"min",void 0),Vt([(0,B.Cb)({type:Number})],Ut.prototype,"max",void 0),Vt([(0,B.SB)()],Ut.prototype,"mouseRatio",void 0),Ut=Vt([(0,B.Mo)("v-media-progress")],Ut);let jt=class extends O.oi{constructor(){super(...arguments),this.scripts=[],this.view=!1,this.focusIdx=-1,this.scrollIdx=-1,this.fontSize=27}static get styles(){return Ct}render(){return O.dy`
			<div class="scroll">
				${this.scripts.map(((t,e)=>O.dy`
						${t.no_line_break||0===e?void 0:O.dy`<br/>`}
						${t.dms_speaker?O.dy`<span class="speaker">${t.dms_speaker}:</span>`:void 0}
						<span 
							class=${`script${this.focusIdx===e?" on":""}${this.scrollIdx===e?" scroll-to":""}`} 
							@click=${()=>this._clickScript(e)}
							.innerHTML=${t.dms_eng}
						></span>
					`))}
			</div>
		`}updated(t){if(super.updated(t),this.shadowRoot&&this.view){let e=t.has("scrollIdx")||t.has("focusIdx");const i=t.has("fontSize");if((i||t.has("view"))&&(e=!0,this.style.fontSize=this.fontSize+"px"),e){const t=this.shadowRoot.querySelector(".script.scroll-to"),e=this.shadowRoot.querySelector(".scroll");t&&e&&(i&&(e.style.scrollBehavior="auto"),e.scrollTop=t.offsetTop-(e.offsetHeight-t.offsetHeight)/2,i&&(e.style.scrollBehavior="smooth"))}}}_clickScript(t){this.dispatchEvent(new CustomEvent("clickScript",{detail:t}))}};Vt([(0,B.Cb)({type:Array})],jt.prototype,"scripts",void 0),Vt([(0,B.Cb)({type:Boolean})],jt.prototype,"view",void 0),Vt([(0,B.Cb)({type:Number})],jt.prototype,"focusIdx",void 0),Vt([(0,B.Cb)({type:Number})],jt.prototype,"scrollIdx",void 0),Vt([(0,B.Cb)({type:Number})],jt.prototype,"fontSize",void 0),jt=Vt([(0,B.Mo)("v-media-script")],jt),"boolean"!=typeof window.cfg_canTypingAll&&(window.cfg_canTypingAll=!1),window.cfg_debug=!1;try{"boolean"!=typeof cfg_debug&&(cfg_debug=!1)}catch(t){cfg_debug=!1}window.canConsole=()=>cfg_debug,(()=>{let t="./";var e;t.endsWith("/")||(t+="/"),t=new URL(t,location.href).href,(e="./assets/mp3/").endsWith("/")||(e+="/"),I=e,M=e+"to_pad_eng.mp3",E=e+"btn_tab.mp3",C=e+"popup.mp3",A(M),A(E),A(C),window.g_lib_url=t,console.info("version=>","0.8.382-20220816",`g_lib_url='${g_lib_url}', 'SKIN=js`)})();let zt="oxford";(()=>{const{tFrm:t,sEl:e,sFrameBox:i,reportPopup:r,playerManager:a,btnAdd:p}=function(){const t=document.getElementById("teacher"),e=t.querySelector("iframe"),i=document.getElementById("student"),n=i.querySelector(".frame-box"),r=t.querySelector("v-t-report-popup"),a=t.querySelector("v-player-manager"),d=document.querySelector(".control .add"),l=document.querySelector(".control .teacher"),h=document.querySelector(".control .same"),c=document.querySelector(".control .student");let p="same",m=-1;const u=(e,s)=>{p=e,l.disabled="teacher"===e,c.disabled="student"===e,h.disabled="same"===e,m>0&&(window.clearTimeout(m),t.classList.remove("animation"),i.classList.remove("animation")),s&&(t.classList.add("animation"),i.classList.add("animation"),m=window.setTimeout((()=>{t.classList.remove("animation"),i.classList.remove("animation")}),300)),_()},_=()=>{const e=window.innerWidth,n=window.innerHeight;let r=("student"===p?1920:"teacher"===p?640:o)/o,a=("student"===p?640:"teacher"===p?1920:s)/s;const d=e/(s*a+o*r),l=n/(800*a+800*r);let h=Math.max(d,l);t.style.transform=`scale(${h*a})`,i.style.transform=`scale(${h*r})`};return window.addEventListener("resize",_),l.addEventListener("click",(()=>u("teacher",!0))),c.addEventListener("click",(()=>u("student",!0))),h.addEventListener("click",(()=>u("same",!0))),setTimeout((()=>u("same")),300),{tEl:t,tFrm:e,sEl:i,sFrameBox:n,reportPopup:r,playerManager:a,btnAdd:d}}();p.onclick=()=>{_.addStudent(!1)};const m=d.map(((t,e)=>function(t){const e=t%h.length,i=t%d.length,s=t%l.length;return{id:1e3+t,learn_idx:1e4+t,name:h[e],nickName:c[t%c.length],thumbnail:d[i],defaultThumbnail:d[i],profileThumbnail:l[s],birthday:"",gender:"M",displayMode:comm_o.displayMode}}(e))),_=function(t,e,i,s){let o="";const r=[];function a(){return r.map((t=>n.cloneDeep(t.info)))}let d=null;function l(t){d.blur(t.idx),d=t.focus()}function h(t){if(r.length>=s.length)return;const n=r.length,h=s[n],c=new W(h,i,l,a),p=c.container;e.appendChild(p),t?d=c.focus():c.blur(n),r.push(c),c.frame.src=o}return h(!0),{handlePostMessage:t=>z(this,void 0,void 0,(function*(){const e=r.length;for(let i=0;i<e;i++)if(yield r[i].handlePostMessage(t))return!0;return!1})),handleWssMessage:(t,e)=>{if(e){const i=r.length;for(let s=0;s<i;s++){const{info:i}=r[s];if(i.id===e)return void r[s].handleWssMessage(t)}}else r.forEach((e=>e.handleWssMessage(t)))},sendPADToID:(t,e)=>{var i;const s=r.length;for(let o=0;o<s;o++){const{frame:s,info:n}=r[o];if(n.id===t)return void(null===(i=s.contentWindow)||void 0===i||i.postMessage(e,"*"))}},sendAllPAD:t=>{r.forEach((e=>{var i;return null===(i=e.frame.contentWindow)||void 0===i?void 0:i.postMessage(t,"*")}))},addStudent:h,getLoginStudents:a,gotoBook:t=>{o=t,r.forEach((e=>{e.clear(),e.frame.src=t}))},initMathAlive:()=>{r.forEach((t=>t.initMathAlive()))}}}(0,i,t.contentWindow,m),g={prevkey:-1,prevpage:-1,curkey:-1,curpage:-1,study:void 0,SB:{topOff:!1,bottomOff:!1,pages:[-1,-1],viewAnswerBtn:!1},WB:{topOff:!1,bottomOff:!1,pages:[-1,-1],viewAnswerBtn:!1},malist:[]};let f="",v="";const y=(e,i,s,o,n,r,a,d,l,h,c,p)=>{let m,u;const g=new URLSearchParams,f=new URLSearchParams;i&&i>0&&g.append("page",i+""),n&&n>0&&g.append("sbookPage",n+""),s&&(g.append("uniq",s),f.append("uniq",s)),d&&g.append("study",d),l&&g.append("topOff","y"),h&&g.append("bottomOff","y"),c&&g.append("pages",c.join(",")),p&&g.append("viewAnswerBtn","y"),m=`${e}teacher/index.html?${g.toString()}`,u=`${e}student/index.html?${f.toString()}`,t.src=m,_.gotoBook(u)},b=(t,e,i,s,o,n,r,a,d,l,h,c)=>{g.curkey=t,g.curpage=null!=e?e:-1,f=v+t+"/",y(v+t+"/",e,i,0,o,0,0,a,d,l,h,c)};(()=>{var t,e,i,s,o,n,r,a;const d=document.baseURI,l=parseInt(null!==(t=comm_o.getQuery("book-key"))&&void 0!==t?t:"-1",10),h=parseInt(null!==(e=comm_o.getQuery("page"))&&void 0!==e?e:"-1",10),c=(parseInt(null!==(i=comm_o.getQuery("spage"))&&void 0!==i?i:"-1",10),parseInt(null!==(s=comm_o.getQuery("epage"))&&void 0!==s?s:"-1",10),comm_o.getQuery("example"),(null!==(o=comm_o.getQuery("uniq"))&&void 0!==o?o:"").trim()),p=(null!==(n=comm_o.getQuery("reportTheme"))&&void 0!==n?n:"").trim();if(v=(null!==(r=comm_o.getQuery("book-base-url"))&&void 0!==r?r:"").trim(),f=(null!==(a=comm_o.getQuery("url"))&&void 0!==a?a:"").trim(),zt="elif"===p?"elif":"oxford",""!==f){if(""===v){const t=f.split("/");t.pop(),f.endsWith("/")&&t.pop(),v=t.join("/")}v=new URL(v,d).href,f=new URL(f,d).href,v.endsWith("/")||(v+="/"),f.endsWith("/")||(f+="/"),y(f,h,c,0,void 0)}else{if(!(""!==v&&l>0))throw"request query가 이상. book-key/book-base-url 혹은 url 미입력";v=new URL(v,d).href,f=v+l+"/",b(l,h,c,0,void 0)}})(),u(t,_,r,a,m,zt,void 0,(t=>{var e;const i=t.msg;let s,o,n,r,a;g.prevkey=g.curkey,"student"===i.curbook?g.study=i.studyElement:g.study=void 0,i.curpage&&i.curpage>0?("work"===i.tobook&&"student"===i.curbook&&(s=i.curpage),g.prevpage=i.curpage):g.prevpage=g.curpage,"student"===i.tobook?(o=g.SB.topOff,n=g.SB.bottomOff,r=g.SB.pages,a=g.SB.viewAnswerBtn,g.malist=[]):"work"===i.tobook?(o=g.WB.topOff,n=g.WB.bottomOff,r=g.WB.pages,a=g.WB.viewAnswerBtn,g.malist=[]):g.malist=null!==(e=i.malist)&&void 0!==e?e:[],i.pages&&("student"===i.curbook?(g.SB.topOff=!!i.topOff,g.SB.bottomOff=!!i.bottomOff,g.SB.pages=i.pages,g.SB.viewAnswerBtn=!!i.viewAnswerBtn):"work"===i.curbook&&(g.WB.topOff=!!i.topOff,g.WB.bottomOff=!!i.bottomOff,g.WB.pages=i.pages,g.WB.viewAnswerBtn=!!i.viewAnswerBtn)),b(i.bookkey,i.page,void 0,i.isExample,s,0,0,void 0,o,n,r,a)}),(()=>{g.prevkey<=0||(g.malist=[],b(g.prevkey,g.prevpage,void 0,0,void 0,0,0,g.study,g.SB.topOff,g.SB.bottomOff,g.SB.pages,g.SB.viewAnswerBtn),g.prevkey=-1,g.prevpage=-1,g.study=void 0)}),(t=>{let e=g.malist.indexOf(g.curkey);if(e<0)return;if(e+=t,e<0)return;const i=g.malist[e];"number"==typeof i&&i>0&&b(i,void 0,void 0)}))})()}},i={};function s(t){var o=i[t];if(void 0!==o)return o.exports;var n=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=e,t=[],s.O=(e,i,o,n)=>{if(!i){var r=1/0;for(h=0;h<t.length;h++){for(var[i,o,n]=t[h],a=!0,d=0;d<i.length;d++)(!1&n||r>=n)&&Object.keys(s.O).every((t=>s.O[t](i[d])))?i.splice(d--,1):(a=!1,n<r&&(r=n));if(a){t.splice(h--,1);var l=o();void 0!==l&&(e=l)}}return e}n=n||0;for(var h=t.length;h>0&&t[h-1][2]>n;h--)t[h]=t[h-1];t[h]=[i,o,n]},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={348:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var o,n,[r,a,d]=i,l=0;if(r.some((e=>0!==t[e]))){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(d)var h=d(s)}for(e&&e(i);l<r.length;l++)n=r[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(h)},i=self.webpackChunki_book_viewer=self.webpackChunki_book_viewer||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),s.O(void 0,[821],(()=>s(107)));var o=s.O(void 0,[821],(()=>s(105)));o=s.O(o)})();